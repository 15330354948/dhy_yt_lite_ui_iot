define(["../Core/CompressedTextureBuffer","../Core/defined","../Core/PixelFormat","../Core/RuntimeError","../ThirdParty/crunch","./createTaskProcessorWorker"],function(r,e,t,n,o,f){"use strict";var a,s,_=1,c=2,i={};i[0]=t.RGB_DXT1,i[_]=t.RGBA_DXT3,i[c]=t.RGBA_DXT5;var u=0;return f(function(f,_){var c=f.byteLength,d=new Uint8Array(f),m=o._malloc(c);!function(r,e,t,n){var o,f=t/4,a=n%4,s=new Uint32Array(r.buffer,0,(n-a)/4),_=new Uint32Array(e.buffer);for(o=0;o<s.length;o++)_[f+o]=s[o];for(o=n-a;o<n;o++)e[t+o]=r[o]}(d,o.HEAPU8,m,c);var y=o._crn_get_dxt_format(m,c),h=i[y];if(!e(h))throw new n("Unsupported compressed format.");var w,A=o._crn_get_levels(m,c),l=o._crn_get_width(m,c),p=o._crn_get_height(m,c),v=0;for(w=0;w<A;++w)v+=t.compressedTextureSizeInBytes(h,l>>w,p>>w);u<v&&(e(a)&&o._free(a),a=o._malloc(v),s=new Uint8Array(o.HEAPU8.buffer,a,v),u=v),o._crn_decompress(m,c,a,v,0,A),o._free(m);var T=t.compressedTextureSizeInBytes(h,l,p),U=s.subarray(0,T),g=new Uint8Array(T);return g.set(U,0),_.push(g.buffer),new r(h,l,p,g)})});