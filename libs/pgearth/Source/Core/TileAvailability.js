define(["./binarySearch","./Cartographic","./defined","./defineProperties","./DeveloperError","./Rectangle"],function(e,t,n,s,i,h){"use strict";function r(e,t){this._tilingScheme=e,this._maximumLevel=t,this._rootNodes=[]}var o=new h;function a(e,t,n,s){for(var i=s.length,h=0;h<i;++h){var r=s[h];if(r.x===t&&r.y===n&&r.level===e)return!0}return!1}r.prototype.addAvailableTileRange=function(e,t,n,s,i){var h=this._tilingScheme,r=this._rootNodes;if(0===e)for(var l=n;l<=i;++l)for(var u=t;u<=s;++u)a(e,u,l,r)||r.push(new f(h,void 0,0,u,l));h.tileXYToRectangle(t,n,e,o);var v=o.west,w=o.north;h.tileXYToRectangle(s,i,e,o);for(var c=o.east,m=new function(e,t,n,s,i){this.level=e,this.west=t,this.south=n,this.east=s,this.north=i}(e,v,o.south,c,w),p=0;p<r.length;++p){var x=r[p];_(x.extent,m)&&g(this._maximumLevel,x,m)}},r.prototype.computeMaximumLevelAtPosition=function(e){for(var t,s=0;s<this._rootNodes.length;++s){var i=this._rootNodes[s];if(x(i.extent,e)){t=i;break}}return n(t)?function e(t,n,s){var i=0;var h=!1;for(;!h;){var r=n._nw&&x(n._nw.extent,s),o=n._ne&&x(n._ne.extent,s),a=n._sw&&x(n._sw.extent,s),l=n._se&&x(n._se.extent,s);if(r+o+a+l>1){r&&(i=Math.max(i,e(n,n._nw,s))),o&&(i=Math.max(i,e(n,n._ne,s))),a&&(i=Math.max(i,e(n,n._sw,s))),l&&(i=Math.max(i,e(n,n._se,s)));break}r?n=n._nw:o?n=n._ne:a?n=n._sw:l?n=n._se:h=!0}for(;n!==t;){for(var u=n.rectangles,v=u.length-1;v>=0&&u[v].level>i;--v){var w=u[v];x(w,s)&&(i=w.level)}n=n.parent}return i}(void 0,t,e):-1};var l=[],u=[],v=new h,w=new h;r.prototype.computeBestAvailableLevelOverRectangle=function(e){var t=l;t.length=0,e.east<e.west?(t.push(h.fromRadians(-Math.PI,e.south,e.east,e.north,v)),t.push(h.fromRadians(e.west,e.south,Math.PI,e.north,w))):t.push(e);var s,i=u;for(i.length=0,s=0;s<this._rootNodes.length;++s)d(i,this._rootNodes[s],t);for(s=i.length-1;s>=0;--s)if(n(i[s])&&0===i[s].length)return s;return 0};var c=new t;function f(e,t,n,s,i){this.tilingScheme=e,this.parent=t,this.level=n,this.x=s,this.y=i,this.extent=e.tileXYToRectangle(s,i,n),this.rectangles=[],this._sw=void 0,this._se=void 0,this._nw=void 0,this._ne=void 0}function _(e,t){var n=Math.max(e.west,t.west),s=Math.max(e.south,t.south),i=Math.min(e.east,t.east);return s<Math.min(e.north,t.north)&&n<i}function g(t,n,s){for(;n.level<t;)if(p(n.nw.extent,s))n=n.nw;else if(p(n.ne.extent,s))n=n.ne;else if(p(n.sw.extent,s))n=n.sw;else{if(!p(n.se.extent,s))break;n=n.se}if(0===n.rectangles.length||n.rectangles[n.rectangles.length-1].level<=s.level)n.rectangles.push(s);else{var i=e(n.rectangles,s.level,m);i<=0&&(i=~i),n.rectangles.splice(i,0,s)}}function m(e,t){return e.level-t}function p(e,t){return t.west>=e.west&&t.east<=e.east&&t.south>=e.south&&t.north<=e.north}function x(e,t){return t.longitude>=e.west&&t.longitude<=e.east&&t.latitude>=e.south&&t.latitude<=e.north}function d(e,t,n){if(t){var s,i=!1;for(s=0;s<n.length;++s)i=i||_(t.extent,n[s]);if(i){var h=t.rectangles;for(s=0;s<h.length;++s){var r=h[s];e[r.level]||(e[r.level]=n),e[r.level]=M(e[r.level],r)}d(e,t._nw,n),d(e,t._ne,n),d(e,t._sw,n),d(e,t._se,n)}}}function M(e,t){for(var n=[],s=0;s<e.length;++s){var i=e[s];_(i,t)?(i.west<t.west&&n.push(new h(i.west,i.south,t.west,i.north)),i.east>t.east&&n.push(new h(t.east,i.south,i.east,i.north)),i.south<t.south&&n.push(new h(Math.max(t.west,i.west),i.south,Math.min(t.east,i.east),t.south)),i.north>t.north&&n.push(new h(Math.max(t.west,i.west),t.north,Math.min(t.east,i.east),i.north))):n.push(i)}return n}return r.prototype.isTileAvailable=function(e,t,n){var s=this._tilingScheme.tileXYToRectangle(t,n,e,o);return h.center(s,c),this.computeMaximumLevelAtPosition(c)>=e},r.prototype.computeChildMaskForTile=function(e,t,n){var s=e+1;if(s>=this._maximumLevel)return 0;var i=0;return i|=this.isTileAvailable(s,2*t,2*n+1)?1:0,i|=this.isTileAvailable(s,2*t+1,2*n+1)?2:0,i|=this.isTileAvailable(s,2*t,2*n)?4:0,i|=this.isTileAvailable(s,2*t+1,2*n)?8:0},s(f.prototype,{nw:{get:function(){return this._nw||(this._nw=new f(this.tilingScheme,this,this.level+1,2*this.x,2*this.y)),this._nw}},ne:{get:function(){return this._ne||(this._ne=new f(this.tilingScheme,this,this.level+1,2*this.x+1,2*this.y)),this._ne}},sw:{get:function(){return this._sw||(this._sw=new f(this.tilingScheme,this,this.level+1,2*this.x,2*this.y+1)),this._sw}},se:{get:function(){return this._se||(this._se=new f(this.tilingScheme,this,this.level+1,2*this.x+1,2*this.y+1)),this._se}}}),r});