define(["../Core/BoundingSphere","../Core/Check","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Scene/GroundPrimitive","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","../Scene/Primitive","./BoundingSphereState","./ColorMaterialProperty","./MaterialProperty","./Property"],function(e,t,i,r,o,n,s,a,d,p,h,l,m){"use strict";function u(e,i,r){t.defined("geometryUpdater",e),t.defined("primitives",i),t.defined("orderedGroundPrimitives",r),this._primitives=i,this._orderedGroundPrimitives=r,this._primitive=void 0,this._outlinePrimitive=void 0,this._geometryUpdater=e,this._options=e._options,this._entity=e._entity,this._material=void 0}return u.prototype._isHidden=function(e,t,i){return!e.isShowing||!e.isAvailable(i)||!m.getValueOrDefault(t.show,i,!0)},u.prototype._setOptions=o.throwInstantiationError,u.prototype.update=function(e){t.defined("time",e);var r=this._geometryUpdater,o=r._onTerrain,p=this._primitives,u=this._orderedGroundPrimitives;o?u.remove(this._primitive):(p.removeAndDestroy(this._primitive),p.removeAndDestroy(this._outlinePrimitive),this._outlinePrimitive=void 0),this._primitive=void 0;var y=this._entity,v=y[this._geometryUpdater._geometryPropertyName];if(this._setOptions(y,v,e),!this._isHidden(y,v,e)){var _=this._geometryUpdater.shadowsProperty.getValue(e),c=this._options;if(!i(v.fill)||v.fill.getValue(e)){var g,f=r.fillMaterialProperty,P=f instanceof h,w=r._getIsClosed(c);if(P)g=new a({closed:w,flat:o&&!r._supportsMaterialsforEntitiesOnTerrain});else{var I=l.getValue(e,f,this._material);this._material=I,g=new s({material:I,translucent:I.isTranslucent(),closed:w})}if(o)c.vertexFormat=a.VERTEX_FORMAT,this._primitive=u.add(new n({geometryInstances:this._geometryUpdater.createFillGeometryInstance(e),appearance:g,asynchronous:!1,shadows:_,classificationType:this._geometryUpdater.classificationTypeProperty.getValue(e)}),m.getValueOrUndefined(this._geometryUpdater.zIndex,e));else{c.vertexFormat=g.vertexFormat;var S=this._geometryUpdater.createFillGeometryInstance(e);P&&(g.translucent=255!==S.attributes.color.value[3]),this._primitive=p.add(new d({geometryInstances:S,appearance:g,asynchronous:!1,shadows:_}))}}if(!o&&i(v.outline)&&v.outline.getValue(e)){var D=this._geometryUpdater.createOutlineGeometryInstance(e),U=m.getValueOrDefault(v.outlineWidth,e,1);this._outlinePrimitive=p.add(new d({geometryInstances:D,appearance:new a({flat:!0,translucent:255!==D.attributes.color.value[3],renderState:{lineWidth:r._scene.clampLineWidth(U)}}),asynchronous:!1,shadows:_}))}}},u.prototype.getBoundingSphere=function(t){if(!i(t))throw new o("result is required.");var r,n=this._entity,s=this._primitive,a=this._outlinePrimitive;return i(s)&&s.show&&s.ready&&(r=s.getGeometryInstanceAttributes(n),i(r)&&i(r.boundingSphere))?(e.clone(r.boundingSphere,t),p.DONE):i(a)&&a.show&&a.ready&&(r=a.getGeometryInstanceAttributes(n),i(r)&&i(r.boundingSphere))?(e.clone(r.boundingSphere,t),p.DONE):i(s)&&!s.ready||i(a)&&!a.ready?p.PENDING:p.FAILED},u.prototype.isDestroyed=function(){return!1},u.prototype.destroy=function(){var e=this._primitives,t=this._orderedGroundPrimitives;this._geometryUpdater._onTerrain?t.remove(this._primitive):e.removeAndDestroy(this._primitive),e.removeAndDestroy(this._outlinePrimitive),r(this)},u});