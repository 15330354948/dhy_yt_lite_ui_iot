define(["../Core/Cartesian2","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/KeyboardEventModifier","../Core/Math","../Core/ScreenSpaceEventHandler","../Core/ScreenSpaceEventType","./CameraEventType"],function(t,e,n,i,o,s,r,a,d,u){"use strict";function _(t,n){var i=t;return e(n)&&(i+="+"+n),i}function v(n,i,o){var s=_(u.PINCH,i),r=n._update,a=n._isDown,v=n._eventStartPosition,h=n._pressTime,p=n._releaseTime;r[s]=!0,a[s]=!1,v[s]=new t;var c=n._movement[s];e(c)||(c=n._movement[s]={}),c.distance={startPosition:new t,endPosition:new t},c.angleAndHeight={startPosition:new t,endPosition:new t},c.prevAngle=0,n._eventHandler.setInputAction(function(e){n._buttonsDown++,a[s]=!0,h[s]=new Date,t.lerp(e.position1,e.position2,.5,v[s])},d.PINCH_START,i),n._eventHandler.setInputAction(function(){n._buttonsDown=Math.max(n._buttonsDown-1,0),a[s]=!1,p[s]=new Date},d.PINCH_END,i),n._eventHandler.setInputAction(function(e){if(a[s]){r[s]?(u=e,_=c,t.clone(u.distance.startPosition,_.distance.startPosition),t.clone(u.distance.endPosition,_.distance.endPosition),t.clone(u.angleAndHeight.startPosition,_.angleAndHeight.startPosition),t.clone(u.angleAndHeight.endPosition,_.angleAndHeight.endPosition),r[s]=!1,c.prevAngle=c.angleAndHeight.startPosition.x):(t.clone(e.distance.endPosition,c.distance.endPosition),t.clone(e.angleAndHeight.endPosition,c.angleAndHeight.endPosition));for(var n=c.angleAndHeight.endPosition.x,i=c.prevAngle,d=2*Math.PI;n>=i+Math.PI;)n-=d;for(;n<i-Math.PI;)n+=d;c.angleAndHeight.endPosition.x=-n*o.clientWidth/12,c.angleAndHeight.startPosition.x=-i*o.clientWidth/12}var u,_},d.PINCH_MOVE,i)}function h(n,i){var o=_(u.WHEEL,i),s=n._update;s[o]=!0;var a=n._movement[o];e(a)||(a=n._movement[o]={}),a.startPosition=new t,a.endPosition=new t,n._eventHandler.setInputAction(function(e){var n=15*r.toRadians(e);s[o]?(t.clone(t.ZERO,a.startPosition),a.endPosition.x=0,a.endPosition.y=n,s[o]=!1):a.endPosition.y=a.endPosition.y+n},d.WHEEL,i)}function p(n,i,o){var s=_(o,i),r=n._isDown,a=n._eventStartPosition,v=n._pressTime,h=n._releaseTime;r[s]=!1,a[s]=new t;var p,c,P=n._lastMovement[s];e(P)||(P=n._lastMovement[s]={startPosition:new t,endPosition:new t,valid:!1}),o===u.LEFT_DRAG?(p=d.LEFT_DOWN,c=d.LEFT_UP):o===u.RIGHT_DRAG?(p=d.RIGHT_DOWN,c=d.RIGHT_UP):o===u.MIDDLE_DRAG&&(p=d.MIDDLE_DOWN,c=d.MIDDLE_UP),n._eventHandler.setInputAction(function(e){n._buttonsDown++,P.valid=!1,r[s]=!0,v[s]=new Date,t.clone(e.position,a[s])},p,i),n._eventHandler.setInputAction(function(){n._buttonsDown=Math.max(n._buttonsDown-1,0),r[s]=!1,h[s]=new Date},c,i)}function c(e,n){t.clone(e.startPosition,n.startPosition),t.clone(e.endPosition,n.endPosition)}function P(n,i){var o=n._update,s=n._movement,r=n._lastMovement,a=n._isDown;for(var v in u)if(u.hasOwnProperty(v)){var h=u[v];if(e(h)){var p=_(h,i);o[p]=!0,e(n._lastMovement[p])||(n._lastMovement[p]={startPosition:new t,endPosition:new t,valid:!1}),e(n._movement[p])||(n._movement[p]={startPosition:new t,endPosition:new t})}}n._eventHandler.setInputAction(function(d){for(var v in u)if(u.hasOwnProperty(v)){var h=u[v];if(e(h)){var p=_(h,i);a[p]&&(o[p]?(c(s[p],r[p]),r[p].valid=!0,c(d,s[p]),o[p]=!1):t.clone(d.endPosition,s[p].endPosition))}}t.clone(d.endPosition,n._currentMousePosition)},d.MOUSE_MOVE,i)}function l(n){if(!e(n))throw new o("canvas is required.");for(var i in this._eventHandler=new a(n,!0),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new t,h(this,void 0),v(this,void 0,n),p(this,void 0,u.LEFT_DRAG),p(this,void 0,u.RIGHT_DRAG),p(this,void 0,u.MIDDLE_DRAG),P(this,void 0),s)if(s.hasOwnProperty(i)){var r=s[i];e(r)&&(h(this,r),v(this,r,n),p(this,r,u.LEFT_DRAG),p(this,r,u.RIGHT_DRAG),p(this,r,u.MIDDLE_DRAG),P(this,r))}}return n(l.prototype,{currentMousePosition:{get:function(){return this._currentMousePosition}},anyButtonDown:{get:function(){var t=!(this._update[_(u.WHEEL)]&&this._update[_(u.WHEEL,s.SHIFT)]&&this._update[_(u.WHEEL,s.CTRL)]&&this._update[_(u.WHEEL,s.ALT)]);return this._buttonsDown>0||t}}}),l.prototype.isMoving=function(t,n){if(!e(t))throw new o("type is required.");var i=_(t,n);return!this._update[i]},l.prototype.getMovement=function(t,n){if(!e(t))throw new o("type is required.");var i=_(t,n);return this._movement[i]},l.prototype.getLastMovement=function(t,n){if(!e(t))throw new o("type is required.");var i=_(t,n),s=this._lastMovement[i];if(s.valid)return s},l.prototype.isButtonDown=function(t,n){if(!e(t))throw new o("type is required.");var i=_(t,n);return this._isDown[i]},l.prototype.getStartMousePosition=function(t,n){if(!e(t))throw new o("type is required.");if(t===u.WHEEL)return this._currentMousePosition;var i=_(t,n);return this._eventStartPosition[i]},l.prototype.getButtonPressTime=function(t,n){if(!e(t))throw new o("type is required.");var i=_(t,n);return this._pressTime[i]},l.prototype.getButtonReleaseTime=function(t,n){if(!e(t))throw new o("type is required.");var i=_(t,n);return this._releaseTime[i]},l.prototype.reset=function(){for(var t in this._update)this._update.hasOwnProperty(t)&&(this._update[t]=!0)},l.prototype.isDestroyed=function(){return!1},l.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),i(this)},l});