define(["./defaultValue","./defined","./defineProperties","./destroyObject","./Iso8601","./JulianDate"],function(e,t,i,s,n,c){"use strict";function o(t){t=e(t,e.EMPTY_OBJECT),this._clock=void 0,this._element=void 0,this._clockSubscription=void 0,this._seekFunction=void 0,this._lastPlaybackRate=void 0,this.clock=t.clock,this.element=t.element,this.epoch=e(t.epoch,n.MINIMUM_VALUE),this.tolerance=e(t.tolerance,1),this._seeking=!1,this._seekFunction=void 0,this._firstTickAfterSeek=!1}return i(o.prototype,{clock:{get:function(){return this._clock},set:function(e){var i=this._clock;i!==e&&(t(i)&&(this._clockSubscription(),this._clockSubscription=void 0),t(e)&&(this._clockSubscription=e.onTick.addEventListener(o.prototype._onTick,this)),this._clock=e)}},element:{get:function(){return this._element},set:function(e){var i,s=this._element;s!==e&&(t(s)&&s.removeEventListener("seeked",this._seekFunction,!1),t(e)&&(this._seeking=!1,this._seekFunction=(i=this,function(){i._seeking=!1,i._firstTickAfterSeek=!0}),e.addEventListener("seeked",this._seekFunction,!1)),this._element=e,this._seeking=!1,this._firstTickAfterSeek=!1)}}}),o.prototype.destroy=function(){return this.element=void 0,this.clock=void 0,s(this)},o.prototype.isDestroyed=function(){return!1},o.prototype._trySetPlaybackRate=function(e){if(this._lastPlaybackRate!==e.multiplier){var t=this._element;try{t.playbackRate=e.multiplier}catch(e){t.playbackRate=0}this._lastPlaybackRate=e.multiplier}},o.prototype._onTick=function(i){var s=this._element;if(t(s)&&!(s.readyState<2)){var o=s.paused,r=i.shouldAnimate;if(r===o&&(r?s.play():s.pause()),this._seeking||this._firstTickAfterSeek)this._firstTickAfterSeek=!1;else{this._trySetPlaybackRate(i);var a,h=i.currentTime,l=e(this.epoch,n.MINIMUM_VALUE),k=c.secondsDifference(h,l),_=s.duration,u=s.currentTime;s.loop?((k%=_)<0&&(k=_-k),a=k):a=k>_?_:k<0?0:k;var f=r?e(this.tolerance,1):.001;Math.abs(a-u)>f&&(this._seeking=!0,s.currentTime=a)}}},o});