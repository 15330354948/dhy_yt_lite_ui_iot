define(["./binarySearch","./defaultValue","./defined","./defineProperties","./DeveloperError","./Event","./GregorianDate","./isLeapYear","./Iso8601","./JulianDate","./TimeInterval"],function(t,e,a,n,r,s,i,d,o,l,u){"use strict";function p(t,e){return l.compare(t.start,e.start)}function c(t){if(this._intervals=[],this._changedEvent=new s,a(t))for(var e=t.length,n=0;n<e;n++)this.addInterval(t[n])}n(c.prototype,{changedEvent:{get:function(){return this._changedEvent}},start:{get:function(){var t=this._intervals;return 0===t.length?void 0:t[0].start}},isStartIncluded:{get:function(){var t=this._intervals;return 0!==t.length&&t[0].isStartIncluded}},stop:{get:function(){var t=this._intervals,e=t.length;return 0===e?void 0:t[e-1].stop}},isStopIncluded:{get:function(){var t=this._intervals,e=t.length;return 0!==e&&t[e-1].isStopIncluded}},length:{get:function(){return this._intervals.length}},isEmpty:{get:function(){return 0===this._intervals.length}}}),c.prototype.equals=function(t,e){if(this===t)return!0;if(!(t instanceof c))return!1;var a=this._intervals,n=t._intervals,r=a.length;if(r!==n.length)return!1;for(var s=0;s<r;s++)if(!u.equals(a[s],n[s],e))return!1;return!0},c.prototype.get=function(t){if(!a(t))throw new r("index is required.");return this._intervals[t]},c.prototype.removeAll=function(){this._intervals.length>0&&(this._intervals.length=0,this._changedEvent.raiseEvent(this))},c.prototype.findIntervalContainingDate=function(t){var e=this.indexOf(t);return e>=0?this._intervals[e]:void 0},c.prototype.findDataForIntervalContainingDate=function(t){var e=this.indexOf(t);return e>=0?this._intervals[e].data:void 0},c.prototype.contains=function(t){return this.indexOf(t)>=0};var I=new u;c.prototype.indexOf=function(e){if(!a(e))throw new r("date is required");var n=this._intervals;I.start=e,I.stop=e;var s=t(n,I,p);return s>=0?n[s].isStartIncluded?s:s>0&&n[s-1].stop.equals(e)&&n[s-1].isStopIncluded?s-1:~s:(s=~s)>0&&s-1<n.length&&u.contains(n[s-1],e)?s-1:~s},c.prototype.findInterval=function(t){for(var n=(t=e(t,e.EMPTY_OBJECT)).start,r=t.stop,s=t.isStartIncluded,i=t.isStopIncluded,d=this._intervals,o=0,l=d.length;o<l;o++){var u=d[o];if((!a(n)||u.start.equals(n))&&(!a(r)||u.stop.equals(r))&&(!a(s)||u.isStartIncluded===s)&&(!a(i)||u.isStopIncluded===i))return d[o]}},c.prototype.addInterval=function(e,n){if(!a(e))throw new r("interval is required");if(!e.isEmpty){var s=this._intervals;if(0===s.length||l.greaterThan(e.start,s[s.length-1].stop))return s.push(e),void this._changedEvent.raiseEvent(this);var i,d=t(s,e,p);for(d<0?d=~d:d>0&&e.isStartIncluded&&s[d-1].isStartIncluded&&s[d-1].start.equals(e.start)?--d:d<s.length&&!e.isStartIncluded&&s[d].isStartIncluded&&s[d].start.equals(e.start)&&++d,d>0&&((i=l.compare(s[d-1].stop,e.start))>0||0===i&&(s[d-1].isStopIncluded||e.isStartIncluded))&&((a(n)?n(s[d-1].data,e.data):s[d-1].data===e.data)?(e=l.greaterThan(e.stop,s[d-1].stop)?new u({start:s[d-1].start,stop:e.stop,isStartIncluded:s[d-1].isStartIncluded,isStopIncluded:e.isStopIncluded,data:e.data}):new u({start:s[d-1].start,stop:s[d-1].stop,isStartIncluded:s[d-1].isStartIncluded,isStopIncluded:s[d-1].isStopIncluded||e.stop.equals(s[d-1].stop)&&e.isStopIncluded,data:e.data}),s.splice(d-1,1),--d):(((i=l.compare(s[d-1].stop,e.stop))>0||0===i&&s[d-1].isStopIncluded&&!e.isStopIncluded)&&s.splice(d,0,new u({start:e.stop,stop:s[d-1].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:s[d-1].isStopIncluded,data:s[d-1].data})),s[d-1]=new u({start:s[d-1].start,stop:e.start,isStartIncluded:s[d-1].isStartIncluded,isStopIncluded:!e.isStartIncluded,data:s[d-1].data})));d<s.length&&((i=l.compare(e.stop,s[d].start))>0||0===i&&(e.isStopIncluded||s[d].isStartIncluded));)if(a(n)?n(s[d].data,e.data):s[d].data===e.data)e=new u({start:e.start,stop:l.greaterThan(s[d].stop,e.stop)?s[d].stop:e.stop,isStartIncluded:e.isStartIncluded,isStopIncluded:l.greaterThan(s[d].stop,e.stop)?s[d].isStopIncluded:e.isStopIncluded,data:e.data}),s.splice(d,1);else{if(s[d]=new u({start:e.stop,stop:s[d].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:s[d].isStopIncluded,data:s[d].data}),!s[d].isEmpty)break;s.splice(d,1)}s.splice(d,0,e),this._changedEvent.raiseEvent(this)}},c.prototype.removeInterval=function(e){if(!a(e))throw new r("interval is required");if(e.isEmpty)return!1;var n=this._intervals,s=t(n,e,p);s<0&&(s=~s);var i=!1;for(s>0&&(l.greaterThan(n[s-1].stop,e.start)||n[s-1].stop.equals(e.start)&&n[s-1].isStopIncluded&&e.isStartIncluded)&&(i=!0,(l.greaterThan(n[s-1].stop,e.stop)||n[s-1].isStopIncluded&&!e.isStopIncluded&&n[s-1].stop.equals(e.stop))&&n.splice(s,0,new u({start:e.stop,stop:n[s-1].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:n[s-1].isStopIncluded,data:n[s-1].data})),n[s-1]=new u({start:n[s-1].start,stop:e.start,isStartIncluded:n[s-1].isStartIncluded,isStopIncluded:!e.isStartIncluded,data:n[s-1].data})),s<n.length&&!e.isStartIncluded&&n[s].isStartIncluded&&e.start.equals(n[s].start)&&(i=!0,n.splice(s,0,new u({start:n[s].start,stop:n[s].start,isStartIncluded:!0,isStopIncluded:!0,data:n[s].data})),++s);s<n.length&&l.greaterThan(e.stop,n[s].stop);)i=!0,n.splice(s,1);return s<n.length&&e.stop.equals(n[s].stop)&&(i=!0,!e.isStopIncluded&&n[s].isStopIncluded?s+1<n.length&&n[s+1].start.equals(e.stop)&&n[s].data===n[s+1].data?(n.splice(s,1),n[s]=new u({start:n[s].start,stop:n[s].stop,isStartIncluded:!0,isStopIncluded:n[s].isStopIncluded,data:n[s].data})):n[s]=new u({start:e.stop,stop:e.stop,isStartIncluded:!0,isStopIncluded:!0,data:n[s].data}):n.splice(s,1)),s<n.length&&(l.greaterThan(e.stop,n[s].start)||e.stop.equals(n[s].start)&&e.isStopIncluded&&n[s].isStartIncluded)&&(i=!0,n[s]=new u({start:e.stop,stop:n[s].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:n[s].isStopIncluded,data:n[s].data})),i&&this._changedEvent.raiseEvent(this),i},c.prototype.intersect=function(t,e,n){if(!a(t))throw new r("other is required.");for(var s=new c,i=0,d=0,o=this._intervals,p=t._intervals;i<o.length&&d<p.length;){var I=o[i],h=p[d];if(l.lessThan(I.stop,h.start))++i;else if(l.lessThan(h.stop,I.start))++d;else{if(a(n)||a(e)&&e(I.data,h.data)||!a(e)&&h.data===I.data){var v=u.intersect(I,h,new u,n);v.isEmpty||s.addInterval(v,e)}l.lessThan(I.stop,h.stop)||I.stop.equals(h.stop)&&!I.isStopIncluded&&h.isStopIncluded?++i:++d}}return s},c.fromJulianDateArray=function(t,n){if(!a(t))throw new r("options is required.");if(!a(t.julianDates))throw new r("options.iso8601Array is required.");a(n)||(n=new c);var s,i=t.julianDates,d=i.length,l=t.dataCallback,p=e(t.isStartIncluded,!0),I=e(t.isStopIncluded,!0),h=e(t.leadingInterval,!1),v=e(t.trailingInterval,!1),f=0;h&&(++f,(s=new u({start:o.MINIMUM_VALUE,stop:i[0],isStartIncluded:!0,isStopIncluded:!p})).data=a(l)?l(s,n.length):n.length,n.addInterval(s));for(var S=0;S<d-1;++S){var g=i[S],m=i[S+1];(s=new u({start:g,stop:m,isStartIncluded:n.length!==f||p,isStopIncluded:S===d-2&&I})).data=a(l)?l(s,n.length):n.length,n.addInterval(s),g=m}return v&&((s=new u({start:i[d-1],stop:o.MAXIMUM_VALUE,isStartIncluded:!I,isStopIncluded:!0})).data=a(l)?l(s,n.length):n.length,n.addInterval(s)),n};var h=new i,v=[0,31,28,31,30,31,30,31,31,30,31,30,31];function f(t,e,n){a(n)||(n=new l),l.toGregorianDate(t,h);var r=h.millisecond+e.millisecond,s=h.second+e.second,i=h.minute+e.minute,o=h.hour+e.hour,u=h.day+e.day,p=h.month+e.month,c=h.year+e.year;for(r>=1e3&&(s+=Math.floor(r/1e3),r%=1e3),s>=60&&(i+=Math.floor(s/60),s%=60),i>=60&&(o+=Math.floor(i/60),i%=60),o>=24&&(u+=Math.floor(o/24),o%=24),v[2]=d(c)?29:28;u>v[p]||p>=13;)u>v[p]&&(u-=v[p],++p),p>=13&&(--p,c+=Math.floor(p/12),p%=12,++p),v[2]=d(c)?29:28;return h.millisecond=r,h.second=s,h.minute=i,h.hour=o,h.day=u,h.month=p,h.year=c,l.fromGregorianDate(h,n)}var S=new l,g=/P(?:([\d.,]+)Y)?(?:([\d.,]+)M)?(?:([\d.,]+)W)?(?:([\d.,]+)D)?(?:T(?:([\d.,]+)H)?(?:([\d.,]+)M)?(?:([\d.,]+)S)?)?/;function m(t,e){if(!a(t)||0===t.length)return!1;if(e.year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,e.millisecond=0,"P"===t[0]){var n=t.match(g);if(!a(n))return!1;if(a(n[1])&&(e.year=Number(n[1].replace(",","."))),a(n[2])&&(e.month=Number(n[2].replace(",","."))),a(n[3])&&(e.day=7*Number(n[3].replace(",","."))),a(n[4])&&(e.day+=Number(n[4].replace(",","."))),a(n[5])&&(e.hour=Number(n[5].replace(",","."))),a(n[6])&&(e.minute=Number(n[6].replace(",","."))),a(n[7])){var r=Number(n[7].replace(",","."));e.second=Math.floor(r),e.millisecond=r%1*1e3}}else"Z"!==t[t.length-1]&&(t+="Z"),l.toGregorianDate(l.fromIso8601(t,S),e);return e.year||e.month||e.day||e.hour||e.minute||e.second||e.millisecond}var w=new i;return c.fromIso8601=function(t,e){if(!a(t))throw new r("options is required.");if(!a(t.iso8601))throw new r("options.iso8601 is required.");var n=t.iso8601.split("/"),s=l.fromIso8601(n[0]),i=l.fromIso8601(n[1]),d=[];if(m(n[2],w)){var o=l.clone(s);for(d.push(o);l.compare(o,i)<0;){o=f(o,w),l.compare(i,o)<=0&&l.clone(i,o),d.push(o)}}else d.push(s,i);return c.fromJulianDateArray({julianDates:d,isStartIncluded:t.isStartIncluded,isStopIncluded:t.isStopIncluded,leadingInterval:t.leadingInterval,trailingInterval:t.trailingInterval,dataCallback:t.dataCallback},e)},c.fromIso8601DateArray=function(t,e){if(!a(t))throw new r("options is required.");if(!a(t.iso8601Dates))throw new r("options.iso8601Dates is required.");return c.fromJulianDateArray({julianDates:t.iso8601Dates.map(function(t){return l.fromIso8601(t)}),isStartIncluded:t.isStartIncluded,isStopIncluded:t.isStopIncluded,leadingInterval:t.leadingInterval,trailingInterval:t.trailingInterval,dataCallback:t.dataCallback},e)},c.fromIso8601DurationArray=function(t,n){if(!a(t))throw new r("options is required.");if(!a(t.epoch))throw new r("options.epoch is required.");if(!a(t.iso8601Durations))throw new r("options.iso8601Durations is required.");for(var s,i,d=t.epoch,o=t.iso8601Durations,l=e(t.relativeToPrevious,!1),u=[],p=o.length,I=0;I<p;++I)(m(o[I],w)||0===I)&&(s=l&&a(i)?f(i,w):f(d,w),u.push(s),i=s);return c.fromJulianDateArray({julianDates:u,isStartIncluded:t.isStartIncluded,isStopIncluded:t.isStopIncluded,leadingInterval:t.leadingInterval,trailingInterval:t.trailingInterval,dataCallback:t.dataCallback},n)},c});