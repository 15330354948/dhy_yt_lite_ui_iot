define(["../layers/GraphicsLayer","../others/EventDrive","../symbols/TextSymbol","../symbols/PrimitiveSymbol","../Graphic","../_Color","../../Source/Core/Color","../../Source/Core/Cartesian2","../../Source/Core/Cartesian3"],function(e,t,i,s,r,n,o,h,l){function c(i){this.viewer=i.viewer,this.layer=new e,this.circles=[],this.path=[],this.height=[],this.btn=null,this.lines=null,this.point=this.viewer.entities.add({point:{color:o.RED,pixelSize:10}}),this.event=new t({viewer:this.viewer,eventType:"left_click",callBack:e=>{let t=this.path,i=this.movePoint.mapPoint.longitude,n=this.movePoint.mapPoint.latitude,o=this.movePoint.mapPoint.height;if(o<-50)return;t.push(i,n),this.height.push(o);t.length;let h=new r({symbol:{type:"point-3d",style:{type:"cone",height:60,width:30,color:"#4af99d"}},geometry:{type:"point",longitude:i,latitude:n,height:o+30}}),l=new s({type:"circle",center:[i,n],radius:.5,color:"#4af99d",class:"both"}),c=new s({type:t.length>4?"":"line",ranges:t,color:"rgba(255, 0, 0, .8)",width:1,class:"both"});this.layer.add(h),this.lines&&this.viewer.map.remove(this.lines),this.circles.push(l),this.lines=c,this.viewer.map.add(c),this.viewer.map.add(l),this.viewer.scene.requestRenderMode=!1}}),this.mouseMove=new t({eventType:"mouse_move",viewer:i.viewer,callBack:e=>{this.movePoint=e,this.point&&(this.point.position=e.cartesian)}}),this.rightClick=new t({viewer:this.viewer,eventType:"right_click",callBack:e=>{let t=this.path,s=t.length;if(t.length>=6){this.event.destroy(),this.viewer.entities.remove(this.point),this.rightClick.destroy();let e=this.btn=document.getElementById("boxSelectBtn")||(()=>{let e=document.querySelector(".libras-viewer"),t=document.createElement("button");return t.style.cssText="position:absolute;z-index:100000;padding:5px;border:1px solid #ccc;border-radius:4px;cursor:pointer",t.id="boxSelectBtn",t.innerText="查询",e.appendChild(t),t.addEventListener("click",()=>{this.btn.remove(),i.callBack&&i.callBack(this.path)}),t})(),r=this.height,n=r.reduce((e,t,i)=>e+t)/r.length,o=0,c=0;for(let e=t.length-1;e>=0;e-=2)o+=t[e-1],c+=t[e];this.viewer.scene.preRender.addEventListener(()=>{let t=l.fromDegrees(o/(s/2),c/(s/2),n+50),i=this.viewer.scene.cartesianToCanvasCoordinates(t,new h);i&&(e.style.top=i.y+"px",e.style.left=i.x+"px")})}}})}return c.prototype.destroy=function(){this.viewer.map.remove(this.lines),this.viewer.entities.remove(this.point),this.circles.forEach(e=>this.viewer.map.remove(e)),this.event.destroy(),this.btn&&this.btn.remove(),this.rightClick.destroy(),this.mouseMove.destroy(),this.height=[],this.circles=[],this.point=null,this.path=[]},c});