define(["../Core/Cartesian3","../Core/defined","../Core/Math","./SceneMode"],function(e,r,i,t){"use strict";function n(){this.enabled=!0,this.density=2e-4,this.screenSpaceErrorFactor=2,this.minimumBrightness=.03}for(var o=[359.393,800.749,1275.6501,2151.1192,3141.7763,4777.5198,6281.2493,12364.307,15900.765,49889.0549,78026.8259,99260.7344,120036.3873,151011.0158,156091.1953,203849.3112,274866.9803,319916.3149,493552.0528,628733.5874],s=[2e-5,2e-4,1e-4,7e-5,5e-5,4e-5,3e-5,19e-6,1e-5,85e-7,62e-7,58e-7,53e-7,52e-7,51e-7,42e-7,4e-6,34e-7,26e-7,22e-7],a=0;a<s.length;++a)s[a]*=1e6;for(var f=s[1],h=s[s.length-1],c=0;c<s.length;++c)s[c]=(s[c]-h)/(f-h);var u=0;var d=new e;return n.prototype.update=function(n){if(n.fog.enabled=this.enabled){var a=n.camera,c=a.positionCartographic;if(!r(c)||c.height>8e5||n.mode!==t.SCENE3D)n.fog.enabled=!1;else{var g=c.height,l=function(e){var r,i=o,t=i.length;if(e<i[0])return u=0;if(e>i[t-1])return u=t-2;if(e>=i[u]){if(u+1<t&&e<i[u+1])return u;if(u+2<t&&e<i[u+2])return++u}else if(u-1>=0&&e>=i[u-1])return--u;for(r=0;r<t-2&&!(e>=i[r]&&e<i[r+1]);++r);return u=r}(g),m=i.clamp((g-o[l])/(o[l+1]-o[l]),0,1),p=i.lerp(s[l],s[l+1],m),v=1e6*this.density;p=p*(v-v/f*h)*1e-6;var C=e.normalize(a.positionWC,d);p*=1-Math.abs(e.dot(a.directionWC,C)),n.fog.density=p,n.fog.sse=this.screenSpaceErrorFactor,n.fog.minimumBrightness=this.minimumBrightness}}},n});