define(["../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defined","../Core/DeveloperError","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/GeometryInstance","../Core/Iso8601","../Core/ShowGeometryInstanceAttribute","../Core/WallGeometry","../Core/WallOutlineGeometry","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","./ColorMaterialProperty","./DynamicGeometryUpdater","./GeometryUpdater","./Property"],function(t,e,i,o,n,r,s,a,l,p,m,u,y,c,h,d,g){"use strict";var C=new e;function _(t,e){d.call(this,{entity:t,scene:e,geometryOptions:new function(t){this.id=t,this.vertexFormat=void 0,this.positions=void 0,this.minimumHeights=void 0,this.maximumHeights=void 0,this.granularity=void 0}(t),geometryPropertyName:"wall",observedPropertyNames:["availability","wall"]}),this._onEntityPropertyChanged(t,"wall",t.wall,void 0)}function f(t,e,i){h.call(this,t,e,i)}return o(Object.create)&&(_.prototype=Object.create(d.prototype),_.prototype.constructor=_),_.prototype.createFillGeometryInstance=function(a){if(t.defined("time",a),!this._fillEnabled)throw new n("This instance does not represent a filled geometry.");var m,u,y=this._entity,h=y.isAvailable(a),d=new l(h&&y.isShowing&&this._showProperty.getValue(a)&&this._fillProperty.getValue(a)),g=this._distanceDisplayConditionProperty.getValue(a),_=r.fromDistanceDisplayCondition(g);this._materialProperty instanceof c?(o(this._materialProperty.color)&&(this._materialProperty.color.isConstant||h)&&(u=this._materialProperty.color.getValue(a,C)),o(u)||(u=e.WHITE),m={show:d,distanceDisplayCondition:_,color:i.fromColor(u)}):m={show:d,distanceDisplayCondition:_};return new s({id:y,geometry:new p(this._options),attributes:m})},_.prototype.createOutlineGeometryInstance=function(o){if(t.defined("time",o),!this._outlineEnabled)throw new n("This instance does not represent an outlined geometry.");var a=this._entity,p=a.isAvailable(o),u=g.getValueOrDefault(this._outlineColorProperty,o,e.BLACK,C),y=this._distanceDisplayConditionProperty.getValue(o);return new s({id:a,geometry:new m(this._options),attributes:{show:new l(p&&a.isShowing&&this._showProperty.getValue(o)&&this._showOutlineProperty.getValue(o)),color:i.fromColor(u),distanceDisplayCondition:r.fromDistanceDisplayCondition(y)}})},_.prototype._isHidden=function(t,e){return!o(e.positions)||d.prototype._isHidden.call(this,t,e)},_.prototype._getIsClosed=function(t){return!1},_.prototype._isDynamic=function(t,e){return!(e.positions.isConstant&&g.isConstant(e.minimumHeights)&&g.isConstant(e.maximumHeights)&&g.isConstant(e.outlineWidth)&&g.isConstant(e.granularity))},_.prototype._setStaticOptions=function(t,e){var i=e.minimumHeights,n=e.maximumHeights,r=e.granularity,s=this._materialProperty instanceof c,l=this._options;l.vertexFormat=s?y.VERTEX_FORMAT:u.MaterialSupport.TEXTURED.vertexFormat,l.positions=e.positions.getValue(a.MINIMUM_VALUE,l.positions),l.minimumHeights=o(i)?i.getValue(a.MINIMUM_VALUE,l.minimumHeights):void 0,l.maximumHeights=o(n)?n.getValue(a.MINIMUM_VALUE,l.maximumHeights):void 0,l.granularity=o(r)?r.getValue(a.MINIMUM_VALUE):void 0},_.DynamicGeometryUpdater=f,o(Object.create)&&(f.prototype=Object.create(h.prototype),f.prototype.constructor=f),f.prototype._isHidden=function(t,e,i){return!o(this._options.positions)||h.prototype._isHidden.call(this,t,e,i)},f.prototype._setOptions=function(t,e,i){var o=this._options;o.positions=g.getValueOrUndefined(e.positions,i,o.positions),o.minimumHeights=g.getValueOrUndefined(e.minimumHeights,i,o.minimumHeights),o.maximumHeights=g.getValueOrUndefined(e.maximumHeights,i,o.maximumHeights),o.granularity=g.getValueOrUndefined(e.granularity,i)},_});