define(["../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/DeveloperError","../../Core/EllipsoidTerrainProvider","../../Core/isArray","../../ThirdParty/knockout","../createCommand"],function(e,r,i,t,o,s,n,a){"use strict";function d(i){var d=(i=e(i,e.EMPTY_OBJECT)).globe,l=e(i.imageryProviderViewModels,[]),v=e(i.terrainProviderViewModels,[]);if(!r(d))throw new t("globe is required");this._globe=d,this.imageryProviderViewModels=l.slice(0),this.terrainProviderViewModels=v.slice(0),this.dropDownVisible=!1,n.track(this,["imageryProviderViewModels","terrainProviderViewModels","dropDownVisible"]);var g=n.getObservable(this,"imageryProviderViewModels"),h=n.pureComputed(function(){var e,i=g(),t={};for(e=0;e<i.length;e++){var o=i[e],s=o.category;r(t[s])?t[s].push(o):t[s]=[o]}var n=Object.keys(t),a=[];for(e=0;e<n.length;e++){var d=n[e];a.push({name:d,providers:t[d]})}return a});this._imageryProviders=h;var c=n.getObservable(this,"terrainProviderViewModels"),u=n.pureComputed(function(){var e,i=c(),t={};for(e=0;e<i.length;e++){var o=i[e],s=o.category;r(t[s])?t[s].push(o):t[s]=[o]}var n=Object.keys(t),a=[];for(e=0;e<n.length;e++){var d=n[e];a.push({name:d,providers:t[d]})}return a});this._terrainProviders=u,this.buttonTooltip=void 0,n.defineProperty(this,"buttonTooltip",function(){var e=this.selectedImagery,i=this.selectedTerrain,t=r(e)?e.name:void 0,o=r(i)?i.name:void 0;return r(t)&&r(o)?t+"\n"+o:r(t)?t:o}),this.buttonImageUrl=void 0,n.defineProperty(this,"buttonImageUrl",function(){var e=this.selectedImagery;if(r(e))return e.iconUrl}),this.selectedImagery=void 0;var f=n.observable();this._currentImageryProviders=[],n.defineProperty(this,"selectedImagery",{get:function(){return f()},set:function(e){if(f()!==e){var i,t=this._currentImageryProviders,o=t.length,n=this._globe.imageryLayers,a=!1;for(i=0;i<o;i++)for(var d=n.length,l=0;l<d;l++){var v=n.get(l);if(v.imageryProvider===t[i]){n.remove(v),a=!0;break}}if(r(e)){var g=e.creationCommand();if(s(g)){for(i=g.length-1;i>=0;i--)n.addImageryProvider(g[i],0);this._currentImageryProviders=g.slice(0)}else if(this._currentImageryProviders=[g],a)n.addImageryProvider(g,0);else{var h=n.get(0);r(h)&&n.remove(h),n.addImageryProvider(g,0)}}f(e),this.dropDownVisible=!1}else this.dropDownVisible=!1}}),this.selectedTerrain=void 0;var m=n.observable();n.defineProperty(this,"selectedTerrain",{get:function(){return m()},set:function(e){var i;m()!==e?(r(e)&&(i=e.creationCommand()),this._globe.depthTestAgainstTerrain=!(i instanceof o),this._globe.terrainProvider=i,m(e),this.dropDownVisible=!1):this.dropDownVisible=!1}});var p=this;this._toggleDropDown=a(function(){p.dropDownVisible=!p.dropDownVisible}),this.selectedImagery=e(i.selectedImageryProviderViewModel,l[0]),this.selectedTerrain=e(i.selectedTerrainProviderViewModel,v[0])}return i(d.prototype,{toggleDropDown:{get:function(){return this._toggleDropDown}},globe:{get:function(){return this._globe}}}),d});