define(["../Core/Check","../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject"],function(e,t,n,s,i,r){"use strict";function d(i){i=n(i,n.EMPTY_OBJECT),e.defined("options.stages",i.stages),e.typeOf.number.greaterThan("options.stages.length",i.stages.length,0),this._stages=i.stages,this._inputPreviousStageTexture=n(i.inputPreviousStageTexture,!0);var r=i.name;s(r)||(r=t()),this._name=r,this._uniforms=i.uniforms,this._textureCache=void 0,this._index=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0}return i(d.prototype,{ready:{get:function(){for(var e=this._stages,t=e.length,n=0;n<t;++n)if(!e[n].ready)return!1;return!0}},name:{get:function(){return this._name}},enabled:{get:function(){return this._stages[0].enabled},set:function(e){for(var t=this._stages,n=t.length,s=0;s<n;++s)t[s].enabled=e}},uniforms:{get:function(){return this._uniforms}},inputPreviousStageTexture:{get:function(){return this._inputPreviousStageTexture}},length:{get:function(){return this._stages.length}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}}),d.prototype._isSupported=function(e){for(var t=this._stages,n=t.length,s=0;s<n;++s)if(!t[s]._isSupported(e))return!1;return!0},d.prototype.get=function(t){return e.typeOf.number.greaterThanOrEquals("index",t,0),e.typeOf.number.lessThan("index",t,this.length),this._stages[t]},d.prototype.update=function(e,t){this._selectedDirty=function(e){var t=s(e._selected)?e._selected.length:0,n=s(e._parentSelected)?e._parentSelected:0,i=e._selected!==e._selectedShadow||t!==e._selectedLength;if(i=i||e._parentSelected!==e._parentSelectedShadow||n!==e._parentSelectedLength,s(e._selected)&&s(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):s(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!i&&s(e._combinedSelected)){if(!s(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(var r=0;r<t;++r)if(e._combinedSelected[r]!==e._combinedSelectedShadow[r])return!0}return i}(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=s(this._selected)?this._selected.length:0,this._parentSelectedLength=s(this._parentSelected)?this._parentSelected.length:0;for(var n=this._stages,i=n.length,r=0;r<i;++r){var d=n[r];this._selectedDirty&&(d.parentSelected=this._combinedSelected),d.update(e,t)}},d.prototype.isDestroyed=function(){return!1},d.prototype.destroy=function(){for(var e=this._stages,t=e.length,n=0;n<t;++n)e[n].destroy();return r(this)},d});