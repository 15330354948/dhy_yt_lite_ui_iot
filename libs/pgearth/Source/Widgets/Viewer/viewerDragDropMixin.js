define(["../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/DeveloperError","../../Core/Event","../../Core/wrapFunction","../../DataSources/CzmlDataSource","../../DataSources/GeoJsonDataSource","../../DataSources/KmlDataSource","../getElement"],function(e,r,n,o,t,a,i,d,s,u){"use strict";function c(e){e.stopPropagation(),e.preventDefault()}function f(e,n){var o=e;r(o)&&(o.removeEventListener("drop",n,!1),o.removeEventListener("dragenter",c,!1),o.removeEventListener("dragover",c,!1),o.removeEventListener("dragexit",c,!1))}function l(e,r){e.addEventListener("drop",r,!1),e.addEventListener("dragenter",c,!1),e.addEventListener("dragover",c,!1),e.addEventListener("dragexit",c,!1)}function p(e,n,o,t){var a=e.scene;return function(u){var c=n.name;try{var f;if(/\.czml$/i.test(c))f=i.load(JSON.parse(u.target.result),{sourceUri:c});else if(/\.geojson$/i.test(c)||/\.json$/i.test(c)||/\.topojson$/i.test(c))f=d.load(JSON.parse(u.target.result),{sourceUri:c,clampToGround:t});else{if(!/\.(kml|kmz)$/i.test(c))return void e.dropError.raiseEvent(e,c,"Unrecognized file: "+c);f=s.load(n,{sourceUri:c,proxy:o,camera:a.camera,canvas:a.canvas,clampToGround:t})}r(f)&&e.dataSources.add(f).then(function(r){e.flyToOnDrop&&e.flyTo(r)}).otherwise(function(r){e.dropError.raiseEvent(e,c,r)})}catch(r){e.dropError.raiseEvent(e,c,r)}}}function v(e,r){return function(n){e.dropError.raiseEvent(e,r.name,n.target.error)}}return function(i,d){if(!r(i))throw new o("viewer is required.");if(i.hasOwnProperty("dropTarget"))throw new o("dropTarget is already defined by another mixin.");if(i.hasOwnProperty("dropEnabled"))throw new o("dropEnabled is already defined by another mixin.");if(i.hasOwnProperty("dropError"))throw new o("dropError is already defined by another mixin.");if(i.hasOwnProperty("clearOnDrop"))throw new o("clearOnDrop is already defined by another mixin.");if(i.hasOwnProperty("flyToOnDrop"))throw new o("flyToOnDrop is already defined by another mixin.");d=e(d,e.EMPTY_OBJECT);var s=!0,E=e(d.flyToOnDrop,!0),y=new t,g=e(d.clearOnDrop,!0),m=e(d.dropTarget,i.container),w=e(d.clampToGround,!0),h=d.proxy;function D(e){c(e),g&&(i.entities.removeAll(),i.dataSources.removeAll());for(var r=e.dataTransfer.files,n=r.length,o=0;o<n;o++){var t=r[o],a=new FileReader;a.onload=p(i,t,h,w),a.onerror=v(i,t),a.readAsText(t)}}m=u(m),n(i,{dropTarget:{get:function(){return m},set:function(e){if(!r(e))throw new o("value is required.");f(m,D),l(m=e,D)}},dropEnabled:{get:function(){return s},set:function(e){e!==s&&(e?l(m,D):f(m,D),s=e)}},dropError:{get:function(){return y}},clearOnDrop:{get:function(){return g},set:function(e){g=e}},flyToOnDrop:{get:function(){return E},set:function(e){E=e}},proxy:{get:function(){return h},set:function(e){h=e}},clampToGround:{get:function(){return w},set:function(e){w=e}}}),l(m,D),i.destroy=a(i,i.destroy,function(){i.dropEnabled=!1}),i._handleDrop=D}});