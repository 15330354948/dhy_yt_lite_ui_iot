define(["./addToArray","./ForEach","./getAccessorByteStride","../../Core/defaultValue","../../Core/defined","../../Core/WebGLConstants"],function(e,a,t,r,n,i){"use strict";function s(e){n(e)&&(e.texCoord=r(e.texCoord,0))}return function(o){a.accessor(o,function(e){n(e.bufferView)&&(e.byteOffset=r(e.byteOffset,0))}),a.bufferView(o,function(e){n(e.buffer)&&(e.byteOffset=r(e.byteOffset,0))}),a.mesh(o,function(t){a.meshPrimitive(t,function(a){a.mode=r(a.mode,i.TRIANGLES),n(a.material)||(n(o.materials)||(o.materials=[]),a.material=e(o.materials,{name:"default"}))})}),a.accessorContainingVertexAttributeData(o,function(e){var a=o.accessors[e],s=a.bufferView;if(a.normalized=r(a.normalized,!1),n(s)){var c=o.bufferViews[s];c.byteStride=t(o,a),c.target=i.ARRAY_BUFFER}}),a.accessorContainingIndexData(o,function(e){var a=o.accessors[e].bufferView;n(a)&&(o.bufferViews[a].target=i.ELEMENT_ARRAY_BUFFER)}),a.material(o,function(e){var t=r(e.extensions,r.EMPTY_OBJECT),i=t.KHR_materials_common;if(n(i)){var o=i.technique,c=n(i.values)?i.values:{};return i.values=c,c.ambient=n(c.ambient)?c.ambient:[0,0,0,1],c.emission=n(c.emission)?c.emission:[0,0,0,1],c.transparency=r(c.transparency,1),c.transparent=r(c.transparent,!1),c.doubleSided=r(c.doubleSided,!1),void("CONSTANT"!==o&&(c.diffuse=n(c.diffuse)?c.diffuse:[0,0,0,1],"LAMBERT"!==o&&(c.specular=n(c.specular)?c.specular:[0,0,0,1],c.shininess=r(c.shininess,0))))}e.emissiveFactor=r(e.emissiveFactor,[0,0,0]),e.alphaMode=r(e.alphaMode,"OPAQUE"),e.doubleSided=r(e.doubleSided,!1),"MASK"===e.alphaMode&&(e.alphaCutoff=r(e.alphaCutoff,.5));var u=t.KHR_techniques_webgl;n(u)&&a.materialValue(e,function(e){n(e.index)&&s(e)}),s(e.emissiveTexture),s(e.normalTexture),s(e.occlusionTexture);var l=e.pbrMetallicRoughness;n(l)&&(l.baseColorFactor=r(l.baseColorFactor,[1,1,1,1]),l.metallicFactor=r(l.metallicFactor,1),l.roughnessFactor=r(l.roughnessFactor,1),s(l.baseColorTexture),s(l.metallicRoughnessTexture));var f=t.pbrSpecularGlossiness;n(f)&&(f.diffuseFactor=r(f.diffuseFactor,[1,1,1,1]),f.specularFactor=r(f.specularFactor,[1,1,1]),f.glossinessFactor=r(f.glossinessFactor,1),s(f.specularGlossinessTexture))}),a.animation(o,function(e){a.animationSampler(e,function(e){e.interpolation=r(e.interpolation,"LINEAR")})});var c=function(e){var t={};return a.animation(e,function(e){a.animationChannel(e,function(e){var a=e.target,r=a.node,n=a.path;"translation"!==n&&"rotation"!==n&&"scale"!==n||(t[r]=!0)})}),t}(o);return a.node(o,function(e,a){n(c[a])||n(e.translation)||n(e.rotation)||n(e.scale)?(e.translation=r(e.translation,[0,0,0]),e.rotation=r(e.rotation,[0,0,0,1]),e.scale=r(e.scale,[1,1,1])):e.matrix=r(e.matrix,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}),a.sampler(o,function(e){e.wrapS=r(e.wrapS,i.REPEAT),e.wrapT=r(e.wrapT,i.REPEAT)}),n(o.scenes)&&!n(o.scene)&&(o.scene=0),o}});