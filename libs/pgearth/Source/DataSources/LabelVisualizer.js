define(["../Core/AssociativeArray","../Core/Cartesian2","../Core/Cartesian3","../Core/Color","../Core/defaultValue","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Core/DistanceDisplayCondition","../Core/NearFarScalar","../Scene/HeightReference","../Scene/HorizontalOrigin","../Scene/LabelStyle","../Scene/VerticalOrigin","./BoundingSphereState","./Property"],function(e,t,i,n,r,l,o,a,s,u,c,d,f,g,h,_){"use strict";var C=f.FILL,p=n.WHITE,O=n.BLACK,y=new n(.165,.165,.165,.8),D=new t(7,5),w=t.ZERO,v=i.ZERO,V=c.NONE,b=d.CENTER,E=g.CENTER,m=new i,S=new n,B=new n,L=new n,x=new t,R=new i,U=new t,k=new u,q=new u,N=new u,A=new s;function T(e){this.entity=e,this.label=void 0,this.index=void 0}function P(t,i){if(!l(t))throw new a("entityCluster is required.");if(!l(i))throw new a("entityCollection is required.");i.collectionChanged.addEventListener(P.prototype._onCollectionChanged,this),this._cluster=t,this._entityCollection=i,this._items=new e,this._onCollectionChanged(i,i.values,[],[])}function z(e,t,i){l(e)&&(e.label=void 0,i.removeLabel(t))}return P.prototype.update=function(e){if(!l(e))throw new a("time is required.");for(var t=this._items.values,n=this._cluster,r=0,o=t.length;r<o;r++){var s,u,c=t[r],d=c.entity,f=d._label,g=c.label,h=d.isShowing&&d.isAvailable(e)&&_.getValueOrDefault(f._show,e,!0);if(h&&(u=_.getValueOrUndefined(d._position,e,m),s=_.getValueOrUndefined(f._text,e),h=l(u)&&l(s)),h){_.isConstant(d._position)||(n._clusterDirty=!0);var T=!1,P=_.getValueOrDefault(f._heightReference,e,V);l(g)||((g=n.getLabel(d)).id=d,c.label=g,T=i.equals(g.position,u)&&g.heightReference===P),g.show=!0,g.position=u,g.text=s,g.scale=_.getValueOrDefault(f._scale,e,1),g.font=_.getValueOrDefault(f._font,e,"30px sans-serif"),g.style=_.getValueOrDefault(f._style,e,C),g.fillColor=_.getValueOrDefault(f._fillColor,e,p,S),g.outlineColor=_.getValueOrDefault(f._outlineColor,e,O,B),g.outlineWidth=_.getValueOrDefault(f._outlineWidth,e,1),g.showBackground=_.getValueOrDefault(f._showBackground,e,!1),g.backgroundColor=_.getValueOrDefault(f._backgroundColor,e,y,L),g.backgroundPadding=_.getValueOrDefault(f._backgroundPadding,e,D,x),g.pixelOffset=_.getValueOrDefault(f._pixelOffset,e,w,U),g.eyeOffset=_.getValueOrDefault(f._eyeOffset,e,v,R),g.heightReference=P,g.horizontalOrigin=_.getValueOrDefault(f._horizontalOrigin,e,b),g.verticalOrigin=_.getValueOrDefault(f._verticalOrigin,e,E),g.translucencyByDistance=_.getValueOrUndefined(f._translucencyByDistance,e,k),g.pixelOffsetScaleByDistance=_.getValueOrUndefined(f._pixelOffsetScaleByDistance,e,q),g.scaleByDistance=_.getValueOrUndefined(f._scaleByDistance,e,N),g.distanceDisplayCondition=_.getValueOrUndefined(f._distanceDisplayCondition,e,A),g.disableDepthTestDistance=_.getValueOrUndefined(f._disableDepthTestDistance,e),T&&g._updateClamping()}else z(c,d,n)}return!0},P.prototype.getBoundingSphere=function(e,t){if(!l(e))throw new a("entity is required.");if(!l(t))throw new a("result is required.");var n=this._items.get(e.id);if(!l(n)||!l(n.label))return h.FAILED;var o=n.label;return t.center=i.clone(r(o._clampedPosition,o.position),t.center),t.radius=0,h.DONE},P.prototype.isDestroyed=function(){return!1},P.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(P.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removeLabel(e[t]);return o(this)},P.prototype._onCollectionChanged=function(e,t,i,n){var r,o,a=this._items,s=this._cluster;for(r=t.length-1;r>-1;r--)o=t[r],l(o._label)&&l(o._position)&&a.set(o.id,new T(o));for(r=n.length-1;r>-1;r--)o=n[r],l(o._label)&&l(o._position)?a.contains(o.id)||a.set(o.id,new T(o)):(z(a.get(o.id),o,s),a.remove(o.id));for(r=i.length-1;r>-1;r--)o=i[r],z(a.get(o.id),o,s),a.remove(o.id)},P});