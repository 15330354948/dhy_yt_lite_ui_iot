define(["../Core/Check","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/PixelFormat","./ContextLimits","./PixelDatatype"],function(e,t,r,n,o,h,i,f,s){"use strict";function u(e,t,r){var n=e._gl;n.framebufferTexture2D(n.FRAMEBUFFER,t,r._target,r._texture,0)}function d(e,t,r){var n=e._gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,t,n.RENDERBUFFER,r._getRenderbuffer())}function l(n){var o=(n=t(n,t.EMPTY_OBJECT)).context;e.defined("options.context",o);var l=o._gl,a=f.maximumColorAttachments;if(this._gl=l,this._framebuffer=l.createFramebuffer(),this._colorTextures=[],this._colorRenderbuffers=[],this._activeColorAttachments=[],this._depthTexture=void 0,this._depthRenderbuffer=void 0,this._stencilRenderbuffer=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this.destroyAttachments=t(n.destroyAttachments,!0),r(n.colorTextures)&&r(n.colorRenderbuffers))throw new h("Cannot have both color texture and color renderbuffer attachments.");if(r(n.depthTexture)&&r(n.depthRenderbuffer))throw new h("Cannot have both a depth texture and depth renderbuffer attachment.");if(r(n.depthStencilTexture)&&r(n.depthStencilRenderbuffer))throw new h("Cannot have both a depth-stencil texture and depth-stencil renderbuffer attachment.");var c,_,p,b,T,x=r(n.depthTexture)||r(n.depthRenderbuffer),m=r(n.depthStencilTexture)||r(n.depthStencilRenderbuffer);if(x&&m)throw new h("Cannot have both a depth and depth-stencil attachment.");if(r(n.stencilRenderbuffer)&&m)throw new h("Cannot have both a stencil and depth-stencil attachment.");if(x&&r(n.stencilRenderbuffer))throw new h("Cannot have both a depth and stencil attachment.");if(this._bind(),r(n.colorTextures)){var R=n.colorTextures;if((b=this._colorTextures.length=this._activeColorAttachments.length=R.length)>a)throw new h("The number of color attachments exceeds the number supported.");for(p=0;p<b;++p){if(c=R[p],!i.isColorFormat(c.pixelFormat))throw new h("The color-texture pixel-format must be a color format.");if(c.pixelDatatype===s.FLOAT&&!o.colorBufferFloat)throw new h("The color texture pixel datatype is FLOAT and the WebGL implementation does not support the EXT_color_buffer_float or WEBGL_color_buffer_float extensions. See Context.colorBufferFloat.");if(c.pixelDatatype===s.HALF_FLOAT&&!o.colorBufferHalfFloat)throw new h("The color texture pixel datatype is HALF_FLOAT and the WebGL implementation does not support the EXT_color_buffer_half_float extension. See Context.colorBufferHalfFloat.");u(this,T=this._gl.COLOR_ATTACHMENT0+p,c),this._activeColorAttachments[p]=T,this._colorTextures[p]=c}}if(r(n.colorRenderbuffers)){var C=n.colorRenderbuffers;if((b=this._colorRenderbuffers.length=this._activeColorAttachments.length=C.length)>a)throw new h("The number of color attachments exceeds the number supported.");for(p=0;p<b;++p)_=C[p],d(this,T=this._gl.COLOR_ATTACHMENT0+p,_),this._activeColorAttachments[p]=T,this._colorRenderbuffers[p]=_}if(r(n.depthTexture)){if((c=n.depthTexture).pixelFormat!==i.DEPTH_COMPONENT)throw new h("The depth-texture pixel-format must be DEPTH_COMPONENT.");u(this,this._gl.DEPTH_ATTACHMENT,c),this._depthTexture=c}if(r(n.depthRenderbuffer)&&(_=n.depthRenderbuffer,d(this,this._gl.DEPTH_ATTACHMENT,_),this._depthRenderbuffer=_),r(n.stencilRenderbuffer)&&(_=n.stencilRenderbuffer,d(this,this._gl.STENCIL_ATTACHMENT,_),this._stencilRenderbuffer=_),r(n.depthStencilTexture)){if((c=n.depthStencilTexture).pixelFormat!==i.DEPTH_STENCIL)throw new h("The depth-stencil pixel-format must be DEPTH_STENCIL.");u(this,this._gl.DEPTH_STENCIL_ATTACHMENT,c),this._depthStencilTexture=c}r(n.depthStencilRenderbuffer)&&(_=n.depthStencilRenderbuffer,d(this,this._gl.DEPTH_STENCIL_ATTACHMENT,_),this._depthStencilRenderbuffer=_),this._unBind()}return n(l.prototype,{status:{get:function(){this._bind();var e=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER);return this._unBind(),e}},numberOfColorAttachments:{get:function(){return this._activeColorAttachments.length}},depthTexture:{get:function(){return this._depthTexture}},depthRenderbuffer:{get:function(){return this._depthRenderbuffer}},stencilRenderbuffer:{get:function(){return this._stencilRenderbuffer}},depthStencilTexture:{get:function(){return this._depthStencilTexture}},depthStencilRenderbuffer:{get:function(){return this._depthStencilRenderbuffer}},hasDepthAttachment:{get:function(){return!!(this.depthTexture||this.depthRenderbuffer||this.depthStencilTexture||this.depthStencilRenderbuffer)}}}),l.prototype._bind=function(){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer)},l.prototype._unBind=function(){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,null)},l.prototype._getActiveColorAttachments=function(){return this._activeColorAttachments},l.prototype.getColorTexture=function(e){if(!r(e)||e<0||e>=this._colorTextures.length)throw new h("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorTextures[e]},l.prototype.getColorRenderbuffer=function(e){if(!r(e)||e<0||e>=this._colorRenderbuffers.length)throw new h("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorRenderbuffers[e]},l.prototype.isDestroyed=function(){return!1},l.prototype.destroy=function(){if(this.destroyAttachments){for(var e=0,t=this._colorTextures,n=t.length;e<n;++e){var h=t[e];r(h)&&h.destroy()}var i=this._colorRenderbuffers;for(n=i.length,e=0;e<n;++e){var f=i[e];r(f)&&f.destroy()}this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy(),this._stencilRenderbuffer=this._stencilRenderbuffer&&this._stencilRenderbuffer.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()}return this._gl.deleteFramebuffer(this._framebuffer),o(this)},l});