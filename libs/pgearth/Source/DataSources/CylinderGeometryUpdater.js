define(["../Core/Cartesian3","../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/CylinderGeometry","../Core/CylinderOutlineGeometry","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/GeometryInstance","../Core/GeometryOffsetAttribute","../Core/Iso8601","../Core/OffsetGeometryInstanceAttribute","../Core/ShowGeometryInstanceAttribute","../Scene/HeightReference","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","./heightReferenceOnEntityPropertyChanged","./ColorMaterialProperty","./DynamicGeometryUpdater","./GeometryUpdater","./Property"],function(e,t,i,o,r,n,s,a,l,p,d,c,u,f,y,h,m,g,C,_,O,V,b){"use strict";var M=e.ZERO,R=new e,v=new e,P=new i;function U(e,t){V.call(this,{entity:e,scene:t,geometryOptions:new function(e){this.id=e,this.vertexFormat=void 0,this.length=void 0,this.topRadius=void 0,this.bottomRadius=void 0,this.slices=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}(e),geometryPropertyName:"cylinder",observedPropertyNames:["availability","position","orientation","cylinder"]}),this._onEntityPropertyChanged(e,"cylinder",e.cylinder,void 0)}function A(e,t,i){O.call(this,e,t,i)}return s(Object.create)&&(U.prototype=Object.create(V.prototype),U.prototype.constructor=U),a(U.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),U.prototype.createFillGeometryInstance=function(e){if(t.defined("time",e),!this._fillEnabled)throw new l("This instance does not represent a filled geometry.");var n,a=this._entity,c=a.isAvailable(e),u=new y(c&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),h=this._distanceDisplayConditionProperty.getValue(e),m={show:u,distanceDisplayCondition:p.fromDistanceDisplayCondition(h),color:void 0,offset:void 0};this._materialProperty instanceof _&&(s(this._materialProperty.color)&&(this._materialProperty.color.isConstant||c)&&(n=this._materialProperty.color.getValue(e,P)),s(n)||(n=i.WHITE),m.color=o.fromColor(n));return s(this._options.offsetAttribute)&&(m.offset=f.fromCartesian3(b.getValueOrDefault(this._terrainOffsetProperty,e,M,R))),new d({id:a,geometry:new r(this._options),modelMatrix:a.computeModelMatrixForHeightReference(e,a.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:m})},U.prototype.createOutlineGeometryInstance=function(e){if(t.defined("time",e),!this._outlineEnabled)throw new l("This instance does not represent an outlined geometry.");var r=this._entity,a=r.isAvailable(e),c=b.getValueOrDefault(this._outlineColorProperty,e,i.BLACK,P),u=this._distanceDisplayConditionProperty.getValue(e),h={show:new y(a&&r.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:o.fromColor(c),distanceDisplayCondition:p.fromDistanceDisplayCondition(u),offset:void 0};return s(this._options.offsetAttribute)&&(h.offset=f.fromCartesian3(b.getValueOrDefault(this._terrainOffsetProperty,e,M,R))),new d({id:r,geometry:new n(this._options),modelMatrix:r.computeModelMatrixForHeightReference(e,r.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:h})},U.prototype._computeCenter=function(e,t){return b.getValueOrUndefined(this._entity.position,e,t)},U.prototype._isHidden=function(e,t){return!s(e.position)||!s(t.length)||!s(t.topRadius)||!s(t.bottomRadius)||V.prototype._isHidden.call(this,e,t)},U.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&b.isConstant(e.orientation)&&t.length.isConstant&&t.topRadius.isConstant&&t.bottomRadius.isConstant&&b.isConstant(t.slices)&&b.isConstant(t.outlineWidth)&&b.isConstant(t.numberOfVerticalLines))},U.prototype._setStaticOptions=function(e,t){var i=b.getValueOrDefault(t.heightReference,u.MINIMUM_VALUE,h.NONE),o=this._options;o.vertexFormat=this._materialProperty instanceof _?g.VERTEX_FORMAT:m.MaterialSupport.TEXTURED.vertexFormat,o.length=t.length.getValue(u.MINIMUM_VALUE),o.topRadius=t.topRadius.getValue(u.MINIMUM_VALUE),o.bottomRadius=t.bottomRadius.getValue(u.MINIMUM_VALUE),o.slices=b.getValueOrUndefined(t.slices,u.MINIMUM_VALUE),o.numberOfVerticalLines=b.getValueOrUndefined(t.numberOfVerticalLines,u.MINIMUM_VALUE),o.offsetAttribute=i!==h.NONE?c.ALL:void 0},U.prototype._onEntityPropertyChanged=C,U.DynamicGeometryUpdater=A,s(Object.create)&&(A.prototype=Object.create(O.prototype),A.prototype.constructor=A),A.prototype._isHidden=function(e,t,i){var o=this._options,r=b.getValueOrUndefined(e.position,i,v);return!s(r)||!s(o.length)||!s(o.topRadius)||!s(o.bottomRadius)||O.prototype._isHidden.call(this,e,t,i)},A.prototype._setOptions=function(e,t,i){var o=b.getValueOrDefault(t.heightReference,i,h.NONE),r=this._options;r.length=b.getValueOrUndefined(t.length,i),r.topRadius=b.getValueOrUndefined(t.topRadius,i),r.bottomRadius=b.getValueOrUndefined(t.bottomRadius,i),r.slices=b.getValueOrUndefined(t.slices,i),r.numberOfVerticalLines=b.getValueOrUndefined(t.numberOfVerticalLines,i),r.offsetAttribute=o!==h.NONE?c.ALL:void 0},U});