define(["../Core/ApproximateTerrainHeights","../Core/Cartesian3","../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defined","../Core/DeveloperError","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/EllipseGeometry","../Core/EllipseOutlineGeometry","../Core/GeometryInstance","../Core/GeometryOffsetAttribute","../Core/Iso8601","../Core/OffsetGeometryInstanceAttribute","../Core/Rectangle","../Core/ShowGeometryInstanceAttribute","../Scene/GroundPrimitive","../Scene/HeightReference","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","./ColorMaterialProperty","./DynamicGeometryUpdater","./GeometryUpdater","./GroundGeometryUpdater","./Property"],function(e,t,i,r,o,n,s,a,l,u,d,p,h,c,f,m,y,g,M,O,_,C,V,A,U){"use strict";var x=new r,I=t.ZERO,v=new t,b=new f;function E(e,t){A.call(this,{entity:e,scene:t,geometryOptions:new function(e){this.id=e,this.vertexFormat=void 0,this.center=void 0,this.semiMajorAxis=void 0,this.semiMinorAxis=void 0,this.rotation=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}(e),geometryPropertyName:"ellipse",observedPropertyNames:["availability","position","ellipse"]}),this._onEntityPropertyChanged(e,"ellipse",e.ellipse,void 0)}function D(e,t,i){C.call(this,e,t,i)}return n(Object.create)&&(E.prototype=Object.create(A.prototype),E.prototype.constructor=E),E.prototype.createFillGeometryInstance=function(e){if(i.defined("time",e),!this._fillEnabled)throw new s("This instance does not represent a filled geometry.");var t,u=this._entity,p=u.isAvailable(e),h={show:new m(p&&u.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:a.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof _&&(n(this._materialProperty.color)&&(this._materialProperty.color.isConstant||p)&&(t=this._materialProperty.color.getValue(e,x)),n(t)||(t=r.WHITE),h.color=o.fromColor(t));return n(this._options.offsetAttribute)&&(h.offset=c.fromCartesian3(U.getValueOrDefault(this._terrainOffsetProperty,e,I,v))),new d({id:u,geometry:new l(this._options),attributes:h})},E.prototype.createOutlineGeometryInstance=function(e){if(i.defined("time",e),!this._outlineEnabled)throw new s("This instance does not represent an outlined geometry.");var t=this._entity,l=t.isAvailable(e),p=U.getValueOrDefault(this._outlineColorProperty,e,r.BLACK,x),h=this._distanceDisplayConditionProperty.getValue(e),f={show:new m(l&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:o.fromColor(p),distanceDisplayCondition:a.fromDistanceDisplayCondition(h),offset:void 0};return n(this._options.offsetAttribute)&&(f.offset=c.fromCartesian3(U.getValueOrDefault(this._terrainOffsetProperty,e,I,v))),new d({id:t,geometry:new u(this._options),attributes:f})},E.prototype._computeCenter=function(e,t){return U.getValueOrUndefined(this._entity.position,e,t)},E.prototype._isHidden=function(e,t){var i=e.position;return!n(i)||!n(t.semiMajorAxis)||!n(t.semiMinorAxis)||V.prototype._isHidden.call(this,e,t)},E.prototype._isDynamic=function(e,t){return!e.position.isConstant||!t.semiMajorAxis.isConstant||!t.semiMinorAxis.isConstant||!U.isConstant(t.rotation)||!U.isConstant(t.height)||!U.isConstant(t.extrudedHeight)||!U.isConstant(t.granularity)||!U.isConstant(t.stRotation)||!U.isConstant(t.outlineWidth)||!U.isConstant(t.numberOfVerticalLines)||!U.isConstant(t.zIndex)||this._onTerrain&&!U.isConstant(this._materialProperty)},E.prototype._setStaticOptions=function(t,i){var r=U.getValueOrUndefined(i.height,h.MINIMUM_VALUE),o=U.getValueOrDefault(i.heightReference,h.MINIMUM_VALUE,g.NONE),s=U.getValueOrUndefined(i.extrudedHeight,h.MINIMUM_VALUE),a=U.getValueOrDefault(i.extrudedHeightReference,h.MINIMUM_VALUE,g.NONE);n(s)&&!n(r)&&(r=0);var u=this._options;u.vertexFormat=this._materialProperty instanceof _?O.VERTEX_FORMAT:M.MaterialSupport.TEXTURED.vertexFormat,u.center=t.position.getValue(h.MINIMUM_VALUE,u.center),u.semiMajorAxis=i.semiMajorAxis.getValue(h.MINIMUM_VALUE,u.semiMajorAxis),u.semiMinorAxis=i.semiMinorAxis.getValue(h.MINIMUM_VALUE,u.semiMinorAxis),u.rotation=U.getValueOrUndefined(i.rotation,h.MINIMUM_VALUE),u.granularity=U.getValueOrUndefined(i.granularity,h.MINIMUM_VALUE),u.stRotation=U.getValueOrUndefined(i.stRotation,h.MINIMUM_VALUE),u.numberOfVerticalLines=U.getValueOrUndefined(i.numberOfVerticalLines,h.MINIMUM_VALUE),u.offsetAttribute=A.computeGeometryOffsetAttribute(r,o,s,a),u.height=A.getGeometryHeight(r,o),(s=A.getGeometryExtrudedHeight(s,a))===A.CLAMP_TO_GROUND&&(s=e.getMinimumMaximumHeights(l.computeRectangle(u,b)).minimumTerrainHeight),u.extrudedHeight=s},E.DynamicGeometryUpdater=D,n(Object.create)&&(D.prototype=Object.create(C.prototype),D.prototype.constructor=D),D.prototype._isHidden=function(e,t,i){var r=this._options;return!n(r.center)||!n(r.semiMajorAxis)||!n(r.semiMinorAxis)||C.prototype._isHidden.call(this,e,t,i)},D.prototype._setOptions=function(t,i,r){var o=this._options,s=U.getValueOrUndefined(i.height,r),a=U.getValueOrDefault(i.heightReference,r,g.NONE),u=U.getValueOrUndefined(i.extrudedHeight,r),d=U.getValueOrDefault(i.extrudedHeightReference,r,g.NONE);n(u)&&!n(s)&&(s=0),o.center=U.getValueOrUndefined(t.position,r,o.center),o.semiMajorAxis=U.getValueOrUndefined(i.semiMajorAxis,r),o.semiMinorAxis=U.getValueOrUndefined(i.semiMinorAxis,r),o.rotation=U.getValueOrUndefined(i.rotation,r),o.granularity=U.getValueOrUndefined(i.granularity,r),o.stRotation=U.getValueOrUndefined(i.stRotation,r),o.numberOfVerticalLines=U.getValueOrUndefined(i.numberOfVerticalLines,r),o.offsetAttribute=A.computeGeometryOffsetAttribute(s,a,u,d),o.height=A.getGeometryHeight(s,a),(u=A.getGeometryExtrudedHeight(u,d))===A.CLAMP_TO_GROUND&&(u=e.getMinimumMaximumHeights(l.computeRectangle(o,b)).minimumTerrainHeight),o.extrudedHeight=u},E});