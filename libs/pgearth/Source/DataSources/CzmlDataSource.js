define(["../Core/ArcType","../Core/BoundingRectangle","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartographic","../Core/ClockRange","../Core/ClockStep","../Core/Color","../Core/CornerType","../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/DistanceDisplayCondition","../Core/Ellipsoid","../Core/Event","../Core/ExtrapolationType","../Core/getFilenameFromUri","../Core/HermitePolynomialApproximation","../Core/isArray","../Core/Iso8601","../Core/JulianDate","../Core/LagrangePolynomialApproximation","../Core/LinearApproximation","../Core/Math","../Core/NearFarScalar","../Core/Quaternion","../Core/Rectangle","../Core/ReferenceFrame","../Core/Resource","../Core/RuntimeError","../Core/Spherical","../Core/TimeInterval","../Core/TimeIntervalCollection","../Scene/ColorBlendMode","../Scene/HeightReference","../Scene/HorizontalOrigin","../Scene/LabelStyle","../Scene/ShadowMode","../Scene/VerticalOrigin","../ThirdParty/Uri","../ThirdParty/when","./BillboardGraphics","./BoxGraphics","./CallbackProperty","./CheckerboardMaterialProperty","./ColorMaterialProperty","./CompositeMaterialProperty","./CompositePositionProperty","./CompositeProperty","./ConstantPositionProperty","./ConstantProperty","./CorridorGraphics","./CylinderGraphics","./DataSource","./DataSourceClock","./EllipseGraphics","./EllipsoidGraphics","./EntityCluster","./EntityCollection","./GridMaterialProperty","./ImageMaterialProperty","./LabelGraphics","./ModelGraphics","./NodeTransformationProperty","./PathGraphics","./PointGraphics","./PolygonGraphics","./PolylineArrowMaterialProperty","./PolylineDashMaterialProperty","./PolylineGlowMaterialProperty","./PolylineGraphics","./PolylineOutlineMaterialProperty","./PositionPropertyArray","./PropertyArray","./PropertyBag","./RectangleGraphics","./ReferenceProperty","./Rotation","./SampledPositionProperty","./SampledProperty","./StripeMaterialProperty","./StripeOrientation","./TimeIntervalCollectionPositionProperty","./TimeIntervalCollectionProperty","./VelocityOrientationProperty","./VelocityVectorProperty","./WallGraphics"],function(e,r,o,n,t,i,a,l,s,c,d,u,f,h,p,v,m,y,g,w,C,b,P,I,O,T,N,D,R,k,x,B,S,M,_,A,L,E,z,G,H,W,F,V,U,j,X,q,J,Z,Y,K,Q,$,ee,re,oe,ne,te,ie,ae,le,se,ce,de,ue,fe,he,pe,ve,me,ye,ge,we,Ce,be,Pe,Ie,Oe,Te,Ne,De,Re,ke,xe,Be,Se,Me,_e){"use strict";function Ae(){}var Le;function Ee(e,r){return"#"===r[0]&&(r=Le+r),Oe.fromString(e,r)}function ze(e,r,o){if(u(o.reference))return Ee(r,o.reference);if(u(o.velocityReference)){var t=Ee(r,o.velocityReference);switch(e){case n:case Ae:return new Me(t,e===Ae);case D:return new Se(t)}}throw new B(JSON.stringify(o)+" is not valid CZML.")}Ae.packedLength=n.packedLength,Ae.unpack=n.unpack,Ae.pack=n.pack;var Ge=new n,He=new S,We=new t,Fe=new M,Ve=new D;function Ue(e,r){var o=d(e.uri,e);return u(r)?r.getDerivedResource({url:o}):x.createIfNeeded(o)}function je(e){var r=e.cartesian;if(u(r))return r;var o=e.cartesianVelocity;if(u(o))return o;var t=e.unitCartesian;if(u(t))return t;var i=e.unitSpherical;if(u(i))return function(e){var r=e.length;if(He.magnitude=1,2===r)return He.clock=e[0],He.cone=e[1],n.fromSpherical(He,Ge),[Ge.x,Ge.y,Ge.z];for(var o=new Array(r/3*4),t=0,i=0;t<r;t+=3,i+=4)o[i]=e[t],He.clock=e[t+1],He.cone=e[t+2],n.fromSpherical(He,Ge),o[i+1]=Ge.x,o[i+2]=Ge.y,o[i+3]=Ge.z;return o}(i);var a=e.spherical;if(u(a))return function(e){var r=e.length;if(3===r)return He.clock=e[0],He.cone=e[1],He.magnitude=e[2],n.fromSpherical(He,Ge),[Ge.x,Ge.y,Ge.z];for(var o=new Array(r),t=0;t<r;t+=4)o[t]=e[t],He.clock=e[t+1],He.cone=e[t+2],He.magnitude=e[t+3],n.fromSpherical(He,Ge),o[t+1]=Ge.x,o[t+2]=Ge.y,o[t+3]=Ge.z;return o}(a);var l=e.cartographicRadians;if(u(l))return function(e){var r=e.length;if(3===r)return We.longitude=e[0],We.latitude=e[1],We.height=e[2],v.WGS84.cartographicToCartesian(We,Ge),[Ge.x,Ge.y,Ge.z];for(var o=new Array(r),n=0;n<r;n+=4)o[n]=e[n],We.longitude=e[n+1],We.latitude=e[n+2],We.height=e[n+3],v.WGS84.cartographicToCartesian(We,Ge),o[n+1]=Ge.x,o[n+2]=Ge.y,o[n+3]=Ge.z;return o}(l);var s=e.cartographicDegrees;if(u(s))return function(e){var r=e.length;if(3===r)return We.longitude=T.toRadians(e[0]),We.latitude=T.toRadians(e[1]),We.height=e[2],v.WGS84.cartographicToCartesian(We,Ge),[Ge.x,Ge.y,Ge.z];for(var o=new Array(r),n=0;n<r;n+=4)o[n]=e[n],We.longitude=T.toRadians(e[n+1]),We.latitude=T.toRadians(e[n+2]),We.height=e[n+3],v.WGS84.cartographicToCartesian(We,Ge),o[n+1]=Ge.x,o[n+2]=Ge.y,o[n+3]=Ge.z;return o}(s);throw new B(JSON.stringify(e)+" is not a valid CZML interval.")}function Xe(e,r){n.unpack(e,r,Ge),n.normalize(Ge,Ge),n.pack(Ge,e,r)}function qe(e,r){D.unpack(e,r,Ve),D.normalize(Ve,Ve),D.pack(Ve,e,r)}function Je(t){return"boolean"==typeof t?Boolean:"number"==typeof t?Number:"string"==typeof t?String:t.hasOwnProperty("array")?Array:t.hasOwnProperty("boolean")?Boolean:t.hasOwnProperty("boundingRectangle")?r:t.hasOwnProperty("cartesian2")?o:t.hasOwnProperty("cartesian")||t.hasOwnProperty("spherical")||t.hasOwnProperty("cartographicRadians")||t.hasOwnProperty("cartographicDegrees")?n:t.hasOwnProperty("unitCartesian")||t.hasOwnProperty("unitSpherical")?Ae:t.hasOwnProperty("rgba")||t.hasOwnProperty("rgbaf")?l:t.hasOwnProperty("arcType")?e:t.hasOwnProperty("colorBlendMode")?A:t.hasOwnProperty("cornerType")?s:t.hasOwnProperty("heightReference")?L:t.hasOwnProperty("horizontalOrigin")?E:t.hasOwnProperty("date")?P:t.hasOwnProperty("labelStyle")?z:t.hasOwnProperty("number")?Number:t.hasOwnProperty("nearFarScalar")?N:t.hasOwnProperty("distanceDisplayCondition")?p:t.hasOwnProperty("object")||t.hasOwnProperty("value")?Object:t.hasOwnProperty("unitQuaternion")?D:t.hasOwnProperty("shadowMode")?G:t.hasOwnProperty("string")?String:t.hasOwnProperty("stripeOrientation")?ke:t.hasOwnProperty("wsen")||t.hasOwnProperty("wsenDegrees")?R:t.hasOwnProperty("uri")?W:t.hasOwnProperty("verticalOrigin")?H:Object}function Ze(t,i,a){switch(t){case e:return e[d(i.arcType,i)];case Array:return i.array;case Boolean:return d(i.boolean,i);case r:return i.boundingRectangle;case o:return i.cartesian2;case n:return je(i);case Ae:return function(e){var r=je(e);if(3===r.length)return Xe(r,0),r;for(var o=1;o<r.length;o+=4)Xe(r,o);return r}(i);case l:return function(e){var r=e.rgbaf;if(u(r))return r;var o=e.rgba;if(u(o)){var n=o.length;if(n===l.packedLength)return[l.byteToFloat(o[0]),l.byteToFloat(o[1]),l.byteToFloat(o[2]),l.byteToFloat(o[3])];r=new Array(n);for(var t=0;t<n;t+=5)r[t]=o[t],r[t+1]=l.byteToFloat(o[t+1]),r[t+2]=l.byteToFloat(o[t+2]),r[t+3]=l.byteToFloat(o[t+3]),r[t+4]=l.byteToFloat(o[t+4]);return r}}(i);case A:return A[d(i.colorBlendMode,i)];case s:return s[d(i.cornerType,i)];case L:return L[d(i.heightReference,i)];case E:return E[d(i.horizontalOrigin,i)];case Image:return Ue(i,a);case P:return P.fromIso8601(d(i.date,i));case z:return z[d(i.labelStyle,i)];case Number:return d(i.number,i);case N:return i.nearFarScalar;case p:return i.distanceDisplayCondition;case Object:return d(d(i.object,i.value),i);case D:return function(e){var r=e.unitQuaternion;if(u(r)){if(4===r.length)return qe(r,0),r;for(var o=1;o<r.length;o+=5)qe(r,o)}return r}(i);case Te:return d(i.number,i);case G:return G[d(d(i.shadowMode,i.shadows),i)];case String:return d(i.string,i);case ke:return ke[d(i.stripeOrientation,i)];case R:return function(e){var r=e.wsen;if(u(r))return r;var o=e.wsenDegrees;if(u(o)){var n=o.length;if(n===R.packedLength)return[T.toRadians(o[0]),T.toRadians(o[1]),T.toRadians(o[2]),T.toRadians(o[3])];r=new Array(n);for(var t=0;t<n;t+=5)r[t]=o[t],r[t+1]=T.toRadians(o[t+1]),r[t+2]=T.toRadians(o[t+2]),r[t+3]=T.toRadians(o[t+3]),r[t+4]=T.toRadians(o[t+4]);return r}}(i);case W:return Ue(i,a);case H:return H[d(i.verticalOrigin,i)];default:throw new B(t)}}var Ye={HERMITE:w,LAGRANGE:I,LINEAR:O};function Ke(e,r){var o=e.interpolationAlgorithm;(u(o)||u(e.interpolationDegree))&&r.setInterpolationOptions({interpolationAlgorithm:Ye[o],interpolationDegree:e.interpolationDegree});var n=e.forwardExtrapolationType;u(n)&&(r.forwardExtrapolationType=y[n]);var t=e.forwardExtrapolationDuration;u(t)&&(r.forwardExtrapolationDuration=t);var i=e.backwardExtrapolationType;u(i)&&(r.backwardExtrapolationType=y[i]);var a=e.backwardExtrapolationDuration;u(a)&&(r.backwardExtrapolationDuration=a)}var Qe={iso8601:void 0};function $e(e,r,o,n,t,i,a){var l,s,c,f,h=n.interval;u(h)?(Qe.iso8601=h,l=M.fromIso8601(Qe),u(t)&&(l=M.intersect(l,t,Fe))):u(t)&&(l=t);var p=!u(n.reference)&&!u(n.velocityReference),v=u(l)&&!l.equals(b.MAXIMUM_INTERVAL);if(!0===n.delete)return v?function e(r,o){if(r instanceof De)return void r.removeSamples(o);if(r instanceof Be)return void r.intervals.removeInterval(o);if(r instanceof Y){for(var n=r.intervals,t=0;t<n.length;++t){var i=M.intersect(n.get(t),o,Fe);i.isEmpty||e(i.data,o)}return void n.removeInterval(o)}}(r[o],l):void(r[o]=void 0);var m=!1;p&&(c=Ze(e,n,i),s=d(e.packedLength,1),f=d(c.length,1),m=!u(n.array)&&"string"!=typeof c&&f>s&&e!==Object);var y="function"==typeof e.unpack&&e!==Te;if(m||v){var g,w,C=r[o],I=n.epoch;if(u(I)&&(g=P.fromIso8601(I)),m&&!v)return C instanceof De||(C=new De(e),r[o]=C),C.addSamplesPackedArray(c,g),void Ke(n,C);if(!m&&v)return(l=l.clone()).data=p?y?e.unpack(c,0):c:ze(e,a,n),u(C)||(C=p?new Be:new Y,r[o]=C),void(p&&C instanceof Be?C.intervals.addInterval(l):C instanceof Y?(p&&(l.data=new Q(l.data)),C.intervals.addInterval(l)):((w=b.MAXIMUM_INTERVAL.clone()).data=C,C=new Y,r[o]=C,C.intervals.addInterval(w),p&&(l.data=new Q(l.data)),C.intervals.addInterval(l)));u(C)||(C=new Y,r[o]=C),C instanceof Y||((w=b.MAXIMUM_INTERVAL.clone()).data=C,C=new Y,r[o]=C,C.intervals.addInterval(w));var O=C.intervals;w=O.findInterval(l),u(w)&&w.data instanceof De||((w=l.clone()).data=new De(e),O.addInterval(w)),w.data.addSamplesPackedArray(c,g),Ke(n,w.data)}else r[o]=p?new Q(y?e.unpack(c,0):c):ze(e,a,n)}function er(e,r,o,n,t,i,a){if(u(n))if(C(n))for(var l=0,s=n.length;l<s;l++)$e(e,r,o,n[l],t,i,a);else $e(e,r,o,n,t,i,a)}function rr(e,r,o,t,i,a){var l,s=o.interval;u(s)?(Qe.iso8601=s,l=M.fromIso8601(Qe),u(t)&&(l=M.intersect(l,t,Fe))):u(t)&&(l=t);var c,f,h=u(o.cartesianVelocity)?1:0,p=n.packedLength*(h+1),v=!u(o.reference),m=u(l)&&!l.equals(b.MAXIMUM_INTERVAL);if(!0===o.delete)return m?function e(r,o){if(r instanceof Ne)return void r.removeSamples(o);if(r instanceof xe)return void r.intervals.removeInterval(o);if(r instanceof Z){for(var n=r.intervals,t=0;t<n.length;++t){var i=M.intersect(n.get(t),o,Fe);i.isEmpty||e(i.data,o)}return void n.removeInterval(o)}}(e[r],l):void(e[r]=void 0);var y=!1;if(v&&(u(o.referenceFrame)&&(f=k[o.referenceFrame]),f=d(f,k.FIXED),c=je(o),y=d(c.length,1)>p),y||m){var g,w,C=e[r],I=o.epoch;if(u(I)&&(g=P.fromIso8601(I)),y&&!m)return C instanceof Ne&&(!u(f)||C.referenceFrame===f)||(C=new Ne(f,h),e[r]=C),C.addSamplesPackedArray(c,g),void Ke(o,C);if(!y&&m)return(l=l.clone()).data=v?n.unpack(c):Ee(a,o.reference),u(C)||(C=v?new xe(f):new Z(f),e[r]=C),void(v&&C instanceof xe&&u(f)&&C.referenceFrame===f?C.intervals.addInterval(l):C instanceof Z?(v&&(l.data=new K(l.data,f)),C.intervals.addInterval(l)):((w=b.MAXIMUM_INTERVAL.clone()).data=C,C=new Z(C.referenceFrame),e[r]=C,C.intervals.addInterval(w),v&&(l.data=new K(l.data,f)),C.intervals.addInterval(l)));u(C)?C instanceof Z||((w=b.MAXIMUM_INTERVAL.clone()).data=C,C=new Z(C.referenceFrame),e[r]=C,C.intervals.addInterval(w)):(C=new Z(f),e[r]=C);var O=C.intervals;w=O.findInterval(l),u(w)&&w.data instanceof Ne&&(!u(f)||w.data.referenceFrame===f)||((w=l.clone()).data=new Ne(f,h),O.addInterval(w)),w.data.addSamplesPackedArray(c,g),Ke(o,w.data)}else e[r]=v?new K(n.unpack(c),f):Ee(a,o.reference)}function or(e,r,o,n,t,i){if(u(o))if(C(o))for(var a=0,l=o.length;a<l;a++)rr(e,r,o[a],n,0,i);else rr(e,r,o,n,0,i)}function nr(e,r,n,t,i,a){var s,c=n.interval;u(c)?(Qe.iso8601=c,s=M.fromIso8601(Qe),u(t)&&(s=M.intersect(s,t,Fe))):u(t)&&(s=t);var d,f,h,p=e[r];if(u(s)){p instanceof J||(p=new J,e[r]=p);var v=p.intervals;f=v.findInterval({start:s.start,stop:s.stop}),u(f)?d=f.data:(f=s.clone(),v.addInterval(f))}else d=p;u(n.solidColor)?(d instanceof q||(d=new q),h=n.solidColor,er(l,d,"color",h.color,void 0,void 0,a)):u(n.grid)?(d instanceof le||(d=new le),h=n.grid,er(l,d,"color",h.color,void 0,i,a),er(Number,d,"cellAlpha",h.cellAlpha,void 0,i,a),er(o,d,"lineCount",h.lineCount,void 0,i,a),er(o,d,"lineThickness",h.lineThickness,void 0,i,a),er(o,d,"lineOffset",h.lineOffset,void 0,i,a)):u(n.image)?(d instanceof se||(d=new se),h=n.image,er(Image,d,"image",h.image,void 0,i,a),er(o,d,"repeat",h.repeat,void 0,i,a),er(l,d,"color",h.color,void 0,i,a),er(Boolean,d,"transparent",h.transparent,void 0,i,a)):u(n.stripe)?(d instanceof Re||(d=new Re),h=n.stripe,er(ke,d,"orientation",h.orientation,void 0,i,a),er(l,d,"evenColor",h.evenColor,void 0,i,a),er(l,d,"oddColor",h.oddColor,void 0,i,a),er(Number,d,"offset",h.offset,void 0,i,a),er(Number,d,"repeat",h.repeat,void 0,i,a)):u(n.polylineOutline)?(d instanceof we||(d=new we),h=n.polylineOutline,er(l,d,"color",h.color,void 0,i,a),er(l,d,"outlineColor",h.outlineColor,void 0,i,a),er(Number,d,"outlineWidth",h.outlineWidth,void 0,i,a)):u(n.polylineGlow)?(d instanceof ye||(d=new ye),h=n.polylineGlow,er(l,d,"color",h.color,void 0,i,a),er(Number,d,"glowPower",h.glowPower,void 0,i,a),er(Number,d,"taperPower",h.taperPower,void 0,i,a)):u(n.polylineArrow)?(d instanceof ve||(d=new ve),h=n.polylineArrow,er(l,d,"color",h.color,void 0,void 0,a)):u(n.polylineDash)?(d instanceof me||(d=new me),h=n.polylineDash,er(l,d,"color",h.color,void 0,void 0,a),er(l,d,"gapColor",h.gapColor,void 0,void 0,a),er(Number,d,"dashLength",h.dashLength,void 0,i,a),er(Number,d,"dashPattern",h.dashPattern,void 0,i,a)):u(n.checkerboard)&&(d instanceof X||(d=new X),h=n.checkerboard,er(l,d,"evenColor",h.evenColor,void 0,i,a),er(l,d,"oddColor",h.oddColor,void 0,i,a),er(o,d,"repeat",h.repeat,void 0,i,a)),u(f)?f.data=d:e[r]=d}function tr(e,r,o,n,t,i){if(u(o))if(C(o))for(var a=0,l=o.length;a<l;a++)nr(e,r,o[a],n,t,i);else nr(e,r,o,n,t,i)}function ir(e,r,o,n){var t=o.references;if(u(t)){var i=t.map(function(e){return Ee(n,e)}),a=o.interval;if(u(a)){if(a=M.fromIso8601(a),!(e[r]instanceof Z)){a.data=new be(i);var l=new Y;l.intervals.addInterval(a),e[r]=l}}else e[r]=new be(i)}else er(Array,e,r,o,void 0,void 0,n)}function ar(e,r,o,n){if(u(o))if(C(o))for(var t=0,i=o.length;t<i;++t)ir(e,r,o[t],n);else ir(e,r,o,n)}function lr(e,r,o,t){if(u(o.references)){var i=o.references.map(function(e){return Ee(t,e)}),a=o.interval;if(u(a)){if(a=M.fromIso8601(a),!(e[r]instanceof Z)){a.data=new Ce(i);var l=new Z;l.intervals.addInterval(a),e[r]=l}}else e[r]=new Ce(i)}else u(o.cartesian)?o.array=n.unpackArray(o.cartesian):u(o.cartographicRadians)?o.array=n.fromRadiansArrayHeights(o.cartographicRadians):u(o.cartographicDegrees)&&(o.array=n.fromDegreesArrayHeights(o.cartographicDegrees)),u(o.array)&&er(Array,e,r,o,void 0,void 0,t)}function sr(e,r,o,n){if(u(o))if(C(o))for(var t=0,i=o.length;t<i;t++)lr(e,r,o[t],n);else lr(e,r,o,n)}function cr(e,r,o,t,i){var a,l=r.interval;u(l)?(Qe.iso8601=l,a=M.fromIso8601(Qe),u(o)&&(a=M.intersect(a,o,Fe))):u(o)&&(a=o);for(var s=e.nodeTransformations,c=Object.keys(r),d=0,f=c.length;d<f;++d){var h=c[d];if("interval"!==h){var p=r[h];if(u(p)){u(s)||(e.nodeTransformations=s=new Pe),s.hasProperty(h)||s.addProperty(h);var v=s[h];u(v)||(s[h]=v=new ue),er(n,v,"translation",p.translation,a,t,i),er(D,v,"rotation",p.rotation,a,t,i),er(n,v,"scale",p.scale,a,t,i)}}}}function dr(r){return r?e.GEODESIC:e.NONE}function ur(e,r,o,n,t){var i=e.id;if(u(i)||(i=c()),Le=i,!u(t._version)&&"document"!==i)throw new B("The first CZML packet is required to be the document object.");if(!0===e.delete)r.removeById(i);else if("document"===i)!function(e,r){var o=e.version;if(u(o)&&"string"==typeof o){var n=o.split(".");if(2===n.length){if("1"!==n[0])throw new B("PGEarth only supports CZML version 1.");r._version=o}}if(!u(r._version))throw new B("CZML version information invalid.  It is expected to be a property on the document object in the <Major>.<Minor> version format.");var t=r._documentPacket;u(e.name)&&(t.name=e.name);var i=e.clock;if(u(i)){var a=t.clock;u(a)?(a.interval=d(i.interval,a.interval),a.currentTime=d(i.currentTime,a.currentTime),a.range=d(i.range,a.range),a.step=d(i.step,a.step),a.multiplier=d(i.multiplier,a.multiplier)):t.clock={interval:i.interval,currentTime:i.currentTime,range:i.range,step:i.step,multiplier:i.multiplier}}}(e,t);else{var a=r.getOrCreateEntity(i),l=e.parent;u(l)&&(a.parent=r.getOrCreateEntity(l));for(var s=o.length-1;s>-1;s--)o[s](a,e,r,n)}Le=void 0}function fr(e,r,o,n){if(!u(r))throw new h("czml is required.");var t=r,l=(o=d(o,d.EMPTY_OBJECT)).sourceUri;return("string"==typeof r||r instanceof x)&&(t=(r=x.createIfNeeded(r)).fetchJson(),l=d(l,r.clone())),l=x.createIfNeeded(l),re.setLoading(e,!0),F(t,function(r){return function(e,r,o,n){re.setLoading(e,!0);var t=e._entityCollection;n&&(e._version=void 0,e._documentPacket=new hr,t.removeAll());pr._processCzml(r,t,o,void 0,e);var l=function(e){var r,o=e._documentPacket.clock;if(!u(o)){if(!u(e._clock)){var n=e._entityCollection.computeAvailability();if(!n.start.equals(b.MINIMUM_VALUE)){var t=n.start,l=n.stop,s=P.secondsDifference(l,t),c=Math.round(s/120);return(r=new oe).startTime=P.clone(t),r.stopTime=P.clone(l),r.clockRange=i.LOOP_STOP,r.multiplier=c,r.currentTime=P.clone(t),r.clockStep=a.SYSTEM_CLOCK_MULTIPLIER,e._clock=r,!0}}return!1}if(u(e._clock)?r=e._clock.clone():((r=new oe).startTime=b.MINIMUM_VALUE.clone(),r.stopTime=b.MAXIMUM_VALUE.clone(),r.currentTime=b.MINIMUM_VALUE.clone(),r.clockRange=i.LOOP_STOP,r.clockStep=a.SYSTEM_CLOCK_MULTIPLIER,r.multiplier=1),u(o.interval)){Qe.iso8601=o.interval;var f=M.fromIso8601(Qe);r.startTime=f.start,r.stopTime=f.stop}return u(o.currentTime)&&(r.currentTime=P.fromIso8601(o.currentTime)),u(o.range)&&(r.clockRange=d(i[o.range],i.LOOP_STOP)),u(o.step)&&(r.clockStep=d(a[o.step],a.SYSTEM_CLOCK_MULTIPLIER)),u(o.multiplier)&&(r.multiplier=o.multiplier),!r.equals(e._clock)&&(e._clock=r.clone(e._clock),!0)}(e),s=e._documentPacket;u(s.name)&&e._name!==s.name?(e._name=s.name,l=!0):!u(e._name)&&u(o)&&(e._name=g(o.getUrlComponent()),l=!0);re.setLoading(e,!1),l&&e._changed.raiseEvent(e);return e}(e,r,l,n)}).otherwise(function(r){return re.setLoading(e,!1),e._error.raiseEvent(e,r),console.log(r),F.reject(r)})}function hr(){this.name=void 0,this.clock=void 0}function pr(e){this._name=e,this._changed=new m,this._error=new m,this._isLoading=!1,this._loading=new m,this._clock=void 0,this._documentPacket=new hr,this._version=void 0,this._entityCollection=new ae(this),this._entityCluster=new ie}return pr.load=function(e,r){return(new pr).load(e,r)},f(pr.prototype,{name:{get:function(){return this._name}},clock:{get:function(){return this._clock}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(e){this._entityCollection.show=e}},clustering:{get:function(){return this._entityCluster},set:function(e){if(!u(e))throw new h("value must be defined.");this._entityCluster=e}}}),pr.updaters=[function(e,t,i,a){var s=t.billboard;if(u(s)){var c,d=s.interval;u(d)&&(Qe.iso8601=d,c=M.fromIso8601(Qe));var f=e.billboard;u(f)||(e.billboard=f=new V),er(Boolean,f,"show",s.show,c,a,i),er(Image,f,"image",s.image,c,a,i),er(Number,f,"scale",s.scale,c,a,i),er(o,f,"pixelOffset",s.pixelOffset,c,a,i),er(n,f,"eyeOffset",s.eyeOffset,c,a,i),er(E,f,"horizontalOrigin",s.horizontalOrigin,c,a,i),er(H,f,"verticalOrigin",s.verticalOrigin,c,a,i),er(L,f,"heightReference",s.heightReference,c,a,i),er(l,f,"color",s.color,c,a,i),er(Te,f,"rotation",s.rotation,c,a,i),function(e,r,o,n,t){u(r)&&er(Ae,e,"alignedAxis",r,o,n,t)}(f,s.alignedAxis,c,a,i),er(Boolean,f,"sizeInMeters",s.sizeInMeters,c,a,i),er(Number,f,"width",s.width,c,a,i),er(Number,f,"height",s.height,c,a,i),er(N,f,"scaleByDistance",s.scaleByDistance,c,a,i),er(N,f,"translucencyByDistance",s.translucencyByDistance,c,a,i),er(N,f,"pixelOffsetScaleByDistance",s.pixelOffsetScaleByDistance,c,a,i),er(r,f,"imageSubRegion",s.imageSubRegion,c,a,i),er(p,f,"distanceDisplayCondition",s.distanceDisplayCondition,c,a,i),er(Number,f,"disableDepthTestDistance",s.disableDepthTestDistance,c,a,i)}},function(e,r,o,t){var i=r.box;if(u(i)){var a,s=i.interval;u(s)&&(Qe.iso8601=s,a=M.fromIso8601(Qe));var c=e.box;u(c)||(e.box=c=new U),er(Boolean,c,"show",i.show,a,t,o),er(n,c,"dimensions",i.dimensions,a,t,o),er(Boolean,c,"fill",i.fill,a,t,o),tr(c,"material",i.material,a,t,o),er(Boolean,c,"outline",i.outline,a,t,o),er(l,c,"outlineColor",i.outlineColor,a,t,o),er(Number,c,"outlineWidth",i.outlineWidth,a,t,o),er(G,c,"shadows",i.shadows,a,t,o),er(p,c,"distanceDisplayCondition",i.distanceDisplayCondition,a,t,o)}},function(e,r,o,n){var t=r.corridor;if(u(t)){var i,a=t.interval;u(a)&&(Qe.iso8601=a,i=M.fromIso8601(Qe));var c=e.corridor;u(c)||(e.corridor=c=new $),er(Boolean,c,"show",t.show,i,n,o),sr(c,"positions",t.positions,o),er(Number,c,"width",t.width,i,n,o),er(Number,c,"height",t.height,i,n,o),er(Number,c,"extrudedHeight",t.extrudedHeight,i,n,o),er(L,c,"heightReference",t.heightReference,i,n,o),er(L,c,"extrudedHeightReference",t.extrudedHeightReference,i,n,o),er(s,c,"cornerType",t.cornerType,i,n,o),er(Number,c,"granularity",t.granularity,i,n,o),er(Boolean,c,"fill",t.fill,i,n,o),tr(c,"material",t.material,i,n,o),er(Boolean,c,"outline",t.outline,i,n,o),er(l,c,"outlineColor",t.outlineColor,i,n,o),er(Number,c,"outlineWidth",t.outlineWidth,i,n,o),er(G,c,"shadows",t.shadows,i,n,o),er(p,c,"distanceDisplayCondition",t.distanceDisplayCondition,i,n,o),er(Number,c,"zIndex",t.zIndex,i,n,o)}},function(e,r,o,n){var t=r.cylinder;if(u(t)){var i,a=t.interval;u(a)&&(Qe.iso8601=a,i=M.fromIso8601(Qe));var s=e.cylinder;u(s)||(e.cylinder=s=new ee),er(Boolean,s,"show",t.show,i,n,o),er(Number,s,"length",t.length,i,n,o),er(Number,s,"topRadius",t.topRadius,i,n,o),er(Number,s,"bottomRadius",t.bottomRadius,i,n,o),er(Boolean,s,"fill",t.fill,i,n,o),tr(s,"material",t.material,i,n,o),er(Boolean,s,"outline",t.outline,i,n,o),er(l,s,"outlineColor",t.outlineColor,i,n,o),er(Number,s,"outlineWidth",t.outlineWidth,i,n,o),er(Number,s,"numberOfVerticalLines",t.numberOfVerticalLines,i,n,o),er(Number,s,"slices",t.slices,i,n,o),er(G,s,"shadows",t.shadows,i,n,o),er(p,s,"distanceDisplayCondition",t.distanceDisplayCondition,i,n,o)}},function(e,r,o,n){var t=r.ellipse;if(u(t)){var i,a=t.interval;u(a)&&(Qe.iso8601=a,i=M.fromIso8601(Qe));var s=e.ellipse;u(s)||(e.ellipse=s=new ne),er(Boolean,s,"show",t.show,i,n,o),er(Number,s,"semiMajorAxis",t.semiMajorAxis,i,n,o),er(Number,s,"semiMinorAxis",t.semiMinorAxis,i,n,o),er(Number,s,"height",t.height,i,n,o),er(Number,s,"extrudedHeight",t.extrudedHeight,i,n,o),er(L,s,"heightReference",t.heightReference,i,n,o),er(L,s,"extrudedHeightReference",t.extrudedHeightReference,i,n,o),er(Te,s,"rotation",t.rotation,i,n,o),er(Te,s,"stRotation",t.stRotation,i,n,o),er(Number,s,"granularity",t.granularity,i,n,o),er(Boolean,s,"fill",t.fill,i,n,o),tr(s,"material",t.material,i,n,o),er(Boolean,s,"outline",t.outline,i,n,o),er(l,s,"outlineColor",t.outlineColor,i,n,o),er(Number,s,"outlineWidth",t.outlineWidth,i,n,o),er(Number,s,"numberOfVerticalLines",t.numberOfVerticalLines,i,n,o),er(G,s,"shadows",t.shadows,i,n,o),er(p,s,"distanceDisplayCondition",t.distanceDisplayCondition,i,n,o),er(Number,s,"zIndex",t.zIndex,i,n,o)}},function(e,r,o,t){var i=r.ellipsoid;if(u(i)){var a,s=i.interval;u(s)&&(Qe.iso8601=s,a=M.fromIso8601(Qe));var c=e.ellipsoid;u(c)||(e.ellipsoid=c=new te),er(Boolean,c,"show",i.show,a,t,o),er(n,c,"radii",i.radii,a,t,o),er(Boolean,c,"fill",i.fill,a,t,o),tr(c,"material",i.material,a,t,o),er(Boolean,c,"outline",i.outline,a,t,o),er(l,c,"outlineColor",i.outlineColor,a,t,o),er(Number,c,"outlineWidth",i.outlineWidth,a,t,o),er(Number,c,"stackPartitions",i.stackPartitions,a,t,o),er(Number,c,"slicePartitions",i.slicePartitions,a,t,o),er(Number,c,"subdivisions",i.subdivisions,a,t,o),er(G,c,"shadows",i.shadows,a,t,o),er(p,c,"distanceDisplayCondition",i.distanceDisplayCondition,a,t,o)}},function(e,r,t,i){var a=r.label;if(u(a)){var s,c=a.interval;u(c)&&(Qe.iso8601=c,s=M.fromIso8601(Qe));var d=e.label;u(d)||(e.label=d=new ce),er(Boolean,d,"show",a.show,s,i,t),er(String,d,"text",a.text,s,i,t),er(String,d,"font",a.font,s,i,t),er(z,d,"style",a.style,s,i,t),er(Number,d,"scale",a.scale,s,i,t),er(Boolean,d,"showBackground",a.showBackground,s,i,t),er(l,d,"backgroundColor",a.backgroundColor,s,i,t),er(o,d,"backgroundPadding",a.backgroundPadding,s,i,t),er(o,d,"pixelOffset",a.pixelOffset,s,i,t),er(n,d,"eyeOffset",a.eyeOffset,s,i,t),er(E,d,"horizontalOrigin",a.horizontalOrigin,s,i,t),er(H,d,"verticalOrigin",a.verticalOrigin,s,i,t),er(L,d,"heightReference",a.heightReference,s,i,t),er(l,d,"fillColor",a.fillColor,s,i,t),er(l,d,"outlineColor",a.outlineColor,s,i,t),er(Number,d,"outlineWidth",a.outlineWidth,s,i,t),er(N,d,"translucencyByDistance",a.translucencyByDistance,s,i,t),er(N,d,"pixelOffsetScaleByDistance",a.pixelOffsetScaleByDistance,s,i,t),er(N,d,"scaleByDistance",a.scaleByDistance,s,i,t),er(p,d,"distanceDisplayCondition",a.distanceDisplayCondition,s,i,t),er(Number,d,"disableDepthTestDistance",a.disableDepthTestDistance,s,i,t)}},function(e,r,o,n){var t=r.model;if(u(t)){var i,a=t.interval;u(a)&&(Qe.iso8601=a,i=M.fromIso8601(Qe));var s=e.model;u(s)||(e.model=s=new de),er(Boolean,s,"show",t.show,i,n,o),er(W,s,"uri",t.gltf,i,n,o),er(Number,s,"scale",t.scale,i,n,o),er(Number,s,"minimumPixelSize",t.minimumPixelSize,i,n,o),er(Number,s,"maximumScale",t.maximumScale,i,n,o),er(Boolean,s,"incrementallyLoadTextures",t.incrementallyLoadTextures,i,n,o),er(Boolean,s,"runAnimations",t.runAnimations,i,n,o),er(Boolean,s,"clampAnimations",t.clampAnimations,i,n,o),er(G,s,"shadows",t.shadows,i,n,o),er(L,s,"heightReference",t.heightReference,i,n,o),er(l,s,"silhouetteColor",t.silhouetteColor,i,n,o),er(Number,s,"silhouetteSize",t.silhouetteSize,i,n,o),er(l,s,"color",t.color,i,n,o),er(A,s,"colorBlendMode",t.colorBlendMode,i,n,o),er(Number,s,"colorBlendAmount",t.colorBlendAmount,i,n,o),er(p,s,"distanceDisplayCondition",t.distanceDisplayCondition,i,n,o);var c=t.nodeTransformations;if(u(c))if(C(c))for(var d=0,f=c.length;d<f;d++)cr(s,c[d],i,n,o);else cr(s,c,i,n,o)}},function(e,r,o,n){e.name=d(r.name,e.name)},function(e,r,o,n){var t=r.description;u(t)&&er(String,e,"description",t,void 0,n,o)},function(e,r,o,n){var t=r.path;if(u(t)){var i,a=t.interval;u(a)&&(Qe.iso8601=a,i=M.fromIso8601(Qe));var l=e.path;u(l)||(e.path=l=new fe),er(Boolean,l,"show",t.show,i,n,o),er(Number,l,"width",t.width,i,n,o),er(Number,l,"resolution",t.resolution,i,n,o),er(Number,l,"leadTime",t.leadTime,i,n,o),er(Number,l,"trailTime",t.trailTime,i,n,o),tr(l,"material",t.material,i,n,o),er(p,l,"distanceDisplayCondition",t.distanceDisplayCondition,i,n,o)}},function(e,r,o,n){var t=r.point;if(u(t)){var i,a=t.interval;u(a)&&(Qe.iso8601=a,i=M.fromIso8601(Qe));var s=e.point;u(s)||(e.point=s=new he),er(Boolean,s,"show",t.show,i,n,o),er(Number,s,"pixelSize",t.pixelSize,i,n,o),er(L,s,"heightReference",t.heightReference,i,n,o),er(l,s,"color",t.color,i,n,o),er(l,s,"outlineColor",t.outlineColor,i,n,o),er(Number,s,"outlineWidth",t.outlineWidth,i,n,o),er(N,s,"scaleByDistance",t.scaleByDistance,i,n,o),er(N,s,"translucencyByDistance",t.translucencyByDistance,i,n,o),er(p,s,"distanceDisplayCondition",t.distanceDisplayCondition,i,n,o),er(Number,s,"disableDepthTestDistance",t.disableDepthTestDistance,i,n,o)}},function(r,o,n,t){var i=o.polygon;if(u(i)){var a,s=i.interval;u(s)&&(Qe.iso8601=s,a=M.fromIso8601(Qe));var c=r.polygon;u(c)||(r.polygon=c=new pe),er(Boolean,c,"show",i.show,a,t,n),sr(c,"hierarchy",i.positions,n),er(Number,c,"height",i.height,a,t,n),er(Number,c,"extrudedHeight",i.extrudedHeight,a,t,n),er(L,c,"heightReference",i.heightReference,a,t,n),er(L,c,"extrudedHeightReference",i.extrudedHeightReference,a,t,n),er(Te,c,"stRotation",i.stRotation,a,t,n),er(Number,c,"granularity",i.granularity,a,t,n),er(Boolean,c,"fill",i.fill,a,t,n),tr(c,"material",i.material,a,t,n),er(Boolean,c,"outline",i.outline,a,t,n),er(l,c,"outlineColor",i.outlineColor,a,t,n),er(Number,c,"outlineWidth",i.outlineWidth,a,t,n),er(Boolean,c,"perPositionHeight",i.perPositionHeight,a,t,n),er(Boolean,c,"closeTop",i.closeTop,a,t,n),er(Boolean,c,"closeBottom",i.closeBottom,a,t,n),er(e,c,"arcType",i.arcType,a,t,n),er(G,c,"shadows",i.shadows,a,t,n),er(p,c,"distanceDisplayCondition",i.distanceDisplayCondition,a,t,n),er(Number,c,"zIndex",i.zIndex,a,t,n)}},function(r,o,n,t){var i=o.polyline;if(u(i)){var a,l=i.interval;u(l)&&(Qe.iso8601=l,a=M.fromIso8601(Qe));var s,c,d=r.polyline;if(u(d)||(r.polyline=d=new ge),er(Boolean,d,"show",i.show,a,t,n),sr(d,"positions",i.positions,n),er(Number,d,"width",i.width,a,t,n),er(Number,d,"granularity",i.granularity,a,t,n),tr(d,"material",i.material,a,t,n),tr(d,"depthFailMaterial",i.depthFailMaterial,a,t,n),er(e,d,"arcType",i.arcType,a,t,n),er(Boolean,d,"clampToGround",i.clampToGround,a,t,n),er(G,d,"shadows",i.shadows,a,t,n),er(p,d,"distanceDisplayCondition",i.distanceDisplayCondition,a,t,n),er(Number,d,"zIndex",i.zIndex,a,t,n),u(i.followSurface)&&!u(i.arcType)){var f={};er(Boolean,f,"followSurface",i.followSurface,a,t,n),d.arcType=(c=dr,new j(function(e,r){return c(s.getValue(e,r))},(s=f.followSurface).isConstant))}}},function(e,r,o,n){var t=r.properties;if(u(t))for(var i in u(e.properties)||(e.properties=new Pe),t)if(t.hasOwnProperty(i)){e.properties.hasProperty(i)||e.properties.addProperty(i);var a=t[i];if(C(a))for(var l=0,s=a.length;l<s;l++)$e(Je(a[l]),e.properties,i,a[l],void 0,n,o);else $e(Je(a),e.properties,i,a,void 0,n,o)}},function(e,r,o,n){var t=r.rectangle;if(u(t)){var i,a=t.interval;u(a)&&(Qe.iso8601=a,i=M.fromIso8601(Qe));var s=e.rectangle;u(s)||(e.rectangle=s=new Ie),er(Boolean,s,"show",t.show,i,n,o),er(R,s,"coordinates",t.coordinates,i,n,o),er(Number,s,"height",t.height,i,n,o),er(Number,s,"extrudedHeight",t.extrudedHeight,i,n,o),er(L,s,"heightReference",t.heightReference,i,n,o),er(L,s,"extrudedHeightReference",t.extrudedHeightReference,i,n,o),er(Te,s,"rotation",t.rotation,i,n,o),er(Te,s,"stRotation",t.stRotation,i,n,o),er(Number,s,"granularity",t.granularity,i,n,o),er(Boolean,s,"fill",t.fill,i,n,o),tr(s,"material",t.material,i,n,o),er(Boolean,s,"outline",t.outline,i,n,o),er(l,s,"outlineColor",t.outlineColor,i,n,o),er(Number,s,"outlineWidth",t.outlineWidth,i,n,o),er(G,s,"shadows",t.shadows,i,n,o),er(p,s,"distanceDisplayCondition",t.distanceDisplayCondition,i,n,o),er(Number,s,"zIndex",t.zIndex,i,n,o)}},function(e,r,o,n){var t=r.position;u(t)&&or(e,"position",t,void 0,0,o)},function(e,r,o,t){var i=r.viewFrom;u(i)&&er(n,e,"viewFrom",i,void 0,t,o)},function(e,r,o,n){var t=r.wall;if(u(t)){var i,a=t.interval;u(a)&&(Qe.iso8601=a,i=M.fromIso8601(Qe));var s=e.wall;u(s)||(e.wall=s=new _e),er(Boolean,s,"show",t.show,i,n,o),sr(s,"positions",t.positions,o),ar(s,"minimumHeights",t.minimumHeights,o),ar(s,"maximumHeights",t.maximumHeights,o),er(Number,s,"granularity",t.granularity,i,n,o),er(Boolean,s,"fill",t.fill,i,n,o),tr(s,"material",t.material,i,n,o),er(Boolean,s,"outline",t.outline,i,n,o),er(l,s,"outlineColor",t.outlineColor,i,n,o),er(Number,s,"outlineWidth",t.outlineWidth,i,n,o),er(G,s,"shadows",t.shadows,i,n,o),er(p,s,"distanceDisplayCondition",t.distanceDisplayCondition,i,n,o)}},function(e,r,o,n){var t=r.orientation;u(t)&&er(D,e,"orientation",t,void 0,n,o)},function(e,r,o,n){var t,i=r.availability;if(u(i)){var a;if(C(i))for(var l=i.length,s=0;s<l;s++)u(a)||(a=new _),Qe.iso8601=i[s],t=M.fromIso8601(Qe),a.addInterval(t);else Qe.iso8601=i,t=M.fromIso8601(Qe),(a=new _).addInterval(t);e.availability=a}}],pr.prototype.process=function(e,r){return fr(this,e,r,!1)},pr.prototype.load=function(e,r){return fr(this,e,r,!0)},pr.processPacketData=er,pr.processPositionPacketData=or,pr.processMaterialPacketData=tr,pr._processCzml=function(e,r,o,n,t){if(n=u(n)?n:pr.updaters,C(e))for(var i=0,a=e.length;i<a;i++)ur(e[i],r,n,o,t);else ur(e,r,n,o,t)},pr});