define(["../ThirdParty/when","./binarySearch","./defaultValue","./defined","./EarthOrientationParametersSample","./freezeObject","./JulianDate","./LeapSecond","./Resource","./RuntimeError","./TimeConstants","./TimeStandard"],function(e,n,a,s,t,o,i,l,d,r,u,f){"use strict";function c(n){if(n=a(n,a.EMPTY_OBJECT),this._dates=void 0,this._samples=void 0,this._dateColumn=-1,this._xPoleWanderRadiansColumn=-1,this._yPoleWanderRadiansColumn=-1,this._ut1MinusUtcSecondsColumn=-1,this._xCelestialPoleOffsetRadiansColumn=-1,this._yCelestialPoleOffsetRadiansColumn=-1,this._taiMinusUtcSecondsColumn=-1,this._columnCount=0,this._lastIndex=-1,this._downloadPromise=void 0,this._dataError=void 0,this._addNewLeapSeconds=a(n.addNewLeapSeconds,!0),s(n.data))_(this,n.data);else if(s(n.url)){var t=d.createIfNeeded(n.url),o=this;this._downloadPromise=e(t.fetchJson(),function(e){_(o,e)},function(){o._dataError="An error occurred while retrieving the EOP data from the URL "+t.url+"."})}else _(this,{columnNames:["dateIso8601","modifiedJulianDateUtc","xPoleWanderRadians","yPoleWanderRadians","ut1MinusUtcSeconds","lengthOfDayCorrectionSeconds","xCelestialPoleOffsetRadians","yCelestialPoleOffsetRadians","taiMinusUtcSeconds"],samples:[]})}function m(e,n){return i.compare(e.julianDate,n)}function _(e,a){if(s(a.columnNames))if(s(a.samples)){var t=a.columnNames.indexOf("modifiedJulianDateUtc"),o=a.columnNames.indexOf("xPoleWanderRadians"),d=a.columnNames.indexOf("yPoleWanderRadians"),r=a.columnNames.indexOf("ut1MinusUtcSeconds"),c=a.columnNames.indexOf("xCelestialPoleOffsetRadians"),_=a.columnNames.indexOf("yCelestialPoleOffsetRadians"),P=a.columnNames.indexOf("taiMinusUtcSeconds");if(t<0||o<0||d<0||r<0||c<0||_<0||P<0)e._dataError="Error in loaded EOP data: The columnNames property must include modifiedJulianDateUtc, xPoleWanderRadians, yPoleWanderRadians, ut1MinusUtcSeconds, xCelestialPoleOffsetRadians, yCelestialPoleOffsetRadians, and taiMinusUtcSeconds columns";else{var C,h=e._samples=a.samples,O=e._dates=[];e._dateColumn=t,e._xPoleWanderRadiansColumn=o,e._yPoleWanderRadiansColumn=d,e._ut1MinusUtcSecondsColumn=r,e._xCelestialPoleOffsetRadiansColumn=c,e._yCelestialPoleOffsetRadiansColumn=_,e._taiMinusUtcSecondsColumn=P,e._columnCount=a.columnNames.length,e._lastIndex=void 0;for(var x=e._addNewLeapSeconds,R=0,y=h.length;R<y;R+=e._columnCount){var p=h[R+t],E=h[R+P],W=p+u.MODIFIED_JULIAN_DATE_DIFFERENCE,U=new i(W,E,f.TAI);if(O.push(U),x){if(E!==C&&s(C)){var S=i.leapSeconds,M=n(S,U,m);if(M<0){var v=new l(U,E);S.splice(~M,0,v)}}C=E}}}}else e._dataError="Error in loaded EOP data: The samples property is required.";else e._dataError="Error in loaded EOP data: The columnNames property is required."}function P(e,n,a,s,t){var o=a*s;t.xPoleWander=n[o+e._xPoleWanderRadiansColumn],t.yPoleWander=n[o+e._yPoleWanderRadiansColumn],t.xPoleOffset=n[o+e._xCelestialPoleOffsetRadiansColumn],t.yPoleOffset=n[o+e._yCelestialPoleOffsetRadiansColumn],t.ut1MinusUtc=n[o+e._ut1MinusUtcSecondsColumn]}function C(e,n,a){return n+e*(a-n)}function h(e,n,a,s,t,o,l){var d=e._columnCount;if(o>n.length-1)return l.xPoleWander=0,l.yPoleWander=0,l.xPoleOffset=0,l.yPoleOffset=0,l.ut1MinusUtc=0,l;var r=n[t],u=n[o];if(r.equals(u)||s.equals(r))return P(e,a,t,d,l),l;if(s.equals(u))return P(e,a,o,d,l),l;var f=i.secondsDifference(s,r)/i.secondsDifference(u,r),c=t*d,m=o*d,_=a[c+e._ut1MinusUtcSecondsColumn],h=a[m+e._ut1MinusUtcSecondsColumn],O=h-_;if(O>.5||O<-.5){var x=a[c+e._taiMinusUtcSecondsColumn],R=a[m+e._taiMinusUtcSecondsColumn];x!==R&&(u.equals(s)?_=h:h-=R-x)}return l.xPoleWander=C(f,a[c+e._xPoleWanderRadiansColumn],a[m+e._xPoleWanderRadiansColumn]),l.yPoleWander=C(f,a[c+e._yPoleWanderRadiansColumn],a[m+e._yPoleWanderRadiansColumn]),l.xPoleOffset=C(f,a[c+e._xCelestialPoleOffsetRadiansColumn],a[m+e._xCelestialPoleOffsetRadiansColumn]),l.yPoleOffset=C(f,a[c+e._yCelestialPoleOffsetRadiansColumn],a[m+e._yCelestialPoleOffsetRadiansColumn]),l.ut1MinusUtc=C(f,_,h),l}return c.NONE=o({getPromiseToLoad:function(){return e()},compute:function(e,n){return s(n)?(n.xPoleWander=0,n.yPoleWander=0,n.xPoleOffset=0,n.yPoleOffset=0,n.ut1MinusUtc=0):n=new t(0,0,0,0,0),n}}),c.prototype.getPromiseToLoad=function(){return e(this._downloadPromise)},c.prototype.compute=function(e,a){if(s(this._samples)){if(s(a)||(a=new t(0,0,0,0,0)),0===this._samples.length)return a.xPoleWander=0,a.yPoleWander=0,a.xPoleOffset=0,a.yPoleOffset=0,a.ut1MinusUtc=0,a;var o=this._dates,l=this._lastIndex,d=0,u=0;if(s(l)){var f=o[l],c=o[l+1],m=i.lessThanOrEquals(f,e),_=!s(c),P=_||i.greaterThanOrEquals(c,e);if(m&&P)return d=l,!_&&c.equals(e)&&++d,u=d+1,h(this,o,this._samples,e,d,u,a),a}var C=n(o,e,i.compare,this._dateColumn);return C>=0?(C<o.length-1&&o[C+1].equals(e)&&++C,d=C,u=C):(d=(u=~C)-1)<0&&(d=0),this._lastIndex=d,h(this,o,this._samples,e,d,u,a),a}if(s(this._dataError))throw new r(this._dataError)},c});