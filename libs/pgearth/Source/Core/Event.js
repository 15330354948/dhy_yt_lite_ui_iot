define(["./Check","./defined","./defineProperties"],function(e,t,i){"use strict";function s(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}function n(e,t){return t-e}return i(s.prototype,{numberOfListeners:{get:function(){return this._listeners.length-this._toRemove.length}}}),s.prototype.addEventListener=function(t,i){e.typeOf.func("listener",t),this._listeners.push(t),this._scopes.push(i);var s=this;return function(){s.removeEventListener(t,i)}},s.prototype.removeEventListener=function(t,i){e.typeOf.func("listener",t);for(var s=this._listeners,n=this._scopes,r=-1,o=0;o<s.length;o++)if(s[o]===t&&n[o]===i){r=o;break}return-1!==r&&(this._insideRaiseEvent?(this._toRemove.push(r),s[r]=void 0,n[r]=void 0):(s.splice(r,1),n.splice(r,1)),!0)},s.prototype.raiseEvent=function(){var e;this._insideRaiseEvent=!0;var i=this._listeners,s=this._scopes,r=i.length;for(e=0;e<r;e++){var o=i[e];t(o)&&i[e].apply(s[e],arguments)}var h=this._toRemove;if((r=h.length)>0){for(h.sort(n),e=0;e<r;e++){var p=h[e];i.splice(p,1),s.splice(p,1)}h.length=0}this._insideRaiseEvent=!1},s});