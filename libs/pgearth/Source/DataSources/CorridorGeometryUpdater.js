define(["../Core/ApproximateTerrainHeights","../Core/Cartesian3","../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/CorridorGeometry","../Core/CorridorOutlineGeometry","../Core/defined","../Core/DeveloperError","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/GeometryInstance","../Core/GeometryOffsetAttribute","../Core/Iso8601","../Core/OffsetGeometryInstanceAttribute","../Core/Rectangle","../Core/ShowGeometryInstanceAttribute","../Scene/GroundPrimitive","../Scene/HeightReference","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","./ColorMaterialProperty","./DynamicGeometryUpdater","./GeometryUpdater","./GroundGeometryUpdater","./Property"],function(e,t,i,r,o,n,s,a,d,l,u,p,h,c,y,f,g,m,C,_,O,V,M,U,w){"use strict";var v=new r,A=t.ZERO,I=new t,b=new y;function D(e,t){U.call(this,{entity:e,scene:t,geometryOptions:new function(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.cornerType=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.offsetAttribute=void 0}(e),geometryPropertyName:"corridor",observedPropertyNames:["availability","corridor"]}),this._onEntityPropertyChanged(e,"corridor",e.corridor,void 0)}function E(e,t,i){V.call(this,e,t,i)}return a(Object.create)&&(D.prototype=Object.create(U.prototype),D.prototype.constructor=D),D.prototype.createFillGeometryInstance=function(e){if(i.defined("time",e),!this._fillEnabled)throw new d("This instance does not represent a filled geometry.");var t,s=this._entity,p=s.isAvailable(e),h={show:new f(p&&s.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:l.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof O&&(a(this._materialProperty.color)&&(this._materialProperty.color.isConstant||p)&&(t=this._materialProperty.color.getValue(e,v)),a(t)||(t=r.WHITE),h.color=o.fromColor(t));return a(this._options.offsetAttribute)&&(h.offset=c.fromCartesian3(w.getValueOrDefault(this._terrainOffsetProperty,e,A,I))),new u({id:s,geometry:new n(this._options),attributes:h})},D.prototype.createOutlineGeometryInstance=function(e){if(i.defined("time",e),!this._outlineEnabled)throw new d("This instance does not represent an outlined geometry.");var t=this._entity,n=t.isAvailable(e),p=w.getValueOrDefault(this._outlineColorProperty,e,r.BLACK,v),h={show:new f(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:o.fromColor(p),distanceDisplayCondition:l.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0};return a(this._options.offsetAttribute)&&(h.offset=c.fromCartesian3(w.getValueOrDefault(this._terrainOffsetProperty,e,A,I))),new u({id:t,geometry:new s(this._options),attributes:h})},D.prototype._computeCenter=function(e,i){var r=w.getValueOrUndefined(this._entity.corridor.positions,e);if(a(r)&&0!==r.length)return t.clone(r[Math.floor(r.length/2)],i)},D.prototype._isHidden=function(e,t){return!a(t.positions)||!a(t.width)||M.prototype._isHidden.call(this,e,t)},D.prototype._isDynamic=function(e,t){return!t.positions.isConstant||!w.isConstant(t.height)||!w.isConstant(t.extrudedHeight)||!w.isConstant(t.granularity)||!w.isConstant(t.width)||!w.isConstant(t.outlineWidth)||!w.isConstant(t.cornerType)||!w.isConstant(t.zIndex)||this._onTerrain&&!w.isConstant(this._materialProperty)},D.prototype._setStaticOptions=function(t,i){var r=w.getValueOrUndefined(i.height,h.MINIMUM_VALUE),o=w.getValueOrDefault(i.heightReference,h.MINIMUM_VALUE,m.NONE),s=w.getValueOrUndefined(i.extrudedHeight,h.MINIMUM_VALUE),d=w.getValueOrDefault(i.extrudedHeightReference,h.MINIMUM_VALUE,m.NONE);a(s)&&!a(r)&&(r=0);var l=this._options;l.vertexFormat=this._materialProperty instanceof O?_.VERTEX_FORMAT:C.MaterialSupport.TEXTURED.vertexFormat,l.positions=i.positions.getValue(h.MINIMUM_VALUE,l.positions),l.width=i.width.getValue(h.MINIMUM_VALUE),l.granularity=w.getValueOrUndefined(i.granularity,h.MINIMUM_VALUE),l.cornerType=w.getValueOrUndefined(i.cornerType,h.MINIMUM_VALUE),l.offsetAttribute=U.computeGeometryOffsetAttribute(r,o,s,d),l.height=U.getGeometryHeight(r,o),(s=U.getGeometryExtrudedHeight(s,d))===U.CLAMP_TO_GROUND&&(s=e.getMinimumMaximumHeights(n.computeRectangle(l,b)).minimumTerrainHeight),l.extrudedHeight=s},D.DynamicGeometryUpdater=E,a(Object.create)&&(E.prototype=Object.create(V.prototype),E.prototype.constructor=E),E.prototype._isHidden=function(e,t,i){var r=this._options;return!a(r.positions)||!a(r.width)||V.prototype._isHidden.call(this,e,t,i)},E.prototype._setOptions=function(t,i,r){var o=this._options,s=w.getValueOrUndefined(i.height,r),d=w.getValueOrDefault(i.heightReference,r,m.NONE),l=w.getValueOrUndefined(i.extrudedHeight,r),u=w.getValueOrDefault(i.extrudedHeightReference,r,m.NONE);a(l)&&!a(s)&&(s=0),o.positions=w.getValueOrUndefined(i.positions,r),o.width=w.getValueOrUndefined(i.width,r),o.granularity=w.getValueOrUndefined(i.granularity,r),o.cornerType=w.getValueOrUndefined(i.cornerType,r),o.offsetAttribute=U.computeGeometryOffsetAttribute(s,d,l,u),o.height=U.getGeometryHeight(s,d),(l=U.getGeometryExtrudedHeight(l,u))===U.CLAMP_TO_GROUND&&(l=e.getMinimumMaximumHeights(n.computeRectangle(o,b)).minimumTerrainHeight),o.extrudedHeight=l},D});