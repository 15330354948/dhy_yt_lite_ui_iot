define(["./addExtensionsUsed","./ForEach","../../Core/defaultValue","../../Core/defined","../../Core/WebGLConstants"],function(e,n,t,a,i){"use strict";var r=[i.FUNC_ADD,i.FUNC_ADD],u=[i.ONE,i.ZERO,i.ONE,i.ZERO];function o(e,n){var t=e.enable;return!!a(t)&&t.indexOf(n)>-1}var s=[i.ZERO,i.ONE,i.SRC_COLOR,i.ONE_MINUS_SRC_COLOR,i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.DST_ALPHA,i.ONE_MINUS_DST_ALPHA,i.DST_COLOR,i.ONE_MINUS_DST_COLOR];return function(d){var c={},O={},_=d.techniques;return a(_)?(n.technique(d,function(e,n){var d=e.states;if(a(d)){var _=O[n]={};if(o(d,i.BLEND)){_.alphaMode="BLEND";var f=d.functions;a(f)&&(a(f.blendEquationSeparate)||a(f.blendFuncSeparate))&&(c[n]={blendEquation:t(f.blendEquationSeparate,r),blendFactors:function(e,n){if(!a(e))return n;for(var t=0;t<4;t++)if(-1===s.indexOf(e[t]))return n;return e}(f.blendFuncSeparate,u)})}o(d,i.CULL_FACE)||(_.doubleSided=!0),delete e.states}}),Object.keys(c).length>0&&(a(d.extensions)||(d.extensions={}),e(d,"KHR_blend")),n.material(d,function(e){if(a(e.technique)){var t=O[e.technique];n.objectLegacy(t,function(n,t){e[t]=n});var i=c[e.technique];a(i)&&(a(e.extensions)||(e.extensions={}),e.extensions.KHR_blend=i)}}),d):d}});