define(["./addExtensionsUsed","./addExtensionsRequired","./addToArray","./ForEach","../../Core/defined"],function(e,n,t,s,r){"use strict";return function(a){var i=a.techniques,u={},o={};if(r(i)){var d={programs:[],shaders:[],techniques:[]},c=a.glExtensionsUsed;delete a.glExtensionsUsed,s.technique(a,function(e,n){var r,i={name:e.name,program:void 0,attributes:{},uniforms:{}};s.techniqueAttribute(e,function(n,t){r=e.parameters[n],i.attributes[t]={semantic:r.semantic}}),s.techniqueUniform(e,function(n,t){r=e.parameters[n],i.uniforms[t]={count:r.count,node:r.node,type:r.type,semantic:r.semantic,value:r.value},u[n]=t});var h=a.programs[e.program],m={name:h.name,fragmentShader:void 0,vertexShader:void 0,glExtensions:c},l=a.shaders[h.fragmentShader];m.fragmentShader=t(d.shaders,l,!0);var v=a.shaders[h.vertexShader];m.vertexShader=t(d.shaders,v,!0),i.program=t(d.programs,m),o[n]=t(d.techniques,i)}),d.techniques.length>0&&(r(a.extensions)||(a.extensions={}),a.extensions.KHR_techniques_webgl=d,e(a,"KHR_techniques_webgl"),n(a,"KHR_techniques_webgl"))}return s.material(a,function(e){if(r(e.technique)){var n={technique:o[e.technique]};s.objectLegacy(e.values,function(e,t){r(n.values)||(n.values={});var s=u[t];n.values[s]=e}),r(e.extensions)||(e.extensions={}),e.extensions.KHR_techniques_webgl=n}delete e.technique,delete e.values}),delete a.techniques,delete a.programs,delete a.shaders,a}});