define(["../Core/binarySearch","../Core/Check","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/ExtrapolationType","../Core/JulianDate","../Core/LinearApproximation"],function(t,e,i,n,r,a,o,s,h,p){"use strict";var l={packedLength:1,pack:function(t,e,n){e[n=i(n,0)]=t},unpack:function(t,e,n){return t[e=i(e,0)]}};function d(t,e,i){var n,r=t.length,a=i.length,o=r+a;if(t.length=o,r!==e){var s=r-1;for(n=o-1;n>=e;n--)t[n]=t[s--]}for(n=0;n<a;n++)t[e++]=i[n]}function f(t,e){return t instanceof h?t:"string"==typeof t?h.fromIso8601(t):h.addSeconds(e,t,new h)}var u=[],_=[];function c(e,i,r,a,o){for(var s,p,l,c,g,v,m=0;m<a.length;){g=f(a[m],e);var y=0,k=0;if((l=t(i,g,h.compare))<0){for(c=(l=~l)*o,p=void 0,v=i[l];m<a.length&&(g=f(a[m],e),!(n(p)&&h.compare(p,g)>=0||n(v)&&h.compare(g,v)>=0));){for(u[y++]=g,m+=1,s=0;s<o;s++)_[k++]=a[m],m+=1;p=g}y>0&&(_.length=k,d(r,c,_),u.length=y,d(i,l,u))}else{for(s=0;s<o;s++)m++,r[l*o+s]=a[m];m++}}}function g(t,r){e.defined("type",t);var a=t;a===Number&&(a=l);var h,d=a.packedLength,f=i(a.packedInterpolationLength,d),u=0;if(n(r)){var _=r.length;h=new Array(_);for(var c=0;c<_;c++){var g=r[c];g===Number&&(g=l);var v=g.packedLength;d+=v,f+=i(g.packedInterpolationLength,v),h[c]=g}u=_}this._type=t,this._innerType=a,this._interpolationDegree=1,this._interpolationAlgorithm=p,this._numberOfPoints=0,this._times=[],this._values=[],this._xTable=[],this._yTable=[],this._packedLength=d,this._packedInterpolationLength=f,this._updateTableLength=!0,this._interpolationResult=new Array(f),this._definitionChanged=new o,this._derivativeTypes=r,this._innerDerivativeTypes=h,this._inputOrder=u,this._forwardExtrapolationType=s.NONE,this._forwardExtrapolationDuration=0,this._backwardExtrapolationType=s.NONE,this._backwardExtrapolationDuration=0}function v(t,e,i){var n=t._packedLength;t._times.splice(e,i),t._values.splice(e*n,i*n),t._updateTableLength=!0,t._definitionChanged.raiseEvent(t)}return r(g.prototype,{isConstant:{get:function(){return 0===this._values.length}},definitionChanged:{get:function(){return this._definitionChanged}},type:{get:function(){return this._type}},derivativeTypes:{get:function(){return this._derivativeTypes}},interpolationDegree:{get:function(){return this._interpolationDegree}},interpolationAlgorithm:{get:function(){return this._interpolationAlgorithm}},forwardExtrapolationType:{get:function(){return this._forwardExtrapolationType},set:function(t){this._forwardExtrapolationType!==t&&(this._forwardExtrapolationType=t,this._definitionChanged.raiseEvent(this))}},forwardExtrapolationDuration:{get:function(){return this._forwardExtrapolationDuration},set:function(t){this._forwardExtrapolationDuration!==t&&(this._forwardExtrapolationDuration=t,this._definitionChanged.raiseEvent(this))}},backwardExtrapolationType:{get:function(){return this._backwardExtrapolationType},set:function(t){this._backwardExtrapolationType!==t&&(this._backwardExtrapolationType=t,this._definitionChanged.raiseEvent(this))}},backwardExtrapolationDuration:{get:function(){return this._backwardExtrapolationDuration},set:function(t){this._backwardExtrapolationDuration!==t&&(this._backwardExtrapolationDuration=t,this._definitionChanged.raiseEvent(this))}}}),g.prototype.getValue=function(i,r){e.defined("time",i);var a=this._times,o=a.length;if(0!==o){var p,l=this._innerType,d=this._values,f=t(a,i,h.compare);if(f<0){if(0===(f=~f)){var u=a[f];if(p=this._backwardExtrapolationDuration,this._backwardExtrapolationType===s.NONE||0!==p&&h.secondsDifference(u,i)>p)return;if(this._backwardExtrapolationType===s.HOLD)return l.unpack(d,0,r)}if(f>=o){var _=a[f=o-1];if(p=this._forwardExtrapolationDuration,this._forwardExtrapolationType===s.NONE||0!==p&&h.secondsDifference(i,_)>p)return;if(this._forwardExtrapolationType===s.HOLD)return f=o-1,l.unpack(d,f*l.packedLength,r)}var c=this._xTable,g=this._yTable,v=this._interpolationAlgorithm,m=this._packedInterpolationLength,y=this._inputOrder;if(this._updateTableLength){this._updateTableLength=!1;var k=Math.min(v.getRequiredDataPoints(this._interpolationDegree,y),o);k!==this._numberOfPoints&&(this._numberOfPoints=k,c.length=k,g.length=k*m)}var E=this._numberOfPoints-1;if(E<1)return;var T=0,w=o-1;if(w-T+1>=E+1){var b=f-(E/2|0)-1;b<T&&(b=T);var D=b+E;D>w&&(b=(D=w)-E)<T&&(b=T),T=b,w=D}for(var x=w-T+1,L=0;L<x;++L)c[L]=h.secondsDifference(a[T+L],a[w]);if(n(l.convertPackedArrayForInterpolation))l.convertPackedArrayForInterpolation(d,T,w,g);else for(var C=0,A=this._packedLength,O=T*A,I=(w+1)*A;O<I;)g[C]=d[O],O++,C++;var N,S=h.secondsDifference(i,a[w]);if(0!==y&&n(v.interpolate)){var P=Math.floor(m/(y+1));N=v.interpolate(S,c,g,P,y,y,this._interpolationResult)}else N=v.interpolateOrderZero(S,c,g,m,this._interpolationResult);return n(l.unpackInterpolationResult)?l.unpackInterpolationResult(N,d,T,w,r):l.unpack(N,0,r)}return l.unpack(d,f*this._packedLength,r)}},g.prototype.setInterpolationOptions=function(t){if(n(t)){var e=!1,i=t.interpolationAlgorithm,r=t.interpolationDegree;n(i)&&this._interpolationAlgorithm!==i&&(this._interpolationAlgorithm=i,e=!0),n(r)&&this._interpolationDegree!==r&&(this._interpolationDegree=r,e=!0),e&&(this._updateTableLength=!0,this._definitionChanged.raiseEvent(this))}},g.prototype.addSample=function(t,i,r){var a=this._innerDerivativeTypes,o=n(a);e.defined("time",t),e.defined("value",i),o&&e.defined("derivatives",r);var s=this._innerType,h=[];if(h.push(t),s.pack(i,h,h.length),o)for(var p=a.length,l=0;l<p;l++)a[l].pack(r[l],h,h.length);c(void 0,this._times,this._values,h,this._packedLength),this._updateTableLength=!0,this._definitionChanged.raiseEvent(this)},g.prototype.addSamples=function(t,i,r){var o=this._innerDerivativeTypes,s=n(o);if(e.defined("times",t),e.defined("values",i),t.length!==i.length)throw new a("times and values must be the same length.");if(s&&(!n(r)||r.length!==t.length))throw new a("times and derivativeValues must be the same length.");for(var h=this._innerType,p=t.length,l=[],d=0;d<p;d++)if(l.push(t[d]),h.pack(i[d],l,l.length),s)for(var f=r[d],u=o.length,_=0;_<u;_++)o[_].pack(f[_],l,l.length);c(void 0,this._times,this._values,l,this._packedLength),this._updateTableLength=!0,this._definitionChanged.raiseEvent(this)},g.prototype.addSamplesPackedArray=function(t,i){e.defined("packedSamples",t),c(i,this._times,this._values,t,this._packedLength),this._updateTableLength=!0,this._definitionChanged.raiseEvent(this)},g.prototype.removeSample=function(i){e.defined("time",i);var n=t(this._times,i,h.compare);return!(n<0)&&(v(this,n,1),!0)},g.prototype.removeSamples=function(i){e.defined("timeInterval",i);var n=this._times,r=t(n,i.start,h.compare);r<0?r=~r:i.isStartIncluded||++r;var a=t(n,i.stop,h.compare);a<0?a=~a:i.isStopIncluded&&++a,v(this,r,a-r)},g.prototype.equals=function(t){if(this===t)return!0;if(!n(t))return!1;if(this._type!==t._type||this._interpolationDegree!==t._interpolationDegree||this._interpolationAlgorithm!==t._interpolationAlgorithm)return!1;var e,i,r=this._derivativeTypes,a=n(r),o=t._derivativeTypes;if(a!==n(o))return!1;if(a){if((i=r.length)!==o.length)return!1;for(e=0;e<i;e++)if(r[e]!==o[e])return!1}var s=this._times,p=t._times;if((i=s.length)!==p.length)return!1;for(e=0;e<i;e++)if(!h.equals(s[e],p[e]))return!1;var l=this._values,d=t._values;for(e=0;e<i;e++)if(l[e]!==d[e])return!1;return!0},g._mergeNewSamples=c,g});