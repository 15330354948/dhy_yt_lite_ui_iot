define(["../../Core/BoundingRectangle","../../Core/Color","../../Core/Cartographic","../../Core/Cartesian3","../../Core/defined","../../Core/destroyObject","../../Core/Matrix4","../../Core/OrthographicOffCenterFrustum","../../Core/PixelFormat","../../Renderer/ClearCommand","../../Renderer/Framebuffer","../../Renderer/PixelDatatype","../../Renderer/PassState","../../Renderer/RenderState","../../Renderer/Texture"],function(e,t,r,i,o,s,a,n,h,c,u,f,p,l,d){"use strict";function m(){this._colorTexture=void 0,this._depthStencilTexture=void 0,this.framebuffer=void 0,this._viewport=new e,this._rs=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._flattenPolygonDrawCommonds=[],this._camera=new T,this._passState=void 0,this.canvas=void 0,this._clearCommand=new c({depth:1,color:new t(0,0,0,1)}),this._clearPassState=void 0,this._width=4096,this._height=4096}function _(e){e._colorTexture=e._colorTexture&&!e._colorTexture.isDestroyed()&&e._colorTexture.destroy(),e._depthStencilTexture=e._depthStencilTexture&&!e._depthStencilTexture.isDestroyed()&&e._depthStencilTexture.destroy()}function C(e){m.framebuffer=m.framebuffer&&!m.framebuffer.isDestroyed()&&m.framebuffer.destroy()}function x(e,t,r,i){r=parseInt(r),i=parseInt(i);var s=e._colorTexture,a=!o(s)||s.width!==r||s.height!==i;o(e.framebuffer)&&!a||(_(e),C(),function(e,t,r,i){e._clearPassState=new p(t),e._colorTexture=new d({context:t,width:r,height:i,pixelFormat:h.RGBA,pixelDatatype:f.UNSIGNED_BYTE}),e._depthStencilTexture=new d({context:t,width:r,height:i,pixelFormat:h.DEPTH_STENCIL,pixelDatatype:f.UNSIGNED_INT_24_8})}(e,t,r,i),function(e,t){e.framebuffer=new u({context:t,colorTextures:[e._colorTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1})}(e,t))}function T(){this.viewMatrix=a.IDENTITY,this.inverseViewMatrix=a.IDENTITY,this.frustum=new n,this.positionCartographic=new r,this.positionWC=new i,this.directionWC=i.clone(i.UNIT_Z),this.upWC=i.clone(i.UNIT_Y),this.rightWC=i.clone(i.UNIT_X),this.viewProjectionMatrix=a.IDENTITY}return T.prototype.clone=function(e){a.clone(e.viewMatrix,this.viewMatrix),a.clone(e.inverseViewMatrix,this.inverseViewMatrix),this.frustum=e.frustum.clone(this.frustum),r.clone(e.positionCartographic,this.positionCartographic),i.clone(e.positionWC,this.positionWC),i.clone(e.directionWC,this.directionWC),i.clone(e.upWC,this.upWC),i.clone(e.rightWC,this.rightWC)},m.prototype.updateFrustum=function(e,t,r,i){this._camera.frustum.left=parseInt(e),this._camera.frustum.top=parseInt(t),this._camera.frustum.right=parseInt(r),this._camera.frustum.bottom=parseInt(i)},m.prototype.update=function(t){var r=this._width,i=this._height,s=t.context;x(this,s,r,i),o(this._passState)||(this._passState=new p(s),this._passState.framebuffer=this.framebuffer,this._passState.viewport=new e(0,0,r,i));var a=s.uniformState;a.updateCamera(this._camera),this._clearCommand.framebuffer=this.framebuffer,this._clearCommand.execute(s,this._clearPassState);for(var n=0;n<this._flattenPolygonDrawCommonds.length;n++){var h=this._flattenPolygonDrawCommonds[n];a.updatePass(h.pass),h.framebuffer=this.framebuffer,h.execute(s,this._passState)}},m.prototype.clear=function(e,r,i){var s=this._clearColorCommand;o(s)&&(t.clone(i,s.color),s.execute(e,r))},m.prototype.isDestroyed=function(){return!1},m.prototype.destroy=function(){return _(this),C(),s(this)},m});