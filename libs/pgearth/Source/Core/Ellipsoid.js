define(["./Cartesian3","./Cartographic","./Check","./defaultValue","./defined","./defineProperties","./DeveloperError","./freezeObject","./Math","./scaleToGeodeticSurface"],function(e,r,i,t,a,n,o,u,d,c){"use strict";function s(r,a,n,o){a=t(a,0),n=t(n,0),o=t(o,0),i.typeOf.number.greaterThanOrEquals("x",a,0),i.typeOf.number.greaterThanOrEquals("y",n,0),i.typeOf.number.greaterThanOrEquals("z",o,0),r._radii=new e(a,n,o),r._radiiSquared=new e(a*a,n*n,o*o),r._radiiToTheFourth=new e(a*a*a*a,n*n*n*n,o*o*o*o),r._oneOverRadii=new e(0===a?0:1/a,0===n?0:1/n,0===o?0:1/o),r._oneOverRadiiSquared=new e(0===a?0:1/(a*a),0===n?0:1/(n*n),0===o?0:1/(o*o)),r._minimumRadius=Math.min(a,n,o),r._maximumRadius=Math.max(a,n,o),r._centerToleranceSquared=d.EPSILON1,0!==r._radiiSquared.z&&(r._squaredXOverSquaredZ=r._radiiSquared.x/r._radiiSquared.z)}function h(e,r,i){this._radii=void 0,this._radiiSquared=void 0,this._radiiToTheFourth=void 0,this._oneOverRadii=void 0,this._oneOverRadiiSquared=void 0,this._minimumRadius=void 0,this._maximumRadius=void 0,this._centerToleranceSquared=void 0,this._squaredXOverSquaredZ=void 0,s(this,e,r,i)}n(h.prototype,{radii:{get:function(){return this._radii}},radiiSquared:{get:function(){return this._radiiSquared}},radiiToTheFourth:{get:function(){return this._radiiToTheFourth}},oneOverRadii:{get:function(){return this._oneOverRadii}},oneOverRadiiSquared:{get:function(){return this._oneOverRadiiSquared}},minimumRadius:{get:function(){return this._minimumRadius}},maximumRadius:{get:function(){return this._maximumRadius}}}),h.clone=function(r,i){if(a(r)){var t=r._radii;return a(i)?(e.clone(t,i._radii),e.clone(r._radiiSquared,i._radiiSquared),e.clone(r._radiiToTheFourth,i._radiiToTheFourth),e.clone(r._oneOverRadii,i._oneOverRadii),e.clone(r._oneOverRadiiSquared,i._oneOverRadiiSquared),i._minimumRadius=r._minimumRadius,i._maximumRadius=r._maximumRadius,i._centerToleranceSquared=r._centerToleranceSquared,i):new h(t.x,t.y,t.z)}},h.fromCartesian3=function(e,r){return a(r)||(r=new h),a(e)?(s(r,e.x,e.y,e.z),r):r},h.WGS84=u(new h(6378137,6378137,6356752.314245179)),h.UNIT_SPHERE=u(new h(1,1,1)),h.MOON=u(new h(d.LUNAR_RADIUS,d.LUNAR_RADIUS,d.LUNAR_RADIUS)),h.prototype.clone=function(e){return h.clone(this,e)},h.packedLength=e.packedLength,h.pack=function(r,a,n){return i.typeOf.object("value",r),i.defined("array",a),n=t(n,0),e.pack(r._radii,a,n),a},h.unpack=function(r,a,n){i.defined("array",r),a=t(a,0);var o=e.unpack(r,a);return h.fromCartesian3(o,n)},h.prototype.geocentricSurfaceNormal=e.normalize,h.prototype.geodeticSurfaceNormalCartographic=function(r,t){i.typeOf.object("cartographic",r);var n=r.longitude,o=r.latitude,u=Math.cos(o),d=u*Math.cos(n),c=u*Math.sin(n),s=Math.sin(o);return a(t)||(t=new e),t.x=d,t.y=c,t.z=s,e.normalize(t,t)},h.prototype.geodeticSurfaceNormal=function(r,i){return a(i)||(i=new e),i=e.multiplyComponents(r,this._oneOverRadiiSquared,i),e.normalize(i,i)};var p=new e,l=new e;h.prototype.cartographicToCartesian=function(r,i){var t=p,n=l;this.geodeticSurfaceNormalCartographic(r,t),e.multiplyComponents(this._radiiSquared,t,n);var o=Math.sqrt(e.dot(t,n));return e.divideByScalar(n,o,n),e.multiplyByScalar(t,r.height,t),a(i)||(i=new e),e.add(n,t,i)},h.prototype.cartographicArrayToCartesianArray=function(e,r){i.defined("cartographics",e);var t=e.length;a(r)?r.length=t:r=new Array(t);for(var n=0;n<t;n++)r[n]=this.cartographicToCartesian(e[n],r[n]);return r};var m=new e,f=new e,_=new e;return h.prototype.cartesianToCartographic=function(i,t){var n=this.scaleToGeodeticSurface(i,f);if(a(n)){var o=this.geodeticSurfaceNormal(n,m),u=e.subtract(i,n,_),c=Math.atan2(o.y,o.x),s=Math.asin(o.z),h=d.sign(e.dot(u,i))*e.magnitude(u);return a(t)?(t.longitude=c,t.latitude=s,t.height=h,t):new r(c,s,h)}},h.prototype.cartesianArrayToCartographicArray=function(e,r){i.defined("cartesians",e);var t=e.length;a(r)?r.length=t:r=new Array(t);for(var n=0;n<t;++n)r[n]=this.cartesianToCartographic(e[n],r[n]);return r},h.prototype.scaleToGeodeticSurface=function(e,r){return c(e,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,r)},h.prototype.scaleToGeocentricSurface=function(r,t){i.typeOf.object("cartesian",r),a(t)||(t=new e);var n=r.x,o=r.y,u=r.z,d=this._oneOverRadiiSquared,c=1/Math.sqrt(n*n*d.x+o*o*d.y+u*u*d.z);return e.multiplyByScalar(r,c,t)},h.prototype.transformPositionToScaledSpace=function(r,i){return a(i)||(i=new e),e.multiplyComponents(r,this._oneOverRadii,i)},h.prototype.transformPositionFromScaledSpace=function(r,i){return a(i)||(i=new e),e.multiplyComponents(r,this._radii,i)},h.prototype.equals=function(r){return this===r||a(r)&&e.equals(this._radii,r._radii)},h.prototype.toString=function(){return this._radii.toString()},h.prototype.getSurfaceNormalIntersectionWithZAxis=function(r,n,u){if(i.typeOf.object("position",r),!d.equalsEpsilon(this._radii.x,this._radii.y,d.EPSILON15))throw new o("Ellipsoid must be an ellipsoid of revolution (radii.x == radii.y)");i.typeOf.number.greaterThan("Ellipsoid.radii.z",this._radii.z,0),n=t(n,0);var c=this._squaredXOverSquaredZ;if(a(u)||(u=new e),u.x=0,u.y=0,u.z=r.z*(1-c),!(Math.abs(u.z)>=this._radii.z-n))return u},h});