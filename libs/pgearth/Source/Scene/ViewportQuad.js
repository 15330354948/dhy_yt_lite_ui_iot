define(["../Core/BoundingRectangle","../Core/Color","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Renderer/Pass","../Renderer/RenderState","../Renderer/ShaderSource","../Shaders/ViewportQuadFS","./BlendingState","./Material"],function(e,r,t,a,o,i,s,n,m,h,d){"use strict";function l(a,o){this.show=!0,t(a)||(a=new e),this.rectangle=e.clone(a),t(o)||(o=d.fromType(d.ColorType,{color:new r(1,1,1,1)})),this.material=o,this._material=void 0,this._overlayCommand=void 0,this._rs=void 0}return l.prototype.update=function(r){if(this.show){if(!t(this.material))throw new o("this.material must be defined.");if(!t(this.rectangle))throw new o("this.rectangle must be defined.");var a=this._rs;if(t(a)&&e.equals(a.viewport,this.rectangle)||(this._rs=s.fromCache({blending:h.ALPHA_BLEND,viewport:this.rectangle})),r.passes.render){var d=r.context;if(this._material!==this.material||!t(this._overlayCommand)){this._material=this.material,t(this._overlayCommand)&&this._overlayCommand.shaderProgram.destroy();var l=new n({sources:[this._material.shaderSource,m]});this._overlayCommand=d.createViewportQuadCommand(l,{renderState:this._rs,uniformMap:this._material._uniforms,owner:this}),this._overlayCommand.pass=i.OVERLAY}this._material.update(d),this._overlayCommand.uniformMap=this._material._uniforms,r.commandList.push(this._overlayCommand)}}},l.prototype.isDestroyed=function(){return!1},l.prototype.destroy=function(){return t(this._overlayCommand)&&(this._overlayCommand.shaderProgram=this._overlayCommand.shaderProgram&&this._overlayCommand.shaderProgram.destroy()),a(this)},l});