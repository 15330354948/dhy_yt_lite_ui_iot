define(["../Core/AssociativeArray","../Core/buildModuleUrl","../Core/Check","../Core/Credit","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject"],function(t,e,i,r,d,a,n,o){"use strict";var h=576,l=100,s="#ffffff",p="#48b";var c,g="pgEarth-credit-delimiter";function C(t){var e=document.createElement("span");return e.textContent=t,e.className=g,e}function u(t,e){if(a(e)){var i=document.createElement(e);i._creditId=t._creditId,i.appendChild(t),t=i}return t}function x(t,e,i,r){for(var d=t.childNodes,n=-1,o=0;o<e.length;++o){var h=e[o];if(a(h)){if(n=o,a(i)&&(n*=2,o>0)){var l=n-1;if(d.length<=l)t.appendChild(C(i));else{var s=d[l];s.className!==g&&t.replaceChild(C(i),s)}}var p=h.element;if(d.length<=n)t.appendChild(u(p,r));else{var c=d[n];c._creditId!==h._id&&t.replaceChild(u(p,r),c)}}}for(++n;n<d.length;)t.removeChild(d[n])}function v(t,e){var i=t+" {";for(var r in e)e.hasOwnProperty(r)&&(i+=r+": "+e[r]+"; ");return i+=" }\n"}function m(e,a,n){i.defined("container",e);var o=this;n=d(n,document.body);var h=document.createElement("div");h.className="pgEarth-credit-lightbox-overlay",n.appendChild(h);var c=document.createElement("div");function g(t){c.contains(t.target)||o.hideLightbox()}c.className="pgEarth-credit-lightbox",h.appendChild(c),h.addEventListener("click",g,!1);var C=document.createElement("div");C.className="pgEarth-credit-lightbox-title",C.textContent="Data provided by:",c.appendChild(C);var u=document.createElement("a");u.onclick=this.hideLightbox.bind(this),u.innerHTML="&times;",u.className="pgEarth-credit-lightbox-close",c.appendChild(u);var x=document.createElement("ul");c.appendChild(x);var E=document.createElement("div");E.className="pgEarth-credit-logoContainer",E.style.display="inline",e.appendChild(E);var _=document.createElement("div");_.className="pgEarth-credit-textContainer",_.style.display="inline",e.appendChild(_);var f=document.createElement("a");f.className="pgEarth-credit-expand-link",f.onclick=this.showLightbox.bind(this),f.textContent="Data attribution",e.appendChild(f),function(){var t="";t+=v(".pgEarth-credit-lightbox-overlay",{display:"none","z-index":"1",position:"absolute",top:"0",left:"0",width:"100%",height:"100%","background-color":"rgba(80, 80, 80, 0.8)"}),t+=v(".pgEarth-credit-lightbox",{"background-color":"#303336",color:s,position:"relative","min-height":l+"px",margin:"auto"}),t+=v(".pgEarth-credit-lightbox > ul > li a, .pgEarth-credit-lightbox > ul > li a:visited",{color:s}),t+=v(".pgEarth-credit-lightbox > ul > li a:hover",{color:p}),t+=v(".pgEarth-credit-lightbox.pgEarth-credit-lightbox-expanded",{border:"1px solid #444","border-radius":"5px","max-width":"370px"}),t+=v(".pgEarth-credit-lightbox.pgEarth-credit-lightbox-mobile",{height:"100%",width:"100%"}),t+=v(".pgEarth-credit-lightbox-title",{padding:"20px 20px 0 20px"}),t+=v(".pgEarth-credit-lightbox-close",{"font-size":"18pt",cursor:"pointer",position:"absolute",top:"0",right:"6px",color:s}),t+=v(".pgEarth-credit-lightbox-close:hover",{color:p}),t+=v(".pgEarth-credit-lightbox > ul",{margin:"0",padding:"12px 20px 12px 40px","font-size":"13px"}),t+=v(".pgEarth-credit-lightbox > ul > li",{"padding-bottom":"6px"}),t+=v(".pgEarth-credit-lightbox > ul > li *",{padding:"0",margin:"0"}),t+=v(".pgEarth-credit-expand-link",{"padding-left":"5px",cursor:"pointer","text-decoration":"underline",color:s}),t+=v(".pgEarth-credit-expand-link:hover",{color:p}),t+=v(".pgEarth-credit-text",{color:s}),t+=v(".pgEarth-credit-textContainer *, .pgEarth-credit-logoContainer *",{display:"inline"});var e=document.head,i=document.createElement("style");i.innerHTML=t,e.insertBefore(i,e.firstChild)}();var b=r.clone(m.pgEarthCredit);this._delimiter=d(a," â€¢ "),this._screenContainer=_,this._pgEarthCreditContainer=E,this._lastViewportHeight=void 0,this._lastViewportWidth=void 0,this._lightboxCredits=c,this._creditList=x,this._lightbox=h,this._hideLightbox=g,this._expandLink=f,this._expanded=!1,this._defaultCredits=[],this._pgEarthCredit=b,this._previousPGEarthCredit=void 0,this._currentPGEarthCredit=b,this._currentFrameCredits={screenCredits:new t,lightboxCredits:new t},this._defaultCredit=void 0,this.viewport=n,this.container=e}function E(){if(!a(c)){var t=e("Assets/Images/ion-credit.png");c=new r('<a href="https://pgEarth.com/" target="_blank"><img src="'+t+'" title="PGEarth ion"/></a>',!0)}return m._pgEarthCreditInitialized||(m._pgEarthCredit=c,m._pgEarthCreditInitialized=!0),c}return m.prototype.addCredit=function(t){if(i.defined("credit",t),t._isIon)return a(this._defaultCredit)||(this._defaultCredit=r.clone(E())),void(this._currentPGEarthCredit=this._defaultCredit);t.showOnScreen?this._currentFrameCredits.screenCredits.set(t.id,t):this._currentFrameCredits.lightboxCredits.set(t.id,t)},m.prototype.addDefaultCredit=function(t){i.defined("credit",t);var e=this._defaultCredits;(function(t,e){for(var i=t.length,d=0;d<i;d++){var a=t[d];if(r.equals(a,e))return!0}return!1})(e,t)||e.push(t)},m.prototype.removeDefaultCredit=function(t){i.defined("credit",t);var e=this._defaultCredits,r=e.indexOf(t);-1!==r&&e.splice(r,1)},m.prototype.showLightbox=function(){this._lightbox.style.display="block",this._expanded=!0},m.prototype.hideLightbox=function(){this._lightbox.style.display="none",this._expanded=!1},m.prototype.update=function(){var t,e,i,r;this._expanded&&(e=(t=this)._lightboxCredits,i=t.viewport.clientWidth,r=t.viewport.clientHeight,i!==t._lastViewportWidth&&(i<h?(e.className="pgEarth-credit-lightbox pgEarth-credit-lightbox-mobile",e.style.marginTop="0"):(e.className="pgEarth-credit-lightbox pgEarth-credit-lightbox-expanded",e.style.marginTop=Math.floor(.5*(r-e.clientHeight))+"px"),t._lastViewportWidth=i),i>=h&&r!==t._lastViewportHeight&&(e.style.marginTop=Math.floor(.5*(r-e.clientHeight))+"px",t._lastViewportHeight=r))},m.prototype.beginFrame=function(){var t=this._currentFrameCredits,e=t.screenCredits;e.removeAll();for(var i=this._defaultCredits,d=0;d<i.length;++d){var a=i[d];e.set(a.id,a)}t.lightboxCredits.removeAll(),r.equals(m.pgEarthCredit,this._pgEarthCredit)||(this._pgEarthCredit=r.clone(m.pgEarthCredit)),this._currentPGEarthCredit=this._pgEarthCredit},m.prototype.endFrame=function(){var t=this._currentFrameCredits.screenCredits.values;x(this._screenContainer,t,this._delimiter,void 0);var e,i,d,n=this._currentFrameCredits.lightboxCredits.values;this._expandLink.style.display=n.length>0?"inline":"none",x(this._creditList,n,void 0,"li"),i=(e=this)._previousPGEarthCredit,d=e._currentPGEarthCredit,r.equals(d,i)||(a(i)&&e._pgEarthCreditContainer.removeChild(i.element),a(d)&&e._pgEarthCreditContainer.appendChild(d.element),e._previousPGEarthCredit=d)},m.prototype.destroy=function(){return this._lightbox.removeEventListener("click",this._hideLightbox,!1),this.container.removeChild(this._pgEarthCreditContainer),this.container.removeChild(this._screenContainer),this.container.removeChild(this._expandLink),this.viewport.removeChild(this._lightbox),o(this)},m.prototype.isDestroyed=function(){return!1},m._pgEarthCredit=void 0,m._pgEarthCreditInitialized=!1,n(m,{pgEarthCredit:{get:function(){return E(),m._pgEarthCredit},set:function(t){m._pgEarthCredit=t,m._pgEarthCreditInitialized=!0}}}),m});