define(function(){function t(h){if(h instanceof t)this.scheme=h.scheme,this.authority=h.authority,this.path=h.path,this.query=h.query,this.fragment=h.fragment;else if(h){var r=e.exec(h);this.scheme=r[1],this.authority=r[2],this.path=r[3],this.query=r[4],this.fragment=r[5]}}t.prototype.scheme=null,t.prototype.authority=null,t.prototype.path="",t.prototype.query=null,t.prototype.fragment=null;var e=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$");t.prototype.getScheme=function(){return this.scheme},t.prototype.getAuthority=function(){return this.authority},t.prototype.getPath=function(){return this.path},t.prototype.getQuery=function(){return this.query},t.prototype.getFragment=function(){return this.fragment},t.prototype.isAbsolute=function(){return!!this.scheme&&!this.fragment},t.prototype.isSameDocumentAs=function(t){return t.scheme==this.scheme&&t.authority==this.authority&&t.path==this.path&&t.query==this.query},t.prototype.equals=function(t){return this.isSameDocumentAs(t)&&t.fragment==this.fragment},t.prototype.normalize=function(){this.removeDotSegments(),this.scheme&&(this.scheme=this.scheme.toLowerCase()),this.authority&&(this.authority=this.authority.replace(i,o).replace(h,s)),this.path&&(this.path=this.path.replace(h,s)),this.query&&(this.query=this.query.replace(h,s)),this.fragment&&(this.fragment=this.fragment.replace(h,s))};var h=/%[0-9a-z]{2}/gi,r=/[a-zA-Z0-9\-\._~]/,i=/(.*@)?([^@:]*)(:.*)?/;function s(t){var e=unescape(t);return r.test(e)?e:t.toUpperCase()}function o(t,e,h,r){return(e||"")+h.toLowerCase()+(r||"")}return t.prototype.resolve=function(e){var h=new t;return this.scheme?(h.scheme=this.scheme,h.authority=this.authority,h.path=this.path,h.query=this.query):(h.scheme=e.scheme,this.authority?(h.authority=this.authority,h.path=this.path,h.query=this.query):(h.authority=e.authority,""==this.path?(h.path=e.path,h.query=this.query||e.query):("/"==this.path.charAt(0)?(h.path=this.path,h.removeDotSegments()):(e.authority&&""==e.path?h.path="/"+this.path:h.path=e.path.substring(0,e.path.lastIndexOf("/")+1)+this.path,h.removeDotSegments()),h.query=this.query))),h.fragment=this.fragment,h},t.prototype.removeDotSegments=function(){var t,e=this.path.split("/"),h=[],r=""==e[0];r&&e.shift();for(""==e[0]&&e.shift();e.length;)".."==(t=e.shift())?h.pop():"."!=t&&h.push(t);"."!=t&&".."!=t||h.push(""),r&&h.unshift(""),this.path=h.join("/")},t.prototype.toString=function(){var t="";return this.scheme&&(t+=this.scheme+":"),this.authority&&(t+="//"+this.authority),t+=this.path,this.query&&(t+="?"+this.query),this.fragment&&(t+="#"+this.fragment),t},t});