define(["./Cartesian2","./defaultValue","./defined","./defineProperties","./Ellipsoid","./Rectangle","./WebMercatorProjection"],function(e,t,r,n,s,i,o){"use strict";function l(n){if(n=t(n,{}),this._ellipsoid=t(n.ellipsoid,s.WGS84),this._numberOfLevelZeroTilesX=t(n.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=t(n.numberOfLevelZeroTilesY,1),this._projection=new o(this._ellipsoid),r(n.rectangleSouthwestInMeters)&&r(n.rectangleNortheastInMeters))this._rectangleSouthwestInMeters=n.rectangleSouthwestInMeters,this._rectangleNortheastInMeters=n.rectangleNortheastInMeters;else{var l=this._ellipsoid.maximumRadius*Math.PI;this._rectangleSouthwestInMeters=new e(-l,-l),this._rectangleNortheastInMeters=new e(l,l)}var h=this._projection.unproject(this._rectangleSouthwestInMeters),a=this._projection.unproject(this._rectangleNortheastInMeters);this._rectangle=new i(h.longitude,h.latitude,a.longitude,a.latitude)}return n(l.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),l.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},l.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},l.prototype.rectangleToNativeRectangle=function(e,t){var n=this._projection,s=n.project(i.southwest(e)),o=n.project(i.northeast(e));return r(t)?(t.west=s.x,t.south=s.y,t.east=o.x,t.north=o.y,t):new i(s.x,s.y,o.x,o.y)},l.prototype.tileXYToNativeRectangle=function(e,t,n,s){var o=this.getNumberOfXTilesAtLevel(n),l=this.getNumberOfYTilesAtLevel(n),h=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/o,a=this._rectangleSouthwestInMeters.x+e*h,u=this._rectangleSouthwestInMeters.x+(e+1)*h,c=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/l,g=this._rectangleNortheastInMeters.y-t*c,p=this._rectangleNortheastInMeters.y-(t+1)*c;return r(s)?(s.west=a,s.south=p,s.east=u,s.north=g,s):new i(a,p,u,g)},l.prototype.tileXYToRectangle=function(t,r,n,s){var i=this.tileXYToNativeRectangle(t,r,n,s),o=this._projection,l=o.unproject(new e(i.west,i.south)),h=o.unproject(new e(i.east,i.north));return i.west=l.longitude,i.south=l.latitude,i.east=h.longitude,i.north=h.latitude,i},l.prototype.positionToTileXY=function(t,n,s){var o=this._rectangle;if(i.contains(o,t)){var l=this.getNumberOfXTilesAtLevel(n),h=this.getNumberOfYTilesAtLevel(n),a=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/l,u=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/h,c=this._projection.project(t),g=c.x-this._rectangleSouthwestInMeters.x,p=this._rectangleNortheastInMeters.y-c.y,_=g/a|0;_>=l&&(_=l-1);var f=p/u|0;return f>=h&&(f=h-1),r(s)?(s.x=_,s.y=f,s):new e(_,f)}},l});