define(["../Core/Intersect","../Core/ManagedArray","./PGEarth3DTileRefine"],function(e,t,n){"use strict";function i(){}var r={stack:new t,stackMaximumLength:0};function a(e){return e._visible&&e._inRequestVolume}function s(e){return e.hasEmptyContent||e.hasTilesetContent}function u(e,t){return 0!==t.children.length&&(t.hasTilesetContent?!t.contentExpired:(t.hasEmptyContent,!0))}function c(e,t,n,i){for(var r=t.children,s=r.length,u=0;u<s;++u){var c=r[u];c.updateVisibility(i),a(c)&&n.push(c)}}function o(e,t){((function(e){return!s(e)&&e.contentUnloaded})(t)||t.contentExpired)&&(t._priority=0,e._requestedTiles.push(t))}function l(e,t,n){t._touchedFrame!==n.frameNumber&&(e._cache.touch(t),t._touchedFrame=n.frameNumber)}function h(e){++e.statistics.visited}function f(t,n,i){n.contentAvailable&&n.contentVisibility(i)!==e.OUTSIDE&&t._selectedTiles.push(n)}return i.selectTiles=function(e,t){e._selectedTiles.length=0,e._requestedTiles.length=0,e._hasMixedContent=!1;var i=!0,m=e.root;if(m.updateVisibility(t),!a(m))return i;var d=r.stack;for(d.push(e.root);d.length>0;){r.stackMaximumLength=Math.max(r.stackMaximumLength,d.length);var p=d.pop(),g=p.refine===n.ADD,_=p.refine===n.REPLACE,v=u(e,p);v&&c(e,p,d,t),(g||_&&!v)&&(o(e,p),l(e,p,t),f(e,p,t),s(p)||p.contentAvailable||(i=!1)),h(e)}return r.stack.trim(r.stackMaximumLength),i},i});