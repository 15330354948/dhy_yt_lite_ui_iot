define(["./arrayFill","./BoundingSphere","./Cartesian3","./Cartographic","./ComponentDatatype","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryOffsetAttribute","./IndexDatatype","./Math","./PolygonPipeline","./PrimitiveType","./Rectangle","./RectangleGeometryLibrary"],function(t,e,i,r,a,o,n,s,u,l,h,p,c,f,g,d,v,_,y){"use strict";var b=new e,w=new e,m=new i,A=new _;function E(t,e){var i=t._ellipsoid,r=e.height,o=e.width,n=e.northCap,s=e.southCap,u=r,c=2,g=0,d=4;n&&(c-=1,u-=1,g+=1,d-=2),s&&(c-=1,u-=1,g+=1,d-=2),g+=c*o+2*u-d;var _,b=new Float64Array(3*g),w=0,A=0,E=m;if(n)y.computePosition(e,i,!1,A,0,E),b[w++]=E.x,b[w++]=E.y,b[w++]=E.z;else for(_=0;_<o;_++)y.computePosition(e,i,!1,A,_,E),b[w++]=E.x,b[w++]=E.y,b[w++]=E.z;for(_=o-1,A=1;A<r;A++)y.computePosition(e,i,!1,A,_,E),b[w++]=E.x,b[w++]=E.y,b[w++]=E.z;if(A=r-1,!s)for(_=o-2;_>=0;_--)y.computePosition(e,i,!1,A,_,E),b[w++]=E.x,b[w++]=E.y,b[w++]=E.z;for(_=0,A=r-2;A>0;A--)y.computePosition(e,i,!1,A,_,E),b[w++]=E.x,b[w++]=E.y,b[w++]=E.z;for(var P=b.length/3*2,H=f.createTypedArray(b.length/3,P),N=0,x=0;x<b.length/3-1;x++)H[N++]=x,H[N++]=x+1;H[N++]=b.length/3-1,H[N++]=0;var k=new l({attributes:new p,primitiveType:v.LINES});return k.attributes.position=new h({componentDatatype:a.DOUBLE,componentsPerAttribute:3,values:b}),k.indices=H,k}function P(t){var e=(t=o(t,o.EMPTY_OBJECT)).rectangle,i=o(t.granularity,g.RADIANS_PER_DEGREE),r=o(t.ellipsoid,u.WGS84),a=o(t.rotation,0);if(!n(e))throw new s("rectangle is required.");if(_.validate(e),e.north<e.south)throw new s("options.rectangle.north must be greater than options.rectangle.south");var l=o(t.height,0),h=o(t.extrudedHeight,l);this._rectangle=_.clone(e),this._granularity=i,this._ellipsoid=r,this._surfaceHeight=Math.max(l,h),this._rotation=a,this._extrudedHeight=Math.min(l,h),this._offsetAttribute=t.offsetAttribute,this._workerName="createRectangleOutlineGeometry"}P.packedLength=_.packedLength+u.packedLength+5,P.pack=function(t,e,i){if(!n(t))throw new s("value is required");if(!n(e))throw new s("array is required");return i=o(i,0),_.pack(t._rectangle,e,i),i+=_.packedLength,u.pack(t._ellipsoid,e,i),i+=u.packedLength,e[i++]=t._granularity,e[i++]=t._surfaceHeight,e[i++]=t._rotation,e[i++]=t._extrudedHeight,e[i]=o(t._offsetAttribute,-1),e};var H=new _,N=u.clone(u.UNIT_SPHERE),x={rectangle:H,ellipsoid:N,granularity:void 0,height:void 0,rotation:void 0,extrudedHeight:void 0,offsetAttribute:void 0};P.unpack=function(t,e,i){if(!n(t))throw new s("array is required");e=o(e,0);var r=_.unpack(t,e,H);e+=_.packedLength;var a=u.unpack(t,e,N);e+=u.packedLength;var l=t[e++],h=t[e++],p=t[e++],c=t[e++],f=t[e];return n(i)?(i._rectangle=_.clone(r,i._rectangle),i._ellipsoid=u.clone(a,i._ellipsoid),i._surfaceHeight=h,i._rotation=p,i._extrudedHeight=c,i._offsetAttribute=-1===f?void 0:f,i):(x.granularity=l,x.height=h,x.rotation=p,x.extrudedHeight=c,x.offsetAttribute=-1===f?void 0:f,new P(x))};var k=new r;return P.createGeometry=function(i){var r,o,s=i._rectangle,u=i._ellipsoid,p=y.computeOptions(s,i._granularity,i._rotation,0,A,k);if(!g.equalsEpsilon(s.north,s.south,g.EPSILON10)&&!g.equalsEpsilon(s.east,s.west,g.EPSILON10)){var _,m=i._surfaceHeight,P=i._extrudedHeight;if(!g.equalsEpsilon(m,P,0,g.EPSILON2)){if(r=function(t,e){var i=t._surfaceHeight,r=t._extrudedHeight,a=t._ellipsoid,o=r,n=i,s=E(t,e),u=e.height,l=e.width,h=d.scaleToGeodeticHeight(s.attributes.position.values,n,a,!1),p=h.length,c=new Float64Array(2*p);c.set(h);var g=d.scaleToGeodeticHeight(s.attributes.position.values,o,a);c.set(g,p),s.attributes.position.values=c;var v=e.northCap,_=e.southCap,y=4;v&&(y-=1),_&&(y-=1);var b=2*(c.length/3+y),w=f.createTypedArray(c.length/3,b);p=c.length/6;for(var m,A=0,P=0;P<p-1;P++)w[A++]=P,w[A++]=P+1,w[A++]=P+p,w[A++]=P+p+1;if(w[A++]=p-1,w[A++]=0,w[A++]=p+p-1,w[A++]=p,w[A++]=0,w[A++]=p,v)m=u-1;else{var H=l-1;w[A++]=H,w[A++]=H+p,m=l+u-2}if(w[A++]=m,w[A++]=m+p,!_){var N=l+m-1;w[A++]=N,w[A]=N+p}return s.indices=w,s}(i,p),n(i._offsetAttribute)){var H=r.attributes.position.values.length/3,N=new Uint8Array(H);i._offsetAttribute===c.TOP?N=t(N,1,0,H/2):(_=i._offsetAttribute===c.NONE?0:1,N=t(N,_)),r.attributes.applyOffset=new h({componentDatatype:a.UNSIGNED_BYTE,componentsPerAttribute:1,values:N})}var x=e.fromRectangle3D(s,u,m,w),D=e.fromRectangle3D(s,u,P,b);o=e.union(x,D)}else{if((r=E(i,p)).attributes.position.values=d.scaleToGeodeticHeight(r.attributes.position.values,m,u,!1),n(i._offsetAttribute)){var G=r.attributes.position.values.length,L=new Uint8Array(G/3);_=i._offsetAttribute===c.NONE?0:1,t(L,_),r.attributes.applyOffset=new h({componentDatatype:a.UNSIGNED_BYTE,componentsPerAttribute:1,values:L})}o=e.fromRectangle3D(s,u,m)}return new l({attributes:r.attributes,indices:r.indices,primitiveType:v.LINES,boundingSphere:o,offsetAttribute:i._offsetAttribute})}},P});