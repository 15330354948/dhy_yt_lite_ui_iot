define(["./Cartesian3","./Check","./defaultValue","./defined","./FeatureDetection","./freezeObject","./Math","./Matrix3"],function(t,e,n,r,a,o,u,y){"use strict";function c(t,e,r,a){this.x=n(t,0),this.y=n(e,0),this.z=n(r,0),this.w=n(a,0)}var l=new t;c.fromAxisAngle=function(n,a,o){e.typeOf.object("axis",n),e.typeOf.number("angle",a);var u=a/2,y=Math.sin(u),p=(l=t.normalize(n,l)).x*y,i=l.y*y,f=l.z*y,s=Math.cos(u);return r(o)?(o.x=p,o.y=i,o.z=f,o.w=s,o):new c(p,i,f,s)};var p=[1,2,0],i=new Array(3);c.fromRotationMatrix=function(t,n){var a,o,u,l,f;e.typeOf.object("matrix",t);var s=t[y.COLUMN0ROW0],O=t[y.COLUMN1ROW1],b=t[y.COLUMN2ROW2],w=s+O+b;if(w>0)f=.5*(a=Math.sqrt(w+1)),a=.5/a,o=(t[y.COLUMN1ROW2]-t[y.COLUMN2ROW1])*a,u=(t[y.COLUMN2ROW0]-t[y.COLUMN0ROW2])*a,l=(t[y.COLUMN0ROW1]-t[y.COLUMN1ROW0])*a;else{var x=0;O>s&&(x=1),b>s&&b>O&&(x=2);var j=p[x],m=p[j];a=Math.sqrt(t[y.getElementIndex(x,x)]-t[y.getElementIndex(j,j)]-t[y.getElementIndex(m,m)]+1);var d=i;d[x]=.5*a,a=.5/a,f=(t[y.getElementIndex(m,j)]-t[y.getElementIndex(j,m)])*a,d[j]=(t[y.getElementIndex(j,x)]+t[y.getElementIndex(x,j)])*a,d[m]=(t[y.getElementIndex(m,x)]+t[y.getElementIndex(x,m)])*a,o=-d[0],u=-d[1],l=-d[2]}return r(n)?(n.x=o,n.y=u,n.z=l,n.w=f,n):new c(o,u,l,f)};var f=new c,s=new c,O=new c,b=new c;c.fromHeadingPitchRoll=function(n,r){return e.typeOf.object("headingPitchRoll",n),b=c.fromAxisAngle(t.UNIT_X,n.roll,f),O=c.fromAxisAngle(t.UNIT_Y,-n.pitch,r),r=c.multiply(O,b,O),s=c.fromAxisAngle(t.UNIT_Z,-n.heading,f),c.multiply(s,r,r)};var w=new t,x=new t,j=new c,m=new c,d=new c;c.packedLength=4,c.pack=function(t,r,a){return e.typeOf.object("value",t),e.defined("array",r),a=n(a,0),r[a++]=t.x,r[a++]=t.y,r[a++]=t.z,r[a]=t.w,r},c.unpack=function(t,a,o){return e.defined("array",t),a=n(a,0),r(o)||(o=new c),o.x=t[a],o.y=t[a+1],o.z=t[a+2],o.w=t[a+3],o},c.packedInterpolationLength=3,c.convertPackedArrayForInterpolation=function(t,e,n,r){c.unpack(t,4*n,d),c.conjugate(d,d);for(var a=0,o=n-e+1;a<o;a++){var u=3*a;c.unpack(t,4*(e+a),j),c.multiply(j,d,j),j.w<0&&c.negate(j,j),c.computeAxis(j,w);var y=c.computeAngle(j);r[u]=w.x*y,r[u+1]=w.y*y,r[u+2]=w.z*y}},c.unpackInterpolationResult=function(e,n,a,o,u){r(u)||(u=new c),t.fromArray(e,0,x);var y=t.magnitude(x);return c.unpack(n,4*o,m),0===y?c.clone(c.IDENTITY,j):c.fromAxisAngle(x,y,j),c.multiply(j,m,u)},c.clone=function(t,e){if(r(t))return r(e)?(e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e):new c(t.x,t.y,t.z,t.w)},c.conjugate=function(t,n){return e.typeOf.object("quaternion",t),e.typeOf.object("result",n),n.x=-t.x,n.y=-t.y,n.z=-t.z,n.w=t.w,n},c.magnitudeSquared=function(t){return e.typeOf.object("quaternion",t),t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w},c.magnitude=function(t){return Math.sqrt(c.magnitudeSquared(t))},c.normalize=function(t,n){e.typeOf.object("result",n);var r=1/c.magnitude(t),a=t.x*r,o=t.y*r,u=t.z*r,y=t.w*r;return n.x=a,n.y=o,n.z=u,n.w=y,n},c.inverse=function(t,n){e.typeOf.object("result",n);var r=c.magnitudeSquared(t);return n=c.conjugate(t,n),c.multiplyByScalar(n,1/r,n)},c.add=function(t,n,r){return e.typeOf.object("left",t),e.typeOf.object("right",n),e.typeOf.object("result",r),r.x=t.x+n.x,r.y=t.y+n.y,r.z=t.z+n.z,r.w=t.w+n.w,r},c.subtract=function(t,n,r){return e.typeOf.object("left",t),e.typeOf.object("right",n),e.typeOf.object("result",r),r.x=t.x-n.x,r.y=t.y-n.y,r.z=t.z-n.z,r.w=t.w-n.w,r},c.negate=function(t,n){return e.typeOf.object("quaternion",t),e.typeOf.object("result",n),n.x=-t.x,n.y=-t.y,n.z=-t.z,n.w=-t.w,n},c.dot=function(t,n){return e.typeOf.object("left",t),e.typeOf.object("right",n),t.x*n.x+t.y*n.y+t.z*n.z+t.w*n.w},c.multiply=function(t,n,r){e.typeOf.object("left",t),e.typeOf.object("right",n),e.typeOf.object("result",r);var a=t.x,o=t.y,u=t.z,y=t.w,c=n.x,l=n.y,p=n.z,i=n.w,f=y*c+a*i+o*p-u*l,s=y*l-a*p+o*i+u*c,O=y*p+a*l-o*c+u*i,b=y*i-a*c-o*l-u*p;return r.x=f,r.y=s,r.z=O,r.w=b,r},c.multiplyByScalar=function(t,n,r){return e.typeOf.object("quaternion",t),e.typeOf.number("scalar",n),e.typeOf.object("result",r),r.x=t.x*n,r.y=t.y*n,r.z=t.z*n,r.w=t.w*n,r},c.divideByScalar=function(t,n,r){return e.typeOf.object("quaternion",t),e.typeOf.number("scalar",n),e.typeOf.object("result",r),r.x=t.x/n,r.y=t.y/n,r.z=t.z/n,r.w=t.w/n,r},c.computeAxis=function(t,n){e.typeOf.object("quaternion",t),e.typeOf.object("result",n);var r=t.w;if(Math.abs(r-1)<u.EPSILON6)return n.x=n.y=n.z=0,n;var a=1/Math.sqrt(1-r*r);return n.x=t.x*a,n.y=t.y*a,n.z=t.z*a,n},c.computeAngle=function(t){return e.typeOf.object("quaternion",t),Math.abs(t.w-1)<u.EPSILON6?0:2*Math.acos(t.w)};var g=new c;c.lerp=function(t,n,r,a){return e.typeOf.object("start",t),e.typeOf.object("end",n),e.typeOf.number("t",r),e.typeOf.object("result",a),g=c.multiplyByScalar(n,r,g),a=c.multiplyByScalar(t,1-r,a),c.add(g,a,a)};var z=new c,h=new c,v=new c;c.slerp=function(t,n,r,a){e.typeOf.object("start",t),e.typeOf.object("end",n),e.typeOf.number("t",r),e.typeOf.object("result",a);var o=c.dot(t,n),y=n;if(o<0&&(o=-o,y=z=c.negate(n,z)),1-o<u.EPSILON6)return c.lerp(t,y,r,a);var l=Math.acos(o);return h=c.multiplyByScalar(t,Math.sin((1-r)*l),h),v=c.multiplyByScalar(y,Math.sin(r*l),v),a=c.add(h,v,a),c.multiplyByScalar(a,1/Math.sin(l),a)},c.log=function(n,r){e.typeOf.object("quaternion",n),e.typeOf.object("result",r);var a=u.acosClamped(n.w),o=0;return 0!==a&&(o=a/Math.sin(a)),t.multiplyByScalar(n,o,r)},c.exp=function(n,r){e.typeOf.object("cartesian",n),e.typeOf.object("result",r);var a=t.magnitude(n),o=0;return 0!==a&&(o=Math.sin(a)/a),r.x=n.x*o,r.y=n.y*o,r.z=n.z*o,r.w=Math.cos(a),r};var M=new t,q=new t,A=new c,S=new c;c.computeInnerQuadrangle=function(n,r,a,o){e.typeOf.object("q0",n),e.typeOf.object("q1",r),e.typeOf.object("q2",a),e.typeOf.object("result",o);var u=c.conjugate(r,A);c.multiply(u,a,S);var y=c.log(S,M);c.multiply(u,n,S);var l=c.log(S,q);return t.add(y,l,y),t.multiplyByScalar(y,.25,y),t.negate(y,y),c.exp(y,A),c.multiply(r,A,o)},c.squad=function(t,n,r,a,o,u){e.typeOf.object("q0",t),e.typeOf.object("q1",n),e.typeOf.object("s0",r),e.typeOf.object("s1",a),e.typeOf.number("t",o),e.typeOf.object("result",u);var y=c.slerp(t,n,o,A),l=c.slerp(r,a,o,S);return c.slerp(y,l,2*o*(1-o),u)};for(var I=new c,E=1.9011074535173003,N=a.supportsTypedArrays()?new Float32Array(8):[],L=a.supportsTypedArrays()?new Float32Array(8):[],R=a.supportsTypedArrays()?new Float32Array(8):[],B=a.supportsTypedArrays()?new Float32Array(8):[],C=0;C<7;++C){var U=C+1,T=2*U+1;N[C]=1/(U*T),L[C]=U/T}return N[7]=E/136,L[7]=8*E/17,c.fastSlerp=function(t,n,r,a){e.typeOf.object("start",t),e.typeOf.object("end",n),e.typeOf.number("t",r),e.typeOf.object("result",a);var o,u=c.dot(t,n);u>=0?o=1:(o=-1,u=-u);for(var y=u-1,l=1-r,p=r*r,i=l*l,f=7;f>=0;--f)R[f]=(N[f]*p-L[f])*y,B[f]=(N[f]*i-L[f])*y;var s=o*r*(1+R[0]*(1+R[1]*(1+R[2]*(1+R[3]*(1+R[4]*(1+R[5]*(1+R[6]*(1+R[7])))))))),O=l*(1+B[0]*(1+B[1]*(1+B[2]*(1+B[3]*(1+B[4]*(1+B[5]*(1+B[6]*(1+B[7])))))))),b=c.multiplyByScalar(t,O,I);return c.multiplyByScalar(n,s,a),c.add(b,a,a)},c.fastSquad=function(t,n,r,a,o,u){e.typeOf.object("q0",t),e.typeOf.object("q1",n),e.typeOf.object("s0",r),e.typeOf.object("s1",a),e.typeOf.number("t",o),e.typeOf.object("result",u);var y=c.fastSlerp(t,n,o,A),l=c.fastSlerp(r,a,o,S);return c.fastSlerp(y,l,2*o*(1-o),u)},c.equals=function(t,e){return t===e||r(t)&&r(e)&&t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},c.equalsEpsilon=function(t,n,a){return e.typeOf.number("epsilon",a),t===n||r(t)&&r(n)&&Math.abs(t.x-n.x)<=a&&Math.abs(t.y-n.y)<=a&&Math.abs(t.z-n.z)<=a&&Math.abs(t.w-n.w)<=a},c.ZERO=o(new c(0,0,0,0)),c.IDENTITY=o(new c(0,0,0,1)),c.prototype.clone=function(t){return c.clone(this,t)},c.prototype.equals=function(t){return c.equals(this,t)},c.prototype.equalsEpsilon=function(t,e){return c.equalsEpsilon(this,t,e)},c.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},c});