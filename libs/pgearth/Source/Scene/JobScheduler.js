define(["../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/getTimestamp","./JobType"],function(e,t,r,s,a){"use strict";function i(e){this._total=e,this.usedThisFrame=0,this.stolenFromMeThisFrame=0,this.starvedThisFrame=!1,this.starvedLastFrame=!1}function o(t){if(e(t)&&t.length!==a.NUMBER_OF_JOB_TYPES)throw new r("A budget must be specified for each job type; budgets.length should equal JobType.NUMBER_OF_JOB_TYPES.");var s=new Array(a.NUMBER_OF_JOB_TYPES);s[a.TEXTURE]=new i(e(t)?t[a.TEXTURE]:10),s[a.PROGRAM]=new i(e(t)?t[a.PROGRAM]:10),s[a.BUFFER]=new i(e(t)?t[a.BUFFER]:30);var o,h=s.length,m=0;for(o=0;o<h;++o)m+=s[o].total;var n=new Array(h);for(o=0;o<h;++o)n[o]=!1;this._totalBudget=m,this._totalUsedThisFrame=0,this._budgets=s,this._executedThisFrame=n}return t(i.prototype,{total:{get:function(){return this._total}}}),o.getTimestamp=s,t(o.prototype,{totalBudget:{get:function(){return this._totalBudget}}}),o.prototype.disableThisFrame=function(){this._totalUsedThisFrame=this._totalBudget},o.prototype.resetBudgets=function(){for(var e=this._budgets,t=e.length,r=0;r<t;++r){var s=e[r];s.starvedLastFrame=s.starvedThisFrame,s.starvedThisFrame=!1,s.usedThisFrame=0,s.stolenFromMeThisFrame=0}this._totalUsedThisFrame=0},o.prototype.execute=function(e,t){var r,s=this._budgets,a=s[t],i=this._executedThisFrame[t];if(this._totalUsedThisFrame>=this._totalBudget&&i)return a.starvedThisFrame=!0,!1;if(a.usedThisFrame+a.stolenFromMeThisFrame>=a.total){var h,m=s.length;for(h=0;h<m&&(!((r=s[h]).usedThisFrame+r.stolenFromMeThisFrame<r.total)||r.starvedLastFrame);++h);if(h===m&&i)return!1;i&&(a.starvedThisFrame=!0)}var n=o.getTimestamp();e.execute();var d=o.getTimestamp()-n;return this._totalUsedThisFrame+=d,r?r.stolenFromMeThisFrame+=d:a.usedThisFrame+=d,this._executedThisFrame[t]=!0,!0},o});