define(["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/Event","../Core/getTimestamp","../Core/TimeConstants"],function(e,i,t,n,r,m,a,o){"use strict";function s(t){if(!i(t)||!i(t.scene))throw new r("options.scene is required.");this._scene=t.scene,this.samplingWindow=e(t.samplingWindow,s.defaultSettings.samplingWindow),this.quietPeriod=e(t.quietPeriod,s.defaultSettings.quietPeriod),this.warmupPeriod=e(t.warmupPeriod,s.defaultSettings.warmupPeriod),this.minimumFrameRateDuringWarmup=e(t.minimumFrameRateDuringWarmup,s.defaultSettings.minimumFrameRateDuringWarmup),this.minimumFrameRateAfterWarmup=e(t.minimumFrameRateAfterWarmup,s.defaultSettings.minimumFrameRateAfterWarmup),this._lowFrameRate=new m,this._nominalFrameRate=new m,this._frameTimes=[],this._needsQuietPeriod=!0,this._quietPeriodEndTime=0,this._warmupPeriodEndTime=0,this._frameRateIsLow=!1,this._lastFramesPerSecond=void 0,this._pauseCount=0;var n=this;this._preUpdateRemoveListener=this._scene.preUpdate.addEventListener(function(e,i){!function(e,i){if(e._pauseCount>0)return;var t=a();if(e._needsQuietPeriod)e._needsQuietPeriod=!1,e._frameTimes.length=0,e._quietPeriodEndTime=t+e.quietPeriod/o.SECONDS_PER_MILLISECOND,e._warmupPeriodEndTime=e._quietPeriodEndTime+(e.warmupPeriod+e.samplingWindow)/o.SECONDS_PER_MILLISECOND;else if(t>=e._quietPeriodEndTime){e._frameTimes.push(t);var n=t-e.samplingWindow/o.SECONDS_PER_MILLISECOND;if(e._frameTimes.length>=2&&e._frameTimes[0]<=n){for(;e._frameTimes.length>=2&&e._frameTimes[1]<n;)e._frameTimes.shift();var r=(t-e._frameTimes[0])/(e._frameTimes.length-1);e._lastFramesPerSecond=1e3/r;var m=1e3/(t>e._warmupPeriodEndTime?e.minimumFrameRateAfterWarmup:e.minimumFrameRateDuringWarmup);r>m?e._frameRateIsLow||(e._frameRateIsLow=!0,e._needsQuietPeriod=!0,e.lowFrameRate.raiseEvent(e.scene,e._lastFramesPerSecond)):e._frameRateIsLow&&(e._frameRateIsLow=!1,e._needsQuietPeriod=!0,e.nominalFrameRate.raiseEvent(e.scene,e._lastFramesPerSecond))}}}(n)}),this._hiddenPropertyName=void 0!==document.hidden?"hidden":void 0!==document.mozHidden?"mozHidden":void 0!==document.msHidden?"msHidden":void 0!==document.webkitHidden?"webkitHidden":void 0;var d=void 0!==document.hidden?"visibilitychange":void 0!==document.mozHidden?"mozvisibilitychange":void 0!==document.msHidden?"msvisibilitychange":void 0!==document.webkitHidden?"webkitvisibilitychange":void 0;function u(){var e;e=n,document[e._hiddenPropertyName]?e.pause():e.unpause()}this._visibilityChangeRemoveListener=void 0,i(d)&&(document.addEventListener(d,u,!1),this._visibilityChangeRemoveListener=function(){document.removeEventListener(d,u,!1)})}return s.defaultSettings={samplingWindow:5,quietPeriod:2,warmupPeriod:5,minimumFrameRateDuringWarmup:4,minimumFrameRateAfterWarmup:8},s.fromScene=function(e){if(!i(e))throw new r("scene is required.");return i(e._frameRateMonitor)&&!e._frameRateMonitor.isDestroyed()||(e._frameRateMonitor=new s({scene:e})),e._frameRateMonitor},t(s.prototype,{scene:{get:function(){return this._scene}},lowFrameRate:{get:function(){return this._lowFrameRate}},nominalFrameRate:{get:function(){return this._nominalFrameRate}},lastFramesPerSecond:{get:function(){return this._lastFramesPerSecond}}}),s.prototype.pause=function(){++this._pauseCount,1===this._pauseCount&&(this._frameTimes.length=0,this._lastFramesPerSecond=void 0)},s.prototype.unpause=function(){--this._pauseCount,this._pauseCount<=0&&(this._pauseCount=0,this._needsQuietPeriod=!0)},s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){return this._preUpdateRemoveListener(),i(this._visibilityChangeRemoveListener)&&this._visibilityChangeRemoveListener(),n(this)},s});