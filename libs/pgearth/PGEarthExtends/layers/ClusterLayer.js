define(["../../Source/Core/defined","../../Source/Core/DeveloperError","../../Source/Core/defineProperties","../../Source/Core/Color","../../Source/Core/Cartesian2","../../Source/Core/defaultValue","../../Source/Core/createGuid","../../Source/Core/destroyObject","../../Source/Scene/VerticalOrigin","../../Source/DataSources/CustomDataSource"],function(e,t,i,l,o,s,r,n,a,h){const c={size:18,pixelRange:40,gradient:{1e-4:l.DEEPSKYBLUE,.001:l.GREEN,.01:l.ORANGE,.1:l.RED},fontSize:12,fontColor:l.BLACK,style:"circle"};function d(e){this._options={...c,...e},this.id=s(e.id,r()),this._delegate=new h(e.id),this._delegate.clustering.enabled=!0,this._delegate.clustering.clusterEvent.addEventListener(this._clusterEventHandler,this),this._delegate.clustering.pixelRange=this._options.pixelRange,this.type="cluster",this._state="initialized",this._cache={}}return d.prototype.enableCluster=function(e){return this._delegate.clustering.enabled=e,this},d.prototype.add=function(e){this._delegate.entities.add(e)},d.prototype._drawCircle=function(e,t){let i=this._options.size*(t+1),l=e.toCssColorString()+"-"+i;if(!this._cache[l]){let t=document.createElement("canvas");t.width=i,t.height=i;let o=t.getContext("2d");o.save(),o.scale(i/24,i/24),o.fillStyle=e.withAlpha(.2).toCssColorString(),o.beginPath(),o.arc(12,12,9,0,2*Math.PI),o.closePath(),o.fill(),o.beginPath(),o.arc(12,12,6,0,2*Math.PI),o.fillStyle=e.toCssColorString(),o.fill(),o.closePath(),o.restore(),this._cache[l]=t.toDataURL()}return this._cache[l]},d.prototype._drawClustering=function(e,t){let i=this._options.size*(t+1),l=e.toCssColorString()+"-"+i,o=-Math.PI/12,s=Math.PI/2,r=Math.PI/6;if(!this._cache[l]){let t=document.createElement("canvas");t.width=i,t.height=i;let n=t.getContext("2d");n.save(),n.scale(i/24,i/24),n.beginPath(),n.arc(12,12,6,0,2*Math.PI),n.fillStyle=e.toCssColorString(),n.fill(),n.closePath(),n.lineWidth=2;for(let t=0;t<3;t++)n.beginPath(),n.arc(12,12,8,o,o+s,!1),n.strokeStyle=e.withAlpha(.4).toCssColorString(),n.stroke(),n.arc(12,12,11,o,o+s,!1),n.strokeStyle=e.withAlpha(.2).toCssColorString(),n.stroke(),n.closePath(),o=o+s+r;n.restore(),this._cache[l]=t.toDataURL()}return this._cache[l]},d.prototype._clusterEventHandler=function(e,t){if(this._delegate.clustering.enabled&&(t.billboard.show=!0,t.label.font=`bold ${this._options.fontSize}px sans-serif`,t.label.fillColor=this._options.fontColor,t.label.disableDepthTestDistance=Number.POSITIVE_INFINITY,this._delegate.entities.values.length)){let i=this._delegate.entities.values.length||0;for(let l in this._options.gradient)if(e.length>=i*l){let i=String(e.length).length;"circle"===this._options.style?t.billboard.image=this._drawCircle(this._options.gradient[l],i):t.billboard.image=this._drawClustering(this._options.gradient[l],i),t.label.show=!0,t.label.pixelOffset=new o(1===i?-3.5:2===i?-7:-5*(i-1),5)}else e.length<=1&&(t.label.show=!1)}},d.prototype.clear=function(){return this._delegate.entities.removeAll(),this._cache={},this._state="",this},d.prototype.destroy=function(){return this._delegate&&this._delegate.entities&&this._delegate.entities.removeAll(),this._cache={},this._state="",n(this)},d});