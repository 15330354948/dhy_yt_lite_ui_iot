define(["../Core/defined","../Core/Event"],function(t,i){"use strict";function e(t,e){this.id=e,this.name=t,this.playlistIndex=0,this.playlist=[],this.tourStart=new i,this.tourEnd=new i,this.entryStart=new i,this.entryEnd=new i,this._activeEntries=[]}function n(t){for(var i=t.pop();void 0!==i;i=t.pop())i.stop()}function s(i,e,n){var r=this.playlist[this.playlistIndex];if(r){var a=function(t,i,e,n){var r=this.playlist[this.playlistIndex];if(this.entryEnd.raiseEvent(r,n),n)e(n);else{var a=this._activeEntries.indexOf(r);a>=0&&this._activeEntries.splice(a,1),this.playlistIndex++,s.call(this,t,i,e)}}.bind(this,i,e,n);if(this._activeEntries.push(r),this.entryStart.raiseEvent(r),r.blocking)r.play(a,i.scene.camera,e);else{var l=this;r.play(function(){l.entryEnd.raiseEvent(r);var t=l._activeEntries.indexOf(r);t>=0&&l._activeEntries.splice(t,1)}),a(i,e,n)}}else t(n)&&n(!1)}return e.prototype.addPlaylistEntry=function(t){this.playlist.push(t)},e.prototype.play=function(t,i){this.tourStart.raiseEvent();var e=this;s.call(this,t,i,function(t){e.playlistIndex=0,t||n(e._activeEntries),e.tourEnd.raiseEvent(t)})},e.prototype.stop=function(){n(this._activeEntries)},e});