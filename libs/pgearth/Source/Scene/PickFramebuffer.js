define(["../Core/BoundingRectangle","../Core/Color","../Core/defaultValue","../Core/defined","../Core/destroyObject","../Renderer/Framebuffer","../Renderer/PassState","../Renderer/Renderbuffer","../Renderer/RenderbufferFormat","../Renderer/Texture"],function(t,e,r,i,h,o,s,n,a,f){"use strict";function d(e){var r=new s(e);r.blendingEnabled=!1,r.scissorTest={enabled:!0,rectangle:new t},r.viewport=new t,this._context=e,this._fb=void 0,this._passState=r,this._width=0,this._height=0}d.prototype.begin=function(e,r){var h=this._context,s=r.width,d=r.height;return t.clone(e,this._passState.scissorTest.rectangle),i(this._fb)&&this._width===s&&this._height===d||(this._width=s,this._height=d,this._fb=this._fb&&this._fb.destroy(),this._fb=new o({context:h,colorTextures:[new f({context:h,width:s,height:d})],depthStencilRenderbuffer:new n({context:h,width:s,height:d,format:a.DEPTH_STENCIL})}),this._passState.framebuffer=this._fb),this._passState.viewport.width=s,this._passState.viewport.height=d,this._passState};var b=new e;return d.prototype.end=function(t){for(var h=r(t.width,1),o=r(t.height,1),s=this._context,n=s.readPixels({x:t.x,y:t.y,width:h,height:o,framebuffer:this._fb}),a=Math.max(h,o),f=a*a,d=Math.floor(.5*h),_=Math.floor(.5*o),c=0,u=0,l=0,p=-1,w=0;w<f;++w){if(-d<=c&&c<=d&&-_<=u&&u<=_){var g=4*((_-u)*h+c+d);b.red=e.byteToFloat(n[g]),b.green=e.byteToFloat(n[g+1]),b.blue=e.byteToFloat(n[g+2]),b.alpha=e.byteToFloat(n[g+3]);var y=s.getObjectByPickColor(b);if(i(y))return y}if(c===u||c<0&&-c===u||c>0&&c===1-u){var x=l;l=-p,p=x}c+=l,u+=p}},d.prototype.isDestroyed=function(){return!1},d.prototype.destroy=function(){return this._fb=this._fb&&this._fb.destroy(),h(this)},d});