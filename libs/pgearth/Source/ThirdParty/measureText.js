define(function(){var e=function(e,t){return document.defaultView.getComputedStyle(e,null).getPropertyValue(t)};return function(t,n,a,i){var l=t.measureText(n),o=e(t.canvas,"font-family"),r=e(t.canvas,"font-size").replace("px",""),s=e(t.canvas,"font-style"),d=e(t.canvas,"font-weight"),c=!/\S/.test(n);l.fontsize=r;var f=document.createElement("div");f.style.position="absolute",f.style.opacity=0,f.style.font=s+" "+d+" "+r+"px "+o,f.innerHTML=n+"<br/>"+n,document.body.appendChild(f),l.leading=1.2*r;var y=e(f,"height");if((y=y.replace("px",""))>=2*r&&(l.leading=y/2|0),document.body.removeChild(f),c)l.ascent=0,l.descent=0,l.bounds={minx:0,maxx:l.width,miny:0,maxy:0},l.height=0;else{var h=document.createElement("canvas");h.width=l.width+100,h.height=3*r,h.style.opacity=1,h.style.fontFamily=o,h.style.fontSize=r,h.style.fontStyle=s,h.style.fontWeight=d;var m=h.getContext("2d");m.font=s+" "+d+" "+r+"px "+o;var u=h.width,v=h.height,x=v/2;m.fillStyle="white",m.fillRect(-1,-1,u+2,v+2),a&&(m.strokeStyle="black",m.lineWidth=t.lineWidth,m.strokeText(n,50,x)),i&&(m.fillStyle="black",m.fillText(n,50,x));for(var g=m.getImageData(0,0,u,v).data,p=0,b=4*u,w=g.length;++p<w&&255===g[p];);var S=p/b|0;for(p=w-1;--p>0&&255===g[p];);var k=p/b|0;for(p=0;p<w&&255===g[p];)(p+=b)>=w&&(p=p-w+4);var C=p%b/4|0,T=1;for(p=w-3;p>=0&&255===g[p];)(p-=b)<0&&(p=w-3-4*T++);var z=p%b/4+1|0;l.ascent=x-S,l.descent=k-x,l.bounds={minx:C-50,maxx:z-50,miny:0,maxy:k-S},l.height=k-S+1}return l}});