define(["../Core/decodeGoogleEarthEnterpriseData","../Core/GoogleEarthEnterpriseTileInformation","../Core/RuntimeError","../ThirdParty/pako_inflate","./createTaskProcessorWorker"],function(r,e,t,n,a){"use strict";var i=Uint16Array.BYTES_PER_ELEMENT,o=Int32Array.BYTES_PER_ELEMENT,f=Uint32Array.BYTES_PER_ELEMENT,v={METADATA:0,TERRAIN:1,DBROOT:2};v.fromString=function(r){return"Metadata"===r?v.METADATA:"Terrain"===r?v.TERRAIN:"DbRoot"===r?v.DBROOT:void 0};var u=32301;var s=1953029805,c=2917034100;return a(function(a,g){var E=v.fromString(a.type),l=a.buffer;r(a.key,l);var w=function(r){var e=new DataView(r),a=0,i=e.getUint32(a,!0);if(a+=f,i!==s&&i!==c)throw new t("Invalid magic");var o=e.getUint32(a,i===s);a+=f;var v=new Uint8Array(r,a),u=n.inflate(v);if(u.length!==o)throw new t("Size of packet doesn't match header");return u}(l);l=w.buffer;var T=w.length;switch(E){case v.METADATA:return function(r,n,a){var v=new DataView(r),s=0,c=v.getUint32(s,!0);if(s+=f,c!==u)throw new t("Invalid magic");var g=v.getUint32(s,!0);if(s+=f,1!==g)throw new t("Invalid data type. Must be 1 for QuadTreePacket");var E=v.getUint32(s,!0);if(s+=f,2!==E)throw new t("Invalid QuadTreePacket version. Only version 2 is supported.");var l=v.getInt32(s,!0);s+=o;var w=v.getInt32(s,!0);if(s+=o,32!==w)throw new t("Invalid instance size.");var T=v.getInt32(s,!0);s+=o;var d=v.getInt32(s,!0);s+=o;var h=v.getInt32(s,!0);if(T!==l*w+(s+=o))throw new t("Invalid dataBufferOffset");if(T+d+h!==n)throw new t("Invalid packet offsets");for(var I=[],A=0;A<l;++A){var U=v.getUint8(s);++s,++s;var R=v.getUint16(s,!0);s+=i;var p=v.getUint16(s,!0);s+=i;var D=v.getUint16(s,!0);s+=i,s+=i,s+=i,s+=o,s+=o,s+=8;var y=v.getUint8(s++),k=v.getUint8(s++);s+=i,I.push(new e(U,R,p,D,y,k))}var m=[],M=0,O=0,S=I[M++];return""===a?++O:m[a]=S,function r(e,t,n){var a=!1;if(4===n){if(t.hasSubtree())return;a=!0}for(var i=0;i<4;++i){var o=e+i.toString();if(a)m[o]=null;else if(n<4)if(t.hasChild(i)){if(M===l)return void console.log("Incorrect number of instances");var f=I[M++];m[o]=f,r(o,f,n+1)}else m[o]=null}}(a,S,O),m}(l,T,a.quadKey);case v.TERRAIN:return function(r,e,t){for(var n=new DataView(r),a=0,i=[];a<e;){for(var o=a,v=0;v<4;++v){var u=n.getUint32(a,!0);a+=f,a+=u}var s=r.slice(o,a);t.push(s),i.push(s)}return i}(l,T,g);case v.DBROOT:return g.push(l),{buffer:l}}})});