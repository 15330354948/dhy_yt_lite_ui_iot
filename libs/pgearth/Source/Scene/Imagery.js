define(["../Core/defined","../Core/destroyObject","./ImageryState"],function(e,t,r){"use strict";function i(t,i,s,a,h){if(this.imageryLayer=t,this.x=i,this.y=s,this.level=a,this.request=void 0,0!==a){var o=i/2|0,n=s/2|0,c=a-1;this.parent=t.getImageryFromCache(o,n,c)}(this.state=r.UNLOADED,this.imageUrl=void 0,this.image=void 0,this.texture=void 0,this.textureWebMercator=void 0,this.credits=void 0,this.referenceCount=0,!e(h)&&t.imageryProvider.ready)&&(h=t.imageryProvider.tilingScheme.tileXYToRectangle(i,s,a));this.rectangle=h}return i.createPlaceholder=function(e){var t=new i(e,0,0,0);return t.addReference(),t.state=r.PLACEHOLDER,t},i.prototype.addReference=function(){++this.referenceCount},i.prototype.releaseReference=function(){return--this.referenceCount,0===this.referenceCount?(this.imageryLayer.removeImageryFromCache(this),e(this.parent)&&this.parent.releaseReference(),e(this.image)&&e(this.image.destroy)&&this.image.destroy(),e(this.texture)&&this.texture.destroy(),e(this.textureWebMercator)&&this.texture!==this.textureWebMercator&&this.textureWebMercator.destroy(),t(this),0):this.referenceCount},i.prototype.processStateMachine=function(e,t,i){this.state!==r.UNLOADED||i||(this.state=r.TRANSITIONING,this.imageryLayer._requestImagery(this)),this.state===r.RECEIVED&&(this.state=r.TRANSITIONING,this.imageryLayer._createTexture(e.context,this));var s=this.state===r.READY&&t&&!this.texture;(this.state===r.TEXTURE_LOADED||s)&&(this.state=r.TRANSITIONING,this.imageryLayer._reprojectTexture(e,this,t))},i});