define(["./arrayFill","./arrayRemoveDuplicates","./BoundingSphere","./Cartesian3","./Check","./ComponentDatatype","./CornerType","./CorridorGeometryLibrary","./defaultValue","./defined","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryOffsetAttribute","./IndexDatatype","./Math","./PolygonPipeline","./PrimitiveType"],function(t,e,i,r,o,n,s,a,u,h,l,p,d,f,c,g,y,v,b){"use strict";var A=new r,_=new r,m=new r;function w(t,e){var i,o,u,l=[],p=t.positions,c=t.corners,y=t.endPositions,v=new f,b=0,w=0,E=0;for(o=0;o<p.length;o+=2)b+=u=p[o].length-3,E+=u/3*4,w+=p[o+1].length-3;for(b+=3,w+=3,o=0;o<c.length;o++){i=c[o];var T=c[o].leftPositions;h(T)?(b+=u=T.length,E+=u/3*2):(w+=u=c[o].rightPositions.length,E+=u/3*2)}var P,O=h(y);O&&(b+=P=y[0].length-3,w+=P,E+=4*(P/=3));var k,D,G,N,H,L,x=b+w,S=new Float64Array(x),I=0,B=x-1,C=P/2,U=g.createTypedArray(x/3,E+4),M=0;if(U[M++]=I/3,U[M++]=(B-2)/3,O){l.push(I/3),L=A,H=_;var R=y[0];for(o=0;o<C;o++)L=r.fromArray(R,3*(C-1-o),L),H=r.fromArray(R,3*(C+o),H),a.addAttribute(S,H,I),a.addAttribute(S,L,void 0,B),N=(D=I/3)+1,G=(k=(B-2)/3)-1,U[M++]=k,U[M++]=G,U[M++]=D,U[M++]=N,I+=3,B-=3}var j=0,F=p[j++],V=p[j++];for(S.set(F,I),S.set(V,B-V.length+1),u=V.length-3,l.push(I/3,(B-2)/3),o=0;o<u;o+=3)N=(D=I/3)+1,G=(k=(B-2)/3)-1,U[M++]=k,U[M++]=G,U[M++]=D,U[M++]=N,I+=3,B-=3;for(o=0;o<c.length;o++){var Y,q,J=(i=c[o]).leftPositions,W=i.rightPositions,z=m;if(h(J)){for(B-=3,q=G,l.push(N),Y=0;Y<J.length/3;Y++)z=r.fromArray(J,3*Y,z),U[M++]=q-Y-1,U[M++]=q-Y,a.addAttribute(S,z,void 0,B),B-=3;l.push(q-Math.floor(J.length/6)),e===s.BEVELED&&l.push((B-2)/3+1),I+=3}else{for(I+=3,q=N,l.push(G),Y=0;Y<W.length/3;Y++)z=r.fromArray(W,3*Y,z),U[M++]=q+Y,U[M++]=q+Y+1,a.addAttribute(S,z,I),I+=3;l.push(q+Math.floor(W.length/6)),e===s.BEVELED&&l.push(I/3-1),B-=3}for(F=p[j++],V=p[j++],F.splice(0,3),V.splice(V.length-3,3),S.set(F,I),S.set(V,B-V.length+1),u=V.length-3,Y=0;Y<V.length;Y+=3)D=(N=I/3)-1,k=(G=(B-2)/3)+1,U[M++]=k,U[M++]=G,U[M++]=D,U[M++]=N,I+=3,B-=3;I-=3,B+=3,l.push(I/3,(B-2)/3)}if(O){I+=3,B-=3,L=A,H=_;var K=y[1];for(o=0;o<C;o++)L=r.fromArray(K,3*(P-o-1),L),H=r.fromArray(K,3*o,H),a.addAttribute(S,L,void 0,B),a.addAttribute(S,H,I),D=(N=I/3)-1,k=(G=(B-2)/3)+1,U[M++]=k,U[M++]=G,U[M++]=D,U[M++]=N,I+=3,B-=3;l.push(I/3)}else l.push(I/3,(B-2)/3);return U[M++]=I/3,U[M++]=(B-2)/3,v.position=new d({componentDatatype:n.DOUBLE,componentsPerAttribute:3,values:S}),{attributes:v,indices:U,wallIndices:l}}function E(t){var e=(t=u(t,u.EMPTY_OBJECT)).positions,i=t.width;o.typeOf.object("options.positions",e),o.typeOf.number("options.width",i);var n=u(t.height,0),a=u(t.extrudedHeight,n);this._positions=e,this._ellipsoid=l.clone(u(t.ellipsoid,l.WGS84)),this._width=i,this._height=Math.max(n,a),this._extrudedHeight=Math.min(n,a),this._cornerType=u(t.cornerType,s.ROUNDED),this._granularity=u(t.granularity,y.RADIANS_PER_DEGREE),this._offsetAttribute=t.offsetAttribute,this._workerName="createCorridorOutlineGeometry",this.packedLength=1+e.length*r.packedLength+l.packedLength+6}E.pack=function(t,e,i){o.typeOf.object("value",t),o.typeOf.object("array",e),i=u(i,0);var n=t._positions,s=n.length;e[i++]=s;for(var a=0;a<s;++a,i+=r.packedLength)r.pack(n[a],e,i);return l.pack(t._ellipsoid,e,i),i+=l.packedLength,e[i++]=t._width,e[i++]=t._height,e[i++]=t._extrudedHeight,e[i++]=t._cornerType,e[i++]=t._granularity,e[i]=u(t._offsetAttribute,-1),e};var T=l.clone(l.UNIT_SPHERE),P={positions:void 0,ellipsoid:T,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,offsetAttribute:void 0};return E.unpack=function(t,e,i){o.typeOf.object("array",t),e=u(e,0);for(var n=t[e++],s=new Array(n),a=0;a<n;++a,e+=r.packedLength)s[a]=r.unpack(t,e);var p=l.unpack(t,e,T);e+=l.packedLength;var d=t[e++],f=t[e++],c=t[e++],g=t[e++],y=t[e++],v=t[e];return h(i)?(i._positions=s,i._ellipsoid=l.clone(p,i._ellipsoid),i._width=d,i._height=f,i._extrudedHeight=c,i._cornerType=g,i._granularity=y,i._offsetAttribute=-1===v?void 0:v,i):(P.positions=s,P.width=d,P.height=f,P.extrudedHeight=c,P.cornerType=g,P.granularity=y,P.offsetAttribute=-1===v?void 0:v,new E(P))},E.createGeometry=function(o){var s=o._positions,u=o._width,l=o._ellipsoid;s=function(t,e){for(var i=0;i<t.length;i++)t[i]=e.scaleToGeodeticSurface(t[i],t[i]);return t}(s,l);var f=e(s,r.equalsEpsilon);if(!(f.length<2||u<=0)){var A,_=o._height,m=o._extrudedHeight,E=!y.equalsEpsilon(_,m,0,y.EPSILON2),T={ellipsoid:l,positions:f,width:u,cornerType:o._cornerType,granularity:o._granularity,saveAttributes:!1};if(E)T.height=_,T.extrudedHeight=m,T.offsetAttribute=o._offsetAttribute,A=function(e){var i=e.ellipsoid,r=w(a.computePositions(e),e.cornerType),o=r.wallIndices,s=e.height,u=e.extrudedHeight,l=r.attributes,p=r.indices,f=l.position.values,y=f.length,b=new Float64Array(y);b.set(f);var A,_=new Float64Array(2*y);if(f=v.scaleToGeodeticHeight(f,s,i),b=v.scaleToGeodeticHeight(b,u,i),_.set(f),_.set(b,y),l.position.values=_,y/=3,h(e.offsetAttribute)){var m=new Uint8Array(2*y);if(e.offsetAttribute===c.TOP)m=t(m,1,0,y);else{var E=e.offsetAttribute===c.NONE?0:1;m=t(m,E)}l.applyOffset=new d({componentDatatype:n.UNSIGNED_BYTE,componentsPerAttribute:1,values:m})}var T=p.length,P=g.createTypedArray(_.length/3,2*(T+o.length));P.set(p);var O,k,D=T;for(A=0;A<T;A+=2){var G=p[A],N=p[A+1];P[D++]=G+y,P[D++]=N+y}for(A=0;A<o.length;A++)k=(O=o[A])+y,P[D++]=O,P[D++]=k;return{attributes:l,indices:P}}(T);else if((A=w(a.computePositions(T),T.cornerType)).attributes.position.values=v.scaleToGeodeticHeight(A.attributes.position.values,_,l),h(o._offsetAttribute)){var P=A.attributes.position.values.length,O=new Uint8Array(P/3),k=o._offsetAttribute===c.NONE?0:1;t(O,k),A.attributes.applyOffset=new d({componentDatatype:n.UNSIGNED_BYTE,componentsPerAttribute:1,values:O})}var D=A.attributes,G=i.fromVertices(D.position.values,void 0,3);return new p({attributes:D,indices:A.indices,primitiveType:b.LINES,boundingSphere:G,offsetAttribute:o._offsetAttribute})}},E});