define(["../../Source/Core/buildModuleUrl","../../Source/Core/Color","../../Source/Core/defined","../../Source/Core/DeveloperError","../../Source/Core/Resource","../../Source/Core/writeTextToCanvas"],function(b,c,h,e,a,n){function j(o){this._cache={}}j.prototype.fromUrl=function(o,p){if(!h(o)){throw new e("url is required")}if(!h(p)){throw new e("size is required")}return i(o,undefined,p,this._cache)};j.prototype.fromText=function(u,p,o,q,r,t,s){if(!h(u)){throw new e("text is required")}if(!h(p)){throw new e("size is required")}return i(undefined,u,p,this._cache,o,q,r,t,s)};var m=new c();function l(t,s){t.strokeStyle="#fff";var r=s/2,q=Math.round(s*5/6);t.beginPath();t.moveTo(r,q);t.arc(r,q,s*3/20,0,Math.PI*2,false);t.fillStyle="rgba(3, 252, 249,0.2)";t.fill();t.beginPath();t.arc(r,q,s/12,0,Math.PI*2,false);t.fillStyle="rgb(3, 252, 249)";t.lineWidth=Math.round(s/75);t.fill();t.stroke();t.beginPath();t.moveTo(Math.round(s*9/20),Math.round(s*7/12));t.lineTo(Math.round(s*11/20),Math.round(s*7/12));t.lineTo(Math.round(s/2),Math.round(s*19/30));t.closePath();t.fillStyle="#fff";t.fill();t.beginPath();var p=Math.round(s/2),o=Math.round(s/3);t.arc(p,o,Math.round(s*4/15),0,Math.PI*2,false);t.clip();t.lineWidth=Math.round(s/30);t.stroke()}function g(u,o,x){var q=Math.round(x*4/15),p,r;if(o.width>o.height){p=q*2;r=o.width/o.height*p}else{r=q*2;p=o.height/o.width*r}var v=Math.round(x/2),s=Math.round(x/3),w=Math.round(v-r/2),t=Math.round(s-p/2);u.drawImage(o,w,t,r,p)}function d(q,p,o){q.strokeStyle="red";q.lineWidth=Math.round(o/75);q.moveTo(Math.round(o/2),Math.round(o*0.9));q.lineTo(Math.round(o/2),Math.round(o*0.1));q.stroke();q.lineTo(Math.round(o),Math.round(o*0.4));q.lineTo(Math.round(o/2),Math.round(o*0.4));q.fillStyle="red";q.fill();q.fillStyle="#fff";q.font=o/10+"px serif";q.fillText(p,Math.round(o*0.54),Math.round(o*0.33))}function k(u,t,p,o,q,s,r){p=p/2<16?16:p/2;u.fillStyle=o||"red";u.arc(p,p,p,0,2*Math.PI,false);u.fill();u.fillStyle="#fff";u.font=p*(q||0.8)+"px Microsoft Yahei";u.textAlign="center";u.textBaseline="middle";u.fillText(t,p,p);u.beginPath();u.strokeStyle=r||"#ffffff";u.lineWidth=s||2;u.arc(p,p,p-(s/2),0,2*Math.PI);u.stroke()}var f=new Array(4);function i(p,x,C,o,u,w,v,s,A){f[0]=p;f[1]=x;f[2]=C;var q=JSON.stringify(f);var z=o[q];if(h(z)){return z}var r=document.createElement("canvas");r.width=C;r.height=C;var y=r.getContext("2d");if(h(p)){l(y,C);var t=new a.createIfNeeded(p);var B=t.fetchImage({preferBlob:true}).then(function(D){g(y,D,C);o[q]=r;return r});o[q]=B;return B}else{if(h(x)){if(w){k(y,x,C,u,v,s,A)}else{d(y,x,C)}}}o[q]=r;return r}return j});