define(["../Core/buildModuleUrl","../Core/Check","../Core/Credit","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/GeographicTilingScheme","../Core/Rectangle","../Core/Resource","../Core/RuntimeError","../Core/TileProviderError","../Core/WebMercatorTilingScheme","../ThirdParty/when","./ImageryProvider"],function(e,r,t,i,o,n,s,a,l,h,d,u,c,g,m,f){"use strict";function v(e){if(e=i(e,{}),!o(e.url))throw new s("options.url is required.");if(!o(e.channel))throw new s("options.channel is required.");var r=e.url,n=i(e.path,"/default_map"),f=d.createIfNeeded(r).getDerivedResource({url:"/"===n[0]?n.substring(1):n});f.appendForwardSlash(),this._resource=f,this._url=r,this._path=n,this._tileDiscardPolicy=e.tileDiscardPolicy,this._channel=e.channel,this._requestType="ImageryMaps",this._credit=new t('<a href="http://www.google.com/enterprise/mapsearth/products/earthenterprise.html"><img src="'+v.logoUrl+'" title="Google Imagery"/></a>'),this.defaultGamma=1.9,this._tilingScheme=void 0,this._version=void 0,this._tileWidth=256,this._tileHeight=256,this._maximumLevel=e.maximumLevel,this._errorEvent=new a,this._ready=!1,this._readyPromise=m.defer();var y,_=f.getDerivedResource({url:"query",queryParameters:{request:"Json",vars:"geeServerDefs",is2d:"t"}}),p=this;function w(r){var t,i,n;try{t=JSON.parse(r)}catch(e){t=JSON.parse(r.replace(/([\[\{,])[\n\r ]*([A-Za-z0-9]+)[\n\r ]*:/g,'$1"$2":'))}for(var s=0;s<t.layers.length;s++)if(t.layers[s].id===p._channel){i=t.layers[s];break}if(!o(i))throw n="Could not find layer with channel (id) of "+p._channel+".",y=c.handleError(y,p,p._errorEvent,n,void 0,void 0,void 0,C),new u(n);if(!o(i.version))throw n="Could not find a version in channel (id) "+p._channel+".",y=c.handleError(y,p,p._errorEvent,n,void 0,void 0,void 0,C),new u(n);if(p._version=i.version,o(t.projection)&&"flat"===t.projection)p._tilingScheme=new l({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,rectangle:new h(-Math.PI,-Math.PI,Math.PI,Math.PI),ellipsoid:e.ellipsoid});else{if(o(t.projection)&&"mercator"!==t.projection)throw n="Unsupported projection "+t.projection+".",y=c.handleError(y,p,p._errorEvent,n,void 0,void 0,void 0,C),new u(n);p._tilingScheme=new g({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,ellipsoid:e.ellipsoid})}p._ready=!0,p._readyPromise.resolve(!0),c.handleSuccess(y)}function b(e){var r="An error occurred while accessing "+_.url+".";y=c.handleError(y,p,p._errorEvent,r,void 0,void 0,void 0,C),p._readyPromise.reject(new u(r))}function C(){var e=_.fetchText();m(e,w,b)}C()}return n(v.prototype,{url:{get:function(){return this._url}},path:{get:function(){return this._path}},proxy:{get:function(){return this._resource.proxy}},channel:{get:function(){return this._channel}},tileWidth:{get:function(){if(!this._ready)throw new s("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new s("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new s("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new s("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new s("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},version:{get:function(){if(!this._ready)throw new s("version must not be called before the imagery provider is ready.");return this._version}},requestType:{get:function(){if(!this._ready)throw new s("requestType must not be called before the imagery provider is ready.");return this._requestType}},rectangle:{get:function(){if(!this._ready)throw new s("rectangle must not be called before the imagery provider is ready.");return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new s("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}}),v.prototype.getTileCredits=function(e,r,t){},v.prototype.requestImage=function(e,r,t,i){if(!this._ready)throw new s("requestImage must not be called before the imagery provider is ready.");var o=this._resource.getDerivedResource({url:"query",request:i,queryParameters:{request:this._requestType,channel:this._channel,version:this._version,x:e,y:r,z:t+1}});return f.loadImage(this,o)},v.prototype.pickFeatures=function(e,r,t,i,o){},v._logoUrl=void 0,n(v,{logoUrl:{get:function(){return o(v._logoUrl)||(v._logoUrl=e("Assets/Images/google_earth_credit.png")),v._logoUrl},set:function(e){r.defined("value",e),v._logoUrl=e}}}),v});