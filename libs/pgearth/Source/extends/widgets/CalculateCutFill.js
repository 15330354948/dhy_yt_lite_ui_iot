define(["../../Core/BoundingSphere","../../Core/Cartesian2","../../Core/Cartesian3","../../Core/Cartographic","../../Core/Color","../../Core/ComponentDatatype","../../Core/defineProperties","../../Core/Event","../../Core/Geometry","../../Core/GeometryAttribute","../../Core/GeometryInstance","../../Core/IntersectionTests","../../Core/Math","../../Core/Matrix4","../../Core/PrimitiveType","../../Core/Ray","../../Core/TaskProcessor","../../Scene/Appearance","../../Scene/BlendingState","../../Scene/HorizontalOrigin","../../Scene/Primitive","../../Scene/VerticalOrigin"],function(e,t,o,i,r,n,a,s,c,l,p,u,h,m,v,_,g,y,f,d,w,L){"use strict";function P(e){this._viewer=e,this._zFactor=0,this._geoPolygon=void 0,this._sampleGap=1,this._percentage=0,this._fillVolume=0,this._cutVolume=0,this._vertice=void 0,this._matLocal=new m,this._matLocalInvert=new m,this._completeEvent=new s,this.primitive=null,this.primitive1=null,this.taskProcessor=new g("computeCutFill",Number.POSITIVE_INFINITY)}return a(P.prototype,{vertice:{get:function(){return this._vertice},set:function(e){this._vertice=e}},matLocal:{get:function(){return this._matLocal},set:function(e){this._matLocal=e}},completeEvent:{get:function(){return this._completeEvent}},matLocalInvert:{get:function(){return this._matLocalInvert},set:function(e){this._matLocalInvert=e}},zFactor:{get:function(){return this._zFactor},set:function(e){this._zFactor=e}},polygon:{get:function(){return this._geoPolygon},set:function(e){this._geoPolygon=e}},sampleGap:{get:function(){return this._sampleGap},set:function(e){this._sampleGap=e}},fillVolume:{get:function(){return this._fillVolume}},cutVolume:{get:function(){return this._cutVolume}}}),P.prototype.apply=function(){var t=this;return this.taskProcessor.scheduleTask({geoPolygon:this._geoPolygon,sampleGap:this._sampleGap,matLocalInvert:this.matLocalInvert,vertice:this._vertice,matLocal:this.matLocal,zFactor:this._zFactor}).then(function(o){for(var i=o.hightFill,a=o.hightCut,s=o.pointsLine,u=o.pointsLine1,h=r.fromBytes(255,0,0,255),m=r.fromBytes(0,255,0,255),_="attribute vec3 position3DHigh;attribute vec3 position3DLow; attribute vec4 color;         attribute float batchId;      varying vec4 v_color;                                  void main()                                           {                                                        vec4 p = czm_computePosition();                       v_color =color;                                       p = czm_modelViewProjectionRelativeToEye * p;         gl_Position = p;                                      gl_PointSize=10.0;                                 } ",g="varying vec4 v_color;     void main()               {                            gl_FragColor = v_color;}",d=[],L=[],P=[],C=[],I=[],S=[],b=0;b<s.length;b++)d.push(s[b].x,s[b].y,s[b].z),P.push(h.red,h.green,h.blue,h.alpha),L.push(b);for(b=0;b<u.length;b++)C.push(u[b].x,u[b].y,u[b].z),S.push(m.red,m.green,m.blue,m.alpha),I.push(b);if(d.length>1){var A=new c({attributes:{position:new l({componentDatatype:n.DOUBLE,componentsPerAttribute:3,values:new Float64Array(d)}),color:new l({componentDatatype:n.FLOAT,componentsPerAttribute:4,values:new Float32Array(P)})},indices:new Int32Array(L),primitiveType:v.LINES,boundingSphere:e.fromVertices(d)}),E=new y({renderState:{blending:f.PRE_MULTIPLIED_ALPHA_BLEND,depthTest:{enabled:!0},depthMask:!0},fragmentShaderSource:g,vertexShaderSource:_});t.primitive=t._viewer.scene.primitives.add(new w({geometryInstances:new p({geometry:A}),appearance:E,asynchronous:!1}))}if(C.length>1){var F=new c({attributes:{position:new l({componentDatatype:n.DOUBLE,componentsPerAttribute:3,values:new Float64Array(C)}),color:new l({componentDatatype:n.FLOAT,componentsPerAttribute:4,values:new Float32Array(S)})},indices:new Int32Array(I),primitiveType:v.LINES,boundingSphere:e.fromVertices(C)}),T=new y({renderState:{blending:f.PRE_MULTIPLIED_ALPHA_BLEND,depthTest:{enabled:!0},depthMask:!0},fragmentShaderSource:g,vertexShaderSource:_});t.primitive1=t._viewer.scene.primitives.add(new w({geometryInstances:new p({geometry:F}),appearance:T,asynchronous:!1}))}var V=o.areaSample;for(b=0;b<i.length;b++)t._fillVolume+=V*i[b];for(b=0;b<a.length;b++)t._cutVolume+=V*a[b];t._completeEvent.raiseEvent()})},P.prototype.clear=function(){this._viewer.scene.primitives.remove(this.primitive),this._viewer.scene.primitives.remove(this.primitive1),this._fillVolume=0,this._cutVolume=0},P});