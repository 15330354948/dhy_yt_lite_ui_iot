define(["../Core/Check","../Core/Credit","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/IonResource","../Core/RuntimeError","../ThirdParty/when","./ArcGisMapServerImageryProvider","./BingMapsImageryProvider","./createTileMapServiceImageryProvider","./GoogleEarthEnterpriseMapsProvider","./MapboxImageryProvider","./SingleTileImageryProvider","./UrlTemplateImageryProvider","./WebMapServiceImageryProvider","./WebMapTileServiceImageryProvider"],function(e,r,i,t,o,n,a,d,s,h,u,l,m,y,c,g,v,f,p){"use strict";function _(e){return function(r){return new e(r)}}var P={ARCGIS_MAPSERVER:_(u),BING:_(l),GOOGLE_EARTH:_(y),MAPBOX:_(c),SINGLE_TILE:_(g),TMS:m,URL_TEMPLATE:_(v),WMS:_(f),WMTS:_(p)};function w(r){var o=(r=i(r,i.EMPTY_OBJECT)).assetId;e.typeOf.number("options.assetId",o),this.defaultAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0,this._ready=!1,this._tileCredits=void 0,this._errorEvent=new a;var n=this,u=d._createEndpointResource(o,r),l=r.assetId.toString()+r.accessToken+r.server,y=w._endpointCache[l];t(y)||(y=u.fetchJson(),w._endpointCache[l]=y),this._readyPromise=y.then(function(e){if("IMAGERY"!==e.type)return h.reject(new s("PGEarth ion asset "+o+" is not an imagery asset."));var r,i=e.externalType;if(t(i)){var a=P[i];if(!t(a))return h.reject(new s("Unrecognized PGEarth ion imagery type: "+i));r=a(e.options)}else r=m({url:new d(e,u)});return n._tileCredits=d.getCreditsFromEndpoint(e,u),r.errorEvent.addEventListener(function(e){e.provider=n,n._errorEvent.raiseEvent(e)}),n._imageryProvider=r,r.readyPromise.then(function(){return n._ready=!0,!0})})}return o(w.prototype,{ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},rectangle:{get:function(){if(!this._ready)throw new n("tileHeight must not be called before the imagery provider is ready.");return this._imageryProvider.rectangle}},tileWidth:{get:function(){if(!this._ready)throw new n("tileWidth must not be called before the imagery provider is ready.");return this._imageryProvider.tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new n("tileHeight must not be called before the imagery provider is ready.");return this._imageryProvider.tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new n("maximumLevel must not be called before the imagery provider is ready.");return this._imageryProvider.maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new n("minimumLevel must not be called before the imagery provider is ready.");return this._imageryProvider.minimumLevel}},tilingScheme:{get:function(){if(!this._ready)throw new n("tilingScheme must not be called before the imagery provider is ready.");return this._imageryProvider.tilingScheme}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new n("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._imageryProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){if(!this._ready)throw new n("credit must not be called before the imagery provider is ready.");return this._imageryProvider.credit}},hasAlphaChannel:{get:function(){if(!this._ready)throw new n("hasAlphaChannel must not be called before the imagery provider is ready.");return this._imageryProvider.hasAlphaChannel}}}),w.prototype.getTileCredits=function(e,r,i){if(!this._ready)throw new n("getTileCredits must not be called before the imagery provider is ready.");var o=this._imageryProvider.getTileCredits(e,r,i);return t(o)?this._tileCredits.concat(o):this._tileCredits},w.prototype.requestImage=function(e,r,i,t){if(!this._ready)throw new n("requestImage must not be called before the imagery provider is ready.");return this._imageryProvider.requestImage(e,r,i,t)},w.prototype.pickFeatures=function(e,r,i,t,o){if(!this._ready)throw new n("pickFeatures must not be called before the imagery provider is ready.");return this._imageryProvider.pickFeatures(e,r,i,t,o)},w._endpointCache={},w});