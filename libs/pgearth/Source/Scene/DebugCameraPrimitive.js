define(["../Core/Cartesian3","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defaultValue","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Core/FrustumGeometry","../Core/FrustumOutlineGeometry","../Core/GeometryInstance","../Core/Matrix3","../Core/OrthographicFrustum","../Core/OrthographicOffCenterFrustum","../Core/PerspectiveFrustum","../Core/PerspectiveOffCenterFrustum","../Core/Quaternion","./PerInstanceColorAppearance","./Primitive"],function(e,t,r,i,o,n,s,a,u,h,m,l,c,f,p,C,d,v){"use strict";function _(e){if(e=i(e,i.EMPTY_OBJECT),!o(e.camera))throw new s("options.camera is required.");this._camera=e.camera,this._color=i(e.color,t.CYAN),this._updateOnChange=i(e.updateOnChange,!0),this.show=i(e.show,!0),this.id=e.id,this._id=void 0,this._outlinePrimitives=[],this._planesPrimitives=[]}var w=new e,g=new m,y=new C,P=new f,O=new p,F=new l,I=new c,b=new t,A=[1,1e5];return _.prototype.update=function(i){if(this.show){var o,n,s=this._planesPrimitives,c=this._outlinePrimitives;if(this._updateOnChange){for(n=s.length,o=0;o<n;++o)c[o]=c[o]&&c[o].destroy(),s[o]=s[o]&&s[o].destroy();s.length=0,c.length=0}if(0===s.length){var _,G=this._camera,W=G.frustum;_=W instanceof f?P:W instanceof p?O:W instanceof l?F:I,_=W.clone(_);var E=i.frustumSplits,M=E.length-1;M<=0&&((E=A)[0]=this._camera.frustum.near,E[1]=this._camera.frustum.far,M=1);var N=G.positionWC,k=G.directionWC,x=G.upWC,D=G.rightWC;D=e.negate(D,w);var T=g;m.setColumn(T,0,D,T),m.setColumn(T,1,x,T),m.setColumn(T,2,k,T);var Y=C.fromRotationMatrix(T,y);for(s.length=c.length=M,o=0;o<M;++o)_.near=E[o],_.far=E[o+1],s[o]=new v({geometryInstances:new h({geometry:new a({origin:N,orientation:Y,frustum:_,_drawNearPlane:0===o}),attributes:{color:r.fromColor(t.fromAlpha(this._color,.1,b))},id:this.id,pickPrimitive:this}),appearance:new d({translucent:!0,flat:!0}),asynchronous:!1}),c[o]=new v({geometryInstances:new h({geometry:new u({origin:N,orientation:Y,frustum:_,_drawNearPlane:0===o}),attributes:{color:r.fromColor(this._color)},id:this.id,pickPrimitive:this}),appearance:new d({translucent:!1,flat:!0}),asynchronous:!1})}for(n=s.length,o=0;o<n;++o)c[o].update(i),s[o].update(i)}},_.prototype.isDestroyed=function(){return!1},_.prototype.destroy=function(){for(var e=this._planesPrimitives.length,t=0;t<e;++t)this._outlinePrimitives[t]=this._outlinePrimitives[t]&&this._outlinePrimitives[t].destroy(),this._planesPrimitives[t]=this._planesPrimitives[t]&&this._planesPrimitives[t].destroy();return n(this)},_});