define(["../Core/defaultValue","../Core/defined","../Core/DeveloperError","../Core/getImagePixels","../Core/Resource"],function(e,i,s,r,t){"use strict";function o(o){if(o=e(o,e.EMPTY_OBJECT),!i(o.missingImageUrl))throw new s("options.missingImageUrl is required.");if(!i(o.pixelsToCheck))throw new s("options.pixelsToCheck is required.");this._pixelsToCheck=o.pixelsToCheck,this._missingImagePixels=void 0,this._missingImageByteLength=void 0,this._isReady=!1;var n=this;t.createIfNeeded(o.missingImageUrl).fetchImage({preferBlob:!0,preferImageBitmap:!0,flipY:!0}).then(function(e){i(e.blob)&&(n._missingImageByteLength=e.blob.size);var s=r(e);if(o.disableCheckIfAllPixelsAreTransparent){for(var t=!0,a=e.width,l=o.pixelsToCheck,h=0,g=l.length;t&&h<g;++h){var d=l[h];s[4*d.x+d.y*a+3]>0&&(t=!1)}t&&(s=void 0)}n._missingImagePixels=s,n._isReady=!0}).otherwise(function(){n._missingImagePixels=void 0,n._isReady=!0})}return o.prototype.isReady=function(){return this._isReady},o.prototype.shouldDiscardImage=function(e){if(!this._isReady)throw new s("shouldDiscardImage must not be called before the discard policy is ready.");var t=this._pixelsToCheck,o=this._missingImagePixels;if(!i(o))return!1;if(i(e.blob)&&e.blob.size!==this._missingImageByteLength)return!1;for(var n=r(e),a=e.width,l=0,h=t.length;l<h;++l)for(var g=t[l],d=4*g.x+g.y*a,m=0;m<4;++m){var f=d+m;if(n[f]!==o[f])return!1}return!0},o});