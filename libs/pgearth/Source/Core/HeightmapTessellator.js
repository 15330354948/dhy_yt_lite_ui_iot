define(["./AxisAlignedBoundingBox","./BoundingSphere","./Cartesian2","./Cartesian3","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./EllipsoidalOccluder","./freezeObject","./Math","./Matrix4","./OrientedBoundingBox","./Rectangle","./TerrainEncoding","./Transforms","./WebMercatorProjection"],function(e,t,i,r,n,a,o,s,h,u,d,T,l,g,m,c,I){"use strict";var E={};E.DEFAULT_STRUCTURE=u({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1});var p=new r,f=new T,v=new r,w=new r;return E.computeVertices=function(u){if(!a(u)||!a(u.heightmap))throw new o("options.heightmap is required.");if(!a(u.width)||!a(u.height))throw new o("options.width and options.height are required.");if(!a(u.nativeRectangle))throw new o("options.nativeRectangle is required.");if(!a(u.skirtHeight))throw new o("options.skirtHeight is required.");var N,R,S,U,A=Math.cos,_=Math.sin,F=Math.sqrt,M=Math.atan,x=Math.exp,O=d.PI_OVER_TWO,P=d.toRadians,C=u.heightmap,y=u.width,B=u.height,L=u.skirtHeight,b=n(u.isGeographic,!0),V=n(u.ellipsoid,s.WGS84),D=1/V.maximumRadius,H=u.nativeRectangle,W=u.rectangle;a(W)?(N=W.west,R=W.south,S=W.east,U=W.north):b?(N=P(H.west),R=P(H.south),S=P(H.east),U=P(H.north)):(N=H.west*D,R=O-2*M(x(-H.south*D)),S=H.east*D,U=O-2*M(x(-H.north*D)));var Y=u.relativeToCenter,q=a(Y);Y=q?Y:r.ZERO;var z=n(u.exaggeration,1),G=n(u.includeWebMercatorT,!1),k=n(u.structure,E.DEFAULT_STRUCTURE),j=n(k.heightScale,E.DEFAULT_STRUCTURE.heightScale),Z=n(k.heightOffset,E.DEFAULT_STRUCTURE.heightOffset),J=n(k.elementsPerHeight,E.DEFAULT_STRUCTURE.elementsPerHeight),K=n(k.stride,E.DEFAULT_STRUCTURE.stride),Q=n(k.elementMultiplier,E.DEFAULT_STRUCTURE.elementMultiplier),X=n(k.isBigEndian,E.DEFAULT_STRUCTURE.isBigEndian),$=g.computeWidth(H),ee=g.computeHeight(H),te=$/(y-1),ie=ee/(B-1);b||($*=D,ee*=D);var re,ne,ae=V.radiiSquared,oe=ae.x,se=ae.y,he=ae.z,ue=65536,de=-65536,Te=c.eastNorthUpToFixedFrame(Y,V),le=T.inverseTransformation(Te,f);G&&(re=I.geodeticLatitudeToMercatorAngle(R),ne=1/(I.geodeticLatitudeToMercatorAngle(U)-re));var ge=v;ge.x=Number.POSITIVE_INFINITY,ge.y=Number.POSITIVE_INFINITY,ge.z=Number.POSITIVE_INFINITY;var me=w;me.x=Number.NEGATIVE_INFINITY,me.y=Number.NEGATIVE_INFINITY,me.z=Number.NEGATIVE_INFINITY;var ce=Number.POSITIVE_INFINITY,Ie=y+(L>0?2:0),Ee=B+(L>0?2:0),pe=Ie*Ee,fe=new Array(pe),ve=new Array(pe),we=new Array(pe),Ne=G?new Array(pe):[],Re=0,Se=B,Ue=0,Ae=y;L>0&&(--Re,++Se,--Ue,++Ae);for(var _e=0,Fe=Re;Fe<Se;++Fe){var Me=Fe;Me<0&&(Me=0),Me>=B&&(Me=B-1);var xe,Oe=H.north-ie*Me,Pe=A(Oe=b?P(Oe):O-2*M(x(-Oe*D))),Ce=_(Oe),ye=he*Ce,Be=(Oe-R)/(U-R);Be=d.clamp(Be,0,1),G&&(xe=(I.geodeticLatitudeToMercatorAngle(Oe)-re)*ne);for(var Le=Ue;Le<Ae;++Le){var be=Le;be<0&&(be=0),be>=y&&(be=y-1);var Ve=H.west+te*be;b?Ve=P(Ve):Ve*=D;var De,He,We=Me*(y*K)+be*K;if(1===J)De=C[We];else if(De=0,X)for(He=0;He<J;++He)De=De*Q+C[We+He];else for(He=J-1;He>=0;--He)De=De*Q+C[We+He];De=(De*j+Z)*z;var Ye=(Ve-N)/(S-N);if(Ye=d.clamp(Ye,0,1),we[_e]=new i(Ye,Be),de=Math.max(de,De),ue=Math.min(ue,De),Le!==be||Fe!==Me){Le<0?Ve-=1e-5*$:Ve+=1e-5*$,Fe<0?Oe+=1e-5*ee:Oe-=1e-5*ee,Pe=A(Oe),ye=he*(Ce=_(Oe)),De-=L}var qe=Pe*A(Ve),ze=Pe*_(Ve),Ge=oe*qe,ke=se*ze,je=1/F(Ge*qe+ke*ze+ye*Ce),Ze=Ge*je,Je=ke*je,Ke=ye*je,Qe=new r;Qe.x=Ze+qe*De,Qe.y=Je+ze*De,Qe.z=Ke+Ce*De,fe[_e]=Qe,ve[_e]=De,G&&(Ne[_e]=xe),_e++,T.multiplyByPoint(le,Qe,p),r.minimumByComponent(p,ge,ge),r.maximumByComponent(p,me,me),ce=Math.min(ce,De)}}var Xe,$e,et=t.fromPoints(fe);(a(W)&&W.width<d.PI_OVER_TWO+d.EPSILON5&&(Xe=l.fromRectangle(W,ue,de,V)),q)&&($e=new h(V).computeHorizonCullingPoint(Y,fe));for(var tt,it,rt,nt,at=new e(ge,me,Y),ot=new m(at,ce,de,Te,!1,G),st=new Float32Array(pe*ot.getStride()),ht=0,ut=0;ut<pe;++ut)ht=ot.encode(st,ht,fe[ut],we[ut],ve[ut],void 0,Ne[ut]);if(L>0){nt=[],it=[];for(var dt=0;dt<y;++dt)nt.push(Ie+1+dt),it.push(Ie*(Ee-1)-2-dt);tt=[],rt=[];for(var Tt=0;Tt<B;++Tt)rt.push((Tt+1)*Ie+y),tt.push((B-Tt)*Ie+1)}else{nt=[],it=[];for(var lt=0;lt<y;++lt)nt.push(lt),it.push(y*B-1-lt);tt=[],rt=[];for(var gt=0;gt<B;++gt)rt.push((gt+1)*y-1),tt.push((B-gt-1)*y)}return{vertices:st,maximumHeight:de,minimumHeight:ue,encoding:ot,boundingSphere3D:et,orientedBoundingBox:Xe,occludeePointInScaledSpace:$e,westIndicesSouthToNorth:tt,southIndicesEastToWest:it,eastIndicesNorthToSouth:rt,northIndicesWestToEast:nt}},E});