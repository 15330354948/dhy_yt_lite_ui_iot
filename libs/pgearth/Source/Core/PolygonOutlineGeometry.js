define(["./ArcType","./arrayFill","./arrayRemoveDuplicates","./BoundingSphere","./Cartesian3","./Check","./ComponentDatatype","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./EllipsoidTangentPlane","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryInstance","./GeometryOffsetAttribute","./GeometryPipeline","./IndexDatatype","./Math","./PolygonGeometryLibrary","./PolygonPipeline","./PrimitiveType","./Queue","./WindingOrder"],function(e,t,i,r,o,n,a,s,p,u,y,h,l,d,g,c,f,v,m,b,_,E,H,P,A){"use strict";var T=[],O=[];function w(t,i,r,o,n){var s,p,u=h.fromPoints(i,t).projectPointsOntoPlane(i,T);E.computeWindingOrder2D(u)===A.CLOCKWISE&&(u.reverse(),i=i.slice().reverse());var y=i.length,f=0;if(o)for(s=new Float64Array(2*y*3),p=0;p<y;p++){var v=i[p],b=i[(p+1)%y];s[f++]=v.x,s[f++]=v.y,s[f++]=v.z,s[f++]=b.x,s[f++]=b.y,s[f++]=b.z}else{var P=0;if(n===e.GEODESIC)for(p=0;p<y;p++)P+=_.subdivideLineCount(i[p],i[(p+1)%y],r);else if(n===e.RHUMB)for(p=0;p<y;p++)P+=_.subdivideRhumbLineCount(t,i[p],i[(p+1)%y],r);for(s=new Float64Array(3*P),p=0;p<y;p++){var w;n===e.GEODESIC?w=_.subdivideLine(i[p],i[(p+1)%y],r,O):n===e.RHUMB&&(w=_.subdivideRhumbLine(t,i[p],i[(p+1)%y],r,O));for(var L=w.length,D=0;D<L;++D)s[f++]=w[D]}}var x=2*(y=s.length/3),G=m.createTypedArray(y,x);for(f=0,p=0;p<y-1;p++)G[f++]=p,G[f++]=p+1;return G[f++]=y-1,G[f++]=0,new c({geometry:new l({attributes:new g({position:new d({componentDatatype:a.DOUBLE,componentsPerAttribute:3,values:s})}),indices:G,primitiveType:H.LINES})})}function L(t,i,r,o,n){var s,p,u=h.fromPoints(i,t).projectPointsOntoPlane(i,T);E.computeWindingOrder2D(u)===A.CLOCKWISE&&(u.reverse(),i=i.slice().reverse());var y=i.length,f=new Array(y),v=0;if(o)for(s=new Float64Array(2*y*3*2),p=0;p<y;++p){f[p]=v/3;var b=i[p],P=i[(p+1)%y];s[v++]=b.x,s[v++]=b.y,s[v++]=b.z,s[v++]=P.x,s[v++]=P.y,s[v++]=P.z}else{var w=0;if(n===e.GEODESIC)for(p=0;p<y;p++)w+=_.subdivideLineCount(i[p],i[(p+1)%y],r);else if(n===e.RHUMB)for(p=0;p<y;p++)w+=_.subdivideRhumbLineCount(t,i[p],i[(p+1)%y],r);for(s=new Float64Array(3*w*2),p=0;p<y;++p){var L;f[p]=v/3,n===e.GEODESIC?L=_.subdivideLine(i[p],i[(p+1)%y],r,O):n===e.RHUMB&&(L=_.subdivideRhumbLine(t,i[p],i[(p+1)%y],r,O));for(var D=L.length,x=0;x<D;++x)s[v++]=L[x]}}y=s.length/6;var G=f.length,I=2*(2*y+G),C=m.createTypedArray(y+G,I);for(v=0,p=0;p<y;++p)C[v++]=p,C[v++]=(p+1)%y,C[v++]=p+y,C[v++]=(p+1)%y+y;for(p=0;p<G;p++){var S=f[p];C[v++]=S,C[v++]=S+y}return new c({geometry:new l({attributes:new g({position:new d({componentDatatype:a.DOUBLE,componentsPerAttribute:3,values:s})}),indices:C,primitiveType:H.LINES})})}function D(t){if(n.typeOf.object("options",t),n.typeOf.object("options.polygonHierarchy",t.polygonHierarchy),t.perPositionHeight&&p(t.height))throw new u("Cannot use both options.perPositionHeight and options.height");if(p(t.arcType)&&t.arcType!==e.GEODESIC&&t.arcType!==e.RHUMB)throw new u("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var i=t.polygonHierarchy,r=s(t.ellipsoid,y.WGS84),o=s(t.granularity,b.RADIANS_PER_DEGREE),a=s(t.perPositionHeight,!1),h=a&&p(t.extrudedHeight),l=s(t.arcType,e.GEODESIC),d=s(t.height,0),g=s(t.extrudedHeight,d);if(!h){var c=Math.max(d,g);g=Math.min(d,g),d=c}this._ellipsoid=y.clone(r),this._granularity=o,this._height=d,this._extrudedHeight=g,this._arcType=l,this._polygonHierarchy=i,this._perPositionHeight=a,this._perPositionHeightExtrude=h,this._offsetAttribute=t.offsetAttribute,this._workerName="createPolygonOutlineGeometry",this.packedLength=_.computeHierarchyPackedLength(i)+y.packedLength+8}D.pack=function(e,t,i){return n.typeOf.object("value",e),n.defined("array",t),i=s(i,0),i=_.packPolygonHierarchy(e._polygonHierarchy,t,i),y.pack(e._ellipsoid,t,i),i+=y.packedLength,t[i++]=e._height,t[i++]=e._extrudedHeight,t[i++]=e._granularity,t[i++]=e._perPositionHeightExtrude?1:0,t[i++]=e._perPositionHeight?1:0,t[i++]=e._arcType,t[i++]=s(e._offsetAttribute,-1),t[i]=e.packedLength,t};var x=y.clone(y.UNIT_SPHERE),G={polygonHierarchy:{}};return D.unpack=function(e,t,i){n.defined("array",e),t=s(t,0);var r=_.unpackPolygonHierarchy(e,t);t=r.startingIndex,delete r.startingIndex;var o=y.unpack(e,t,x);t+=y.packedLength;var a=e[t++],u=e[t++],h=e[t++],l=1===e[t++],d=1===e[t++],g=e[t++],c=e[t++],f=e[t];return p(i)||(i=new D(G)),i._polygonHierarchy=r,i._ellipsoid=y.clone(o,i._ellipsoid),i._height=a,i._extrudedHeight=u,i._granularity=h,i._perPositionHeight=d,i._perPositionHeightExtrude=l,i._arcType=g,i._offsetAttribute=-1===c?void 0:c,i.packedLength=f,i},D.fromPositions=function(e){return e=s(e,s.EMPTY_OBJECT),n.defined("options.positions",e.positions),new D({polygonHierarchy:{positions:e.positions},height:e.height,extrudedHeight:e.extrudedHeight,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,arcType:e.arcType,offsetAttribute:e.offsetAttribute})},D.createGeometry=function(e){var i=e._ellipsoid,o=e._granularity,n=e._polygonHierarchy,s=e._perPositionHeight,u=e._arcType,y=_.polygonOutlinesFromHierarchy(n,!s,i);if(0!==y.length){var h,g,c,m=[],H=b.chordLength(o,i.maximumRadius),P=e._height,A=e._extrudedHeight;if(e._perPositionHeightExtrude||!b.equalsEpsilon(P,A,0,b.EPSILON2))for(c=0;c<y.length;c++){if((h=L(i,y[c],H,s,u)).geometry=_.scaleToGeodeticHeightExtruded(h.geometry,P,A,i,s),p(e._offsetAttribute)){var T=h.geometry.attributes.position.values.length/3,O=new Uint8Array(T);e._offsetAttribute===f.TOP?O=t(O,1,0,T/2):(g=e._offsetAttribute===f.NONE?0:1,O=t(O,g)),h.geometry.attributes.applyOffset=new d({componentDatatype:a.UNSIGNED_BYTE,componentsPerAttribute:1,values:O})}m.push(h)}else for(c=0;c<y.length;c++){if((h=w(i,y[c],H,s,u)).geometry.attributes.position.values=E.scaleToGeodeticHeight(h.geometry.attributes.position.values,P,i,!s),p(e._offsetAttribute)){var D=h.geometry.attributes.position.values.length,x=new Uint8Array(D/3);g=e._offsetAttribute===f.NONE?0:1,t(x,g),h.geometry.attributes.applyOffset=new d({componentDatatype:a.UNSIGNED_BYTE,componentsPerAttribute:1,values:x})}m.push(h)}var G=v.combineInstances(m)[0],I=r.fromVertices(G.attributes.position.values);return new l({attributes:G.attributes,indices:G.indices,primitiveType:G.primitiveType,boundingSphere:I,offsetAttribute:e._offsetAttribute})}},D});