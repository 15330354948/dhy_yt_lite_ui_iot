define(["../../Core/Color","../../Scene/LabelStyle","../../Scene/HorizontalOrigin","../../Scene/VerticalOrigin","../../Core/ScreenSpaceEventHandler","../../Core/ScreenSpaceEventType","../../Scene/PointPrimitiveCollection","../../Scene/BlendOption","../../Core/Math","../../Core/GeometryInstance","../../Core/GroundPolylineGeometry","../../Core/EllipseGeometry","../../Core/Cartesian3","../../Core/ColorGeometryInstanceAttribute","../../Scene/GroundPrimitive","../../Scene/GroundPolylinePrimitive","../../Scene/PolylineColorAppearance","../../Core/DistanceDisplayConditionGeometryInstanceAttribute","./support/PickGlobe","../../Scene/HeightReference"],function(e,t,i,o,n,s,l,r,a,c,h,p,w,d,v,m,u,D,b,g){function C(l){this.viewer=l,this.scene=this.viewer.scene,this.path=[],this.lines=[],this.label=[],this.pickGlobe=new b(l),this.pixelPoints=[],this.lastPoint=null,this.totalLength=0,this.tempLine=null,this.tempLabel=null,this.point=this.viewer.entities.add({point:{color:e.RED,pixelSize:10}}),this.labelTotle=this.viewer.entities.add({label:{show:!1,showBackground:!0,font:"36px Helvetica",fillColor:e.WHITE,outlineColor:e.BLACK,outlineWidth:1,style:t.FILL_AND_OUTLINE,horizontalOrigin:i.CENTER,verticalOrigin:o.BASELINE,disableDepthTestDistance:1e4,scale:.5}});var r=this;this.clickDraw=new n(this.scene.canvas),this.clickDraw.setInputAction(function(n){var s=r.pickGlobe.pickGlobe(n.position);r.lastPoint=s;var l=r.scene.globe.ellipsoid.cartesianToCartographic(s),u=r.path,D=(l&&l.longitude&&a.toDegrees(l.longitude),l&&l.latitude&&a.toDegrees(l.latitude),0);if(!((l&&l.height?l.height:null)<-50)){r.tempLabel&&r.viewer.entities.remove(r.tempLabel),u.push(s);var b=u.length,C=r.scene.primitives.add(new v(new c({geometry:new p({center:s,semiMinorAxis:5,semiMajorAxis:5}),attributes:{color:new d.fromColor(e.RED.withAlpha(.8))}})));if(r.pixelPoints.push(C),b>1){var L=r.scene.groundPrimitives.add(new m({geometryInstances:new c({geometry:new h({positions:[u[b-1],u[b-2]],width:4}),attributes:{color:d.fromColor(e.RED.withAlpha(.7))}})}));r.lines.push(L),D=w.distance(u[b-1],u[b-2]),r.totalLength=r.totalLength+1*D.toFixed(2),r.labelTotle.position=u[0],r.labelTotle.show=!0,r.labelTotle.label.show=!0,r.labelTotle.label.text="总长:"+r.totalLength.toFixed(2)+"米";var y=new w(0,0,0);y.x=(u[b-1].x+u[b-2].x)/2,y.y=(u[b-1].y+u[b-2].y)/2,y.z=(u[b-1].z+u[b-2].z)/2;var f=r.viewer.entities.add({show:!0,position:y,label:{show:!0,text:D.toFixed(2)+"米",showBackground:!0,font:"36px Helvetica",fillColor:e.WHITE,outlineColor:e.BLACK,outlineWidth:1,style:t.FILL_AND_OUTLINE,horizontalOrigin:i.CENTER,verticalOrigin:o.BASELINE,disableDepthTestDistance:1e4,scale:.5,heightReference:g.CLAMP_TO_GROUND,eyeOffset:new w(0,3,0)}});r.label.push(f)}r.viewer.scene.requestRenderMode=!1}},s.LEFT_CLICK),this.moveDraw=new n(this.scene.canvas),this.moveDraw.setInputAction(function(n){var s=r.pickGlobe.pickGlobe(n.endPosition);if(s&&r.lastPoint){r.tempLine&&r.scene.groundPrimitives.remove(r.tempLine),r.tempLabel&&r.viewer.entities.remove(r.tempLabel),r.tempLine=r.scene.groundPrimitives.add(new m({geometryInstances:new c({geometry:new h({positions:[s,r.lastPoint],width:4}),attributes:{color:d.fromColor(e.RED.withAlpha(.7))}})}));var l={x:(s.x+r.lastPoint.x)/2,y:(s.y+r.lastPoint.y)/2,z:(s.z+r.lastPoint.z)/2},a=w.distance(s,r.lastPoint);r.tempLabel=r.viewer.entities.add({show:!0,position:l,label:{show:!0,text:a.toFixed(2)+"米",showBackground:!0,font:"36px Helvetica",fillColor:e.WHITE,outlineColor:e.BLACK,outlineWidth:1,style:t.FILL_AND_OUTLINE,horizontalOrigin:i.CENTER,verticalOrigin:o.BASELINE,disableDepthTestDistance:1e4,scale:.5,heightReference:g.CLAMP_TO_GROUND,eyeOffset:new w(0,3,0)}}),r.labelTotle.label.text="总长:"+(1*r.totalLength+1*a.toFixed(2)).toFixed(2)+"米"}r.point&&(r.point.position=s)},s.MOUSE_MOVE),this.stopDraw=new n(this.scene.canvas),this.stopDraw.setInputAction(function(e){r.clickDraw&&!r.clickDraw.isDestroyed()&&r.clickDraw.destroy(),r.moveDraw&&!r.moveDraw.isDestroyed()&&r.moveDraw.destroy()},s.RIGHT_CLICK)}return C.prototype.clear=function(){var e=this;this.viewer.entities.remove(this.labelTotle),this.viewer.entities.remove(this.point),this.scene.groundPrimitives.remove(this.tempLine),this.viewer.entities.remove(this.tempLabel),this.label.forEach(function(t){e.viewer.entities.remove(t)}),this.lines.forEach(function(t){e.scene.groundPrimitives.remove(t)}),this.clickDraw&&!this.clickDraw.isDestroyed()&&this.clickDraw.destroy(),this.moveDraw&&!this.moveDraw.isDestroyed()&&this.moveDraw.destroy(),this.point=null,this.path=[],this.lines=[]},C});