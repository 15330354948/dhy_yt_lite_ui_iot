define(["./Cartesian3","./Cartographic","./defined","./DeveloperError","./GeographicProjection","./Math","./Matrix2","./Rectangle"],function(n,t,r,a,o,e,s,i){"use strict";var g=Math.cos,h=Math.sin,u=Math.sqrt,c={computePosition:function(n,t,a,o,e,s,i){var c=t.radiiSquared,l=n.nwCorner,C=n.boundingRectangle,S=l.latitude-n.granYCos*o+e*n.granXSin,d=g(S),w=h(S),X=c.z*w,Y=l.longitude+o*n.granYSin+e*n.granXCos,v=d*g(Y),O=d*h(Y),_=c.x*v,p=c.y*O,M=u(_*v+p*O+X*w);if(s.x=_/M,s.y=p/M,s.z=X/M,a){var f=n.stNwCorner;r(f)?(S=f.latitude-n.stGranYCos*o+e*n.stGranXSin,Y=f.longitude+o*n.stGranYSin+e*n.stGranXCos,i.x=(Y-n.stWest)*n.lonScalar,i.y=(S-n.stSouth)*n.latScalar):(i.x=(Y-C.west)*n.lonScalar,i.y=(S-C.south)*n.latScalar)}}},l=new s,C=new n,S=new t,d=new n,w=new o;function X(t,r,a,o,e,i,g){var h=Math.cos(r),u=o*h,c=a*h,S=Math.sin(r),X=o*S,Y=a*S;C=w.project(t,C),C=n.subtract(C,d,C);var v=s.fromRotation(r,l);C=s.multiplyByVector(v,C,C),C=n.add(C,d,C),i-=1,g-=1;var O=(t=w.unproject(C,t)).latitude,_=O+i*Y,p=O-u*g,M=O-u*g+i*Y,f=Math.max(O,_,p,M),R=Math.min(O,_,p,M),P=t.longitude,W=P+i*c,G=P+g*X,I=P+g*X+i*c;return{north:f,south:R,east:Math.max(P,W,G,I),west:Math.min(P,W,G,I),granYCos:u,granYSin:X,granXCos:c,granXSin:Y,nwCorner:t}}return c.computeOptions=function(n,t,r,o,s,g,h){var u,c,l,C,Y,v=n.east,O=n.west,_=n.north,p=n.south,M=!1,f=!1;_===e.PI_OVER_TWO&&(M=!0),p===-e.PI_OVER_TWO&&(f=!0);var R=_-p;l=(Y=O>v?e.TWO_PI-O+v:v-O)/((u=Math.ceil(Y/t)+1)-1),C=R/((c=Math.ceil(R/t)+1)-1);var P=i.northwest(n,g),W=i.center(n,S);0===r&&0===o||(W.longitude<P.longitude&&(W.longitude+=e.TWO_PI),d=w.project(W,d));var G=C,I=l,m=i.clone(n,s),T={granYCos:G,granYSin:0,granXCos:I,granXSin:0,nwCorner:P,boundingRectangle:m,width:u,height:c,northCap:M,southCap:f};if(0!==r){var x=X(P,r,l,C,0,u,c);if(_=x.north,p=x.south,v=x.east,O=x.west,_<-e.PI_OVER_TWO||_>e.PI_OVER_TWO||p<-e.PI_OVER_TWO||p>e.PI_OVER_TWO)throw new a("Rotated rectangle is invalid.  It crosses over either the north or south pole.");T.granYCos=x.granYCos,T.granYSin=x.granYSin,T.granXCos=x.granXCos,T.granXSin=x.granXSin,m.north=_,m.south=p,m.east=v,m.west=O}if(0!==o){r-=o;var E=i.northwest(m,h),V=X(E,r,l,C,0,u,c);T.stGranYCos=V.granYCos,T.stGranXCos=V.granXCos,T.stGranYSin=V.granYSin,T.stGranXSin=V.granXSin,T.stNwCorner=E,T.stWest=V.west,T.stSouth=V.south}return T},c});