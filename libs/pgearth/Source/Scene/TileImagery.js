define(["../Core/defined","./ImageryState"],function(e,t){"use strict";function a(e,t,a){this.readyImagery=void 0,this.loadingImagery=e,this.textureCoordinateRectangle=t,this.textureTranslationAndScale=void 0,this.useWebMercatorT=a}return a.prototype.freeResources=function(){e(this.readyImagery)&&this.readyImagery.releaseReference(),e(this.loadingImagery)&&this.loadingImagery.releaseReference()},a.prototype.processStateMachine=function(a,r,s){var i=this.loadingImagery,n=i.imageryLayer;if(i.processStateMachine(r,!this.useWebMercatorT,s),i.state===t.READY)return e(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=this.loadingImagery,this.loadingImagery=void 0,this.textureTranslationAndScale=n._calculateTextureTranslationAndScale(a,this),!0;for(var o,c=i.parent;e(c)&&(c.state!==t.READY||!this.useWebMercatorT&&!e(c.texture));)c.state!==t.FAILED&&c.state!==t.INVALID&&(o=o||c),c=c.parent;return this.readyImagery!==c&&(e(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=c,e(c)&&(c.addReference(),this.textureTranslationAndScale=n._calculateTextureTranslationAndScale(a,this))),(i.state===t.FAILED||i.state===t.INVALID)&&(!e(o)||(o.processStateMachine(r,!this.useWebMercatorT,s),!1))},a});