define(["./AssociativeArray","./Cartesian2","./defaultValue","./defined","./destroyObject","./DeveloperError","./FeatureDetection","./getTimestamp","./KeyboardEventModifier","./ScreenSpaceEventType"],function(t,o,i,n,e,r,s,u,a,c){"use strict";function l(t,o,i){var n=t._element;if(n===document)return i.x=o.clientX,i.y=o.clientY,i;var e=n.getBoundingClientRect();return i.x=o.clientX-e.left,i.y=o.clientY-e.top,i}function p(t,o){var i=t;return n(o)&&(i+="+"+o),i}function _(t){return t.shiftKey?a.SHIFT:t.ctrlKey?a.CTRL:t.altKey?a.ALT:void 0}var v={LEFT:0,MIDDLE:1,RIGHT:2};function f(t,o,i,n){function e(o){n(t,o)}i.addEventListener(o,e,!1),t._removalFunctions.push(function(){i.removeEventListener(o,e,!1)})}var d={position:new o};function h(t){t._lastSeenTouchEvent=u()}function P(t){return u()-t._lastSeenTouchEvent>k.mouseEmulationIgnoreMilliseconds}function m(t,o,i){var n=t.x-o.x,e=t.y-o.y;return Math.sqrt(n*n+e*e)<i}function T(t,i){if(P(t)){var e,r=i.button;if(t._buttonDown[r]=!0,r===v.LEFT)e=c.LEFT_DOWN;else if(r===v.MIDDLE)e=c.MIDDLE_DOWN;else{if(r!==v.RIGHT)return;e=c.RIGHT_DOWN}var s=l(t,i,t._primaryPosition);o.clone(s,t._primaryStartPosition),o.clone(s,t._primaryPreviousPosition);var u=_(i),a=t.getInputAction(e,u);n(a)&&(o.clone(s,d.position),a(d),i.preventDefault())}}var E={position:new o},D={position:new o};function I(t,i,e,r){var s=_(r),u=t.getInputAction(i,s),a=t.getInputAction(e,s);if(n(u)||n(a)){var c=l(t,r,t._primaryPosition);if(n(u)&&(o.clone(c,E.position),u(E)),n(a))m(t._primaryStartPosition,c,t._clickPixelTolerance)&&(o.clone(c,D.position),a(D))}}function w(t,o){if(P(t)){var i=o.button;i!==v.LEFT&&i!==v.MIDDLE&&i!==v.RIGHT||(t._buttonDown[v.LEFT]&&(I(t,c.LEFT_UP,c.LEFT_CLICK,o),t._buttonDown[v.LEFT]=!1),t._buttonDown[v.MIDDLE]&&(I(t,c.MIDDLE_UP,c.MIDDLE_CLICK,o),t._buttonDown[v.MIDDLE]=!1),t._buttonDown[v.RIGHT]&&(I(t,c.RIGHT_UP,c.RIGHT_CLICK,o),t._buttonDown[v.RIGHT]=!1))}}var y={startPosition:new o,endPosition:new o};function g(t,i){if(P(t)){var e=_(i),r=l(t,i,t._primaryPosition),s=t._primaryPreviousPosition,u=t.getInputAction(c.MOUSE_MOVE,e);n(u)&&(o.clone(s,y.startPosition),o.clone(r,y.endPosition),u(y)),o.clone(r,s),(t._buttonDown[v.LEFT]||t._buttonDown[v.MIDDLE]||t._buttonDown[v.RIGHT])&&i.preventDefault()}}var L={position:new o};function H(t,o){var i;if(o.button===v.LEFT){i=c.LEFT_DOUBLE_CLICK;var e=_(o),r=t.getInputAction(i,e);n(r)&&(l(t,o,L.position),r(L))}}function M(t,o){var i;if(n(o.deltaY)){var e=o.deltaMode;i=e===o.DOM_DELTA_PIXEL?-o.deltaY:e===o.DOM_DELTA_LINE?40*-o.deltaY:120*-o.deltaY}else i=o.detail>0?-120*o.detail:o.wheelDelta;if(n(i)){var r=_(o),s=t.getInputAction(c.WHEEL,r);n(s)&&(s(i),o.preventDefault())}}function A(t,i){h(t);var n,e,r,s=i.changedTouches,u=s.length,a=t._positions;for(n=0;n<u;++n)r=(e=s[n]).identifier,a.set(r,l(t,e,new o));x(t,i);var c=t._previousPositions;for(n=0;n<u;++n)r=(e=s[n]).identifier,c.set(r,o.clone(a.get(r)))}function F(t,o){h(t);var i,n,e=o.changedTouches,r=e.length,s=t._positions;for(i=0;i<r;++i)n=e[i].identifier,s.remove(n);x(t,o);var u=t._previousPositions;for(i=0;i<r;++i)n=e[i].identifier,u.remove(n)}var b={position:new o},C={position1:new o,position2:new o},S={position:new o},R={position:new o},O={position:new o};function x(t,i){var e,r,s=_(i),u=t._positions,a=u.length,l=t._isPinching;if(1!==a&&t._buttonDown[v.LEFT]){if(t._buttonDown[v.LEFT]=!1,n(t._touchHoldTimer)&&(clearTimeout(t._touchHoldTimer),t._touchHoldTimer=void 0),e=t.getInputAction(c.LEFT_UP,s),n(e)&&(o.clone(t._primaryPosition,S.position),e(S)),0===a&&!t._isTouchHolding)if(r=t.getInputAction(c.LEFT_CLICK,s),n(r))m(t._primaryStartPosition,t._previousPositions.values[0],t._clickPixelTolerance)&&(o.clone(t._primaryPosition,R.position),r(R));t._isTouchHolding=!1}if(0===a&&l&&(t._isPinching=!1,e=t.getInputAction(c.PINCH_END,s),n(e)&&e()),1===a&&!l){var p=u.values[0];o.clone(p,t._primaryPosition),o.clone(p,t._primaryStartPosition),o.clone(p,t._primaryPreviousPosition),t._buttonDown[v.LEFT]=!0,e=t.getInputAction(c.LEFT_DOWN,s),n(e)&&(o.clone(p,b.position),e(b)),t._touchHoldTimer=setTimeout(function(){t.isDestroyed()||(t._touchHoldTimer=void 0,t._isTouchHolding=!0,r=t.getInputAction(c.RIGHT_CLICK,s),n(r)&&m(t._primaryStartPosition,t._previousPositions.values[0],t._holdPixelTolerance)&&(o.clone(t._primaryPosition,O.position),r(O)))},k.touchHoldDelayMilliseconds),i.preventDefault()}2!==a||l||(t._isPinching=!0,e=t.getInputAction(c.PINCH_START,s),n(e)&&(o.clone(u.values[0],C.position1),o.clone(u.values[1],C.position2),e(C),i.preventDefault()))}function G(t,i){h(t);var e,r,s,u=i.changedTouches,a=u.length,c=t._positions;for(e=0;e<a;++e){s=(r=u[e]).identifier;var p=c.get(s);n(p)&&l(t,r,p)}q(t,i);var _=t._previousPositions;for(e=0;e<a;++e)s=(r=u[e]).identifier,o.clone(c.get(s),_.get(s))}var K={startPosition:new o,endPosition:new o},N={distance:{startPosition:new o,endPosition:new o},angleAndHeight:{startPosition:new o,endPosition:new o}};function q(t,i){var e,r=_(i),s=t._positions,u=t._previousPositions,a=s.length;if(1===a&&t._buttonDown[v.LEFT]){var l=s.values[0];o.clone(l,t._primaryPosition);var p=t._primaryPreviousPosition;e=t.getInputAction(c.MOUSE_MOVE,r),n(e)&&(o.clone(p,K.startPosition),o.clone(l,K.endPosition),e(K)),o.clone(l,p),i.preventDefault()}else if(2===a&&t._isPinching&&(e=t.getInputAction(c.PINCH_MOVE,r),n(e))){var f=s.values[0],d=s.values[1],h=u.values[0],P=u.values[1],m=d.x-f.x,T=d.y-f.y,E=.25*Math.sqrt(m*m+T*T),D=P.x-h.x,I=P.y-h.y,w=.25*Math.sqrt(D*D+I*I),y=.125*(d.y+f.y),g=.125*(P.y+h.y),L=Math.atan2(T,m),H=Math.atan2(I,D);o.fromElements(0,w,N.distance.startPosition),o.fromElements(0,E,N.distance.endPosition),o.fromElements(H,g,N.angleAndHeight.startPosition),o.fromElements(L,y,N.angleAndHeight.endPosition),e(N)}}function U(t,i){if(i.target.setPointerCapture(i.pointerId),"touch"===i.pointerType){var n=t._positions,e=i.pointerId;n.set(e,l(t,i,new o)),x(t,i),t._previousPositions.set(e,o.clone(n.get(e)))}else T(t,i)}function Y(t,o){if("touch"===o.pointerType){var i=t._positions,n=o.pointerId;i.remove(n),x(t,o),t._previousPositions.remove(n)}else w(t,o)}function W(t,i){if("touch"===i.pointerType){var e=t._positions,r=i.pointerId,s=e.get(r);if(!n(s))return;l(t,i,s),q(t,i);var u=t._previousPositions;o.clone(e.get(r),u.get(r))}else g(t,i)}function k(e){this._inputEvents={},this._buttonDown={LEFT:!1,MIDDLE:!1,RIGHT:!1},this._isPinching=!1,this._isTouchHolding=!1,this._lastSeenTouchEvent=-k.mouseEmulationIgnoreMilliseconds,this._primaryStartPosition=new o,this._primaryPosition=new o,this._primaryPreviousPosition=new o,this._positions=new t,this._previousPositions=new t,this._removalFunctions=[],this._touchHoldTimer=void 0,this._clickPixelTolerance=5,this._holdPixelTolerance=25,this._element=i(e,document),function(t){var o=t._element,i=n(o.disableRootEvents)?o:document;s.supportsPointerEvents()?(f(t,"pointerdown",o,U),f(t,"pointerup",o,Y),f(t,"pointermove",o,W),f(t,"pointercancel",o,Y)):(f(t,"mousedown",o,T),f(t,"mouseup",i,w),f(t,"mousemove",i,g),f(t,"touchstart",o,A),f(t,"touchend",i,F),f(t,"touchmove",i,G),f(t,"touchcancel",i,F)),f(t,"dblclick",o,H),f(t,"onwheel"in o?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",o,M)}(this)}return k.prototype.setInputAction=function(t,o,i){if(!n(t))throw new r("action is required.");if(!n(o))throw new r("type is required.");var e=p(o,i);this._inputEvents[e]=t},k.prototype.getInputAction=function(t,o){if(!n(t))throw new r("type is required.");var i=p(t,o);return this._inputEvents[i]},k.prototype.removeInputAction=function(t,o){if(!n(t))throw new r("type is required.");var i=p(t,o);delete this._inputEvents[i]},k.prototype.isDestroyed=function(){return!1},k.prototype.destroy=function(){return function(t){for(var o=t._removalFunctions,i=0;i<o.length;++i)o[i]()}(this),e(this)},k.mouseEmulationIgnoreMilliseconds=800,k.touchHoldDelayMilliseconds=1500,k});