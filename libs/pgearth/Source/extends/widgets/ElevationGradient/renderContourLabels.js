define(["../support/lodash"],function(t){const e=e=>t.sortBy(e)[Math.floor(e.length/2)],o=.5*Math.PI,n=!1,r=.25,l=(t,e)=>({x:t%e,y:Math.floor(t/e)}),a=(t,e)=>t.x+t.y*e,s=(t,e,n)=>{const r=(o,r)=>{const l={x:n.x+o,y:n.y+r};return t[a(l,e)]},l=Math.floor(.2*e),s=r(l,0)-r(-l,0),i=r(0,l)-r(0,-l);return Math.atan2(i,s)+o};return function({canvas:o,values:i,maskSamples:u,majorContour:h,minorContour:x,fontSize:d,formatLabel:f,shouldRenderContourLabel:c,textColor:y,textOutlineColor:M}){const{width:C}=o,m=(e(i),Math.sqrt(i.length)),g=Math.round(e(i)/h)*h,S=i.map((t,e)=>({value:t,index:e})).filter(t=>(({x:t,y:e})=>t>m*r&&t<m*(1-r)&&e>m*r&&e<m*(1-r))(l(t.index,m))),b=S.map(t=>t.value),p=t.min(b),v=t.max(b);if(g<p||g>v||!c(g))return o;const k=t.sortBy(S,t=>Math.abs(t.value-g))[0];if(Math.abs(k.value-g)>.5*x)return o;const B=l(k.index,m),P=B.x*C/m,q=B.y*C/m,A=Math.sqrt(u.length),I={x:Math.round(B.x*A/m),y:Math.round(B.y*A/m)};if(u[a(I,A)]<.9)return o;const L=s(i,m,B),R=o.getContext("2d");n&&(R.strokeStyle=M.toCssColorString(),R.lineWidth=1,R.strokeRect(1,1,C-1,C-1));const T=f(g);return R.font=`bold ${d}px Arial`,R.textAlign="center",R.textBaseline="middle",R.translate(P,q),R.rotate(L),R.lineWidth=3,R.strokeStyle=M.toCssColorString(),R.strokeText(T,0,0),R.fillStyle=y.toCssColorString(),R.fillText(T,0,0),n&&(R.beginPath(),R.arc(0,0,3,0,2*Math.PI,!1),R.fillStyle="red",R.fill()),o}});