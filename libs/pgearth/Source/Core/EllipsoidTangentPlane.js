define(["./AxisAlignedBoundingBox","./Cartesian2","./Cartesian3","./Cartesian4","./Check","./defaultValue","./defined","./defineProperties","./DeveloperError","./Ellipsoid","./IntersectionTests","./Matrix4","./Plane","./Ray","./Transforms"],function(t,e,n,i,r,o,a,s,l,c,d,p,u,f,h){"use strict";var g=new i;function x(t,e){if(r.defined("origin",t),t=(e=o(e,c.WGS84)).scaleToGeodeticSurface(t),!a(t))throw new l("origin must not be at the center of the ellipsoid.");var i=h.eastNorthUpToFixedFrame(t,e);this._ellipsoid=e,this._origin=t,this._xAxis=n.fromCartesian4(p.getColumn(i,0,g)),this._yAxis=n.fromCartesian4(p.getColumn(i,1,g));var s=n.fromCartesian4(p.getColumn(i,2,g));this._plane=u.fromPointNormal(t,s)}s(x.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},origin:{get:function(){return this._origin}},plane:{get:function(){return this._plane}},xAxis:{get:function(){return this._xAxis}},yAxis:{get:function(){return this._yAxis}},zAxis:{get:function(){return this._plane.normal}}});var y=new t;x.fromPoints=function(e,n){return r.defined("cartesians",e),new x(t.fromPoints(e,y).center,n)};var _=new f,P=new n;x.prototype.projectPointOntoPlane=function(t,i){r.defined("cartesian",t);var o=_;o.origin=t,n.normalize(t,o.direction);var s=d.rayPlane(o,this._plane,P);if(a(s)||(n.negate(o.direction,o.direction),s=d.rayPlane(o,this._plane,P)),a(s)){var l=n.subtract(s,this._origin,s),c=n.dot(this._xAxis,l),p=n.dot(this._yAxis,l);return a(i)?(i.x=c,i.y=p,i):new e(c,p)}},x.prototype.projectPointsOntoPlane=function(t,e){r.defined("cartesians",t),a(e)||(e=[]);for(var n=0,i=t.length,o=0;o<i;o++){var s=this.projectPointOntoPlane(t[o],e[n]);a(s)&&(e[n]=s,n++)}return e.length=n,e},x.prototype.projectPointToNearestOnPlane=function(t,i){r.defined("cartesian",t),a(i)||(i=new e);var o=_;o.origin=t,n.clone(this._plane.normal,o.direction);var s=d.rayPlane(o,this._plane,P);a(s)||(n.negate(o.direction,o.direction),s=d.rayPlane(o,this._plane,P));var l=n.subtract(s,this._origin,s),c=n.dot(this._xAxis,l),p=n.dot(this._yAxis,l);return i.x=c,i.y=p,i},x.prototype.projectPointsToNearestOnPlane=function(t,e){r.defined("cartesians",t),a(e)||(e=[]);var n=t.length;e.length=n;for(var i=0;i<n;i++)e[i]=this.projectPointToNearestOnPlane(t[i],e[i]);return e};var v=new n;return x.prototype.projectPointOntoEllipsoid=function(t,e){r.defined("cartesian",t),a(e)||(e=new n);var i=this._ellipsoid,o=this._origin,s=this._xAxis,l=this._yAxis,c=v;return n.multiplyByScalar(s,t.x,c),e=n.add(o,c,e),n.multiplyByScalar(l,t.y,c),n.add(e,c,e),i.scaleToGeocentricSurface(e,e),e},x.prototype.projectPointsOntoEllipsoid=function(t,e){r.defined("cartesians",t);var n=t.length;a(e)?e.length=n:e=new Array(n);for(var i=0;i<n;++i)e[i]=this.projectPointOntoEllipsoid(t[i],e[i]);return e},x});