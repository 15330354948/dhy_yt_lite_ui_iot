define(["../Core/Cartesian3","../Core/Cartographic","../Core/Check","../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/Math","../Core/Matrix3","../Core/Matrix4","../Core/Quaternion","../Core/Transforms","../Scene/HeightReference","../Scene/GroundPrimitive","../Scene/GroundPolylinePrimitive","./BillboardGraphics","./BoxGraphics","./ConstantPositionProperty","./CorridorGraphics","./createPropertyDescriptor","./createRawPropertyDescriptor","./CylinderGraphics","./EllipseGraphics","./EllipsoidGraphics","./LabelGraphics","./ModelGraphics","./PathGraphics","./PlaneGraphics","./PointGraphics","./PolygonGraphics","./PolylineGraphics","./PolylineVolumeGraphics","./Property","./PropertyBag","./RectangleGraphics","./WallGraphics"],function(i,e,t,o,r,n,s,a,p,h,l,d,c,u,v,_,y,f,m,b,g,w,C,S,P,O,G,N,x,E,M,T,V,F,R,U,q,D){"use strict";var j,B=new e;function L(i){return new b(i)}function Q(i,e){return w(i,void 0,function(i){return i instanceof e?i:new e(i)})}function k(i){var e=(i=r(i,r.EMPTY_OBJECT)).id;n(e)||(e=o()),this._availability=void 0,this._id=e,this._definitionChanged=new p,this._name=i.name,this._show=r(i.show,!0),this._parent=void 0,this._propertyNames=["billboard","box","corridor","cylinder","description","ellipse","ellipsoid","label","model","orientation","path","plane","point","polygon","polyline","polylineVolume","position","properties","rectangle","viewFrom","wall"],this._billboard=void 0,this._billboardSubscription=void 0,this._box=void 0,this._boxSubscription=void 0,this._corridor=void 0,this._corridorSubscription=void 0,this._cylinder=void 0,this._cylinderSubscription=void 0,this._description=void 0,this._descriptionSubscription=void 0,this._ellipse=void 0,this._ellipseSubscription=void 0,this._ellipsoid=void 0,this._ellipsoidSubscription=void 0,this._label=void 0,this._labelSubscription=void 0,this._model=void 0,this._modelSubscription=void 0,this._orientation=void 0,this._orientationSubscription=void 0,this._path=void 0,this._pathSubscription=void 0,this._plane=void 0,this._planeSubscription=void 0,this._point=void 0,this._pointSubscription=void 0,this._polygon=void 0,this._polygonSubscription=void 0,this._polyline=void 0,this._polylineSubscription=void 0,this._polylineVolume=void 0,this._polylineVolumeSubscription=void 0,this._position=void 0,this._positionSubscription=void 0,this._properties=void 0,this._propertiesSubscription=void 0,this._rectangle=void 0,this._rectangleSubscription=void 0,this._viewFrom=void 0,this._viewFromSubscription=void 0,this._wall=void 0,this._wallSubscription=void 0,this._children=[],this.entityCollection=void 0,this.parent=i.parent,this.merge(i)}function A(i,e,t){for(var o=e.length,r=0;r<o;r++){var n=e[r],s=n._show;(!t&&s)!==(t&&s)&&A(n,n._children,t)}i._definitionChanged.raiseEvent(i,"isShowing",t,!t)}s(k.prototype,{availability:C("availability"),id:{get:function(){return this._id}},definitionChanged:{get:function(){return this._definitionChanged}},name:C("name"),show:{get:function(){return this._show},set:function(i){if(!n(i))throw new a("value is required.");if(i!==this._show){var e=this.isShowing;this._show=i;var t=this.isShowing;e!==t&&A(this,this._children,t),this._definitionChanged.raiseEvent(this,"show",i,!i)}}},isShowing:{get:function(){return this._show&&(!n(this.entityCollection)||this.entityCollection.show)&&(!n(this._parent)||this._parent.isShowing)}},parent:{get:function(){return this._parent},set:function(i){var e=this._parent;if(e!==i){var t=this.isShowing;if(n(e)){var o=e._children.indexOf(this);e._children.splice(o,1)}this._parent=i,n(i)&&i._children.push(this);var r=this.isShowing;t!==r&&A(this,this._children,r),this._definitionChanged.raiseEvent(this,"parent",i,e)}}},propertyNames:{get:function(){return this._propertyNames}},billboard:Q("billboard",f),box:Q("box",m),corridor:Q("corridor",g),cylinder:Q("cylinder",S),description:w("description"),ellipse:Q("ellipse",P),ellipsoid:Q("ellipsoid",O),label:Q("label",G),model:Q("model",N),orientation:w("orientation"),path:Q("path",x),plane:Q("plane",E),point:Q("point",M),polygon:Q("polygon",T),polyline:Q("polyline",V),polylineVolume:Q("polylineVolume",F),properties:Q("properties",U),position:(j="position",w(j,void 0,L)),rectangle:Q("rectangle",q),viewFrom:w("viewFrom"),wall:Q("wall",D)}),k.prototype.isAvailable=function(i){if(!n(i))throw new a("time is required.");var e=this._availability;return!n(e)||e.contains(i)},k.prototype.addProperty=function(i){var e=this._propertyNames;if(!n(i))throw new a("propertyName is required.");if(-1!==e.indexOf(i))throw new a(i+" is already a registered property.");if(i in this)throw new a(i+" is a reserved property name.");e.push(i),Object.defineProperty(this,i,C(i,!0))},k.prototype.removeProperty=function(i){var e=this._propertyNames.indexOf(i);if(!n(i))throw new a("propertyName is required.");if(-1===e)throw new a(i+" is not a registered property.");this._propertyNames.splice(e,1),delete this[i]},k.prototype.merge=function(i){if(!n(i))throw new a("source is required.");this.name=r(this.name,i.name),this.availability=r(this.availability,i.availability);for(var e=this._propertyNames,t=n(i._propertyNames)?i._propertyNames:Object.keys(i),o=t.length,s=0;s<o;s++){var p=t[s];if("parent"!==p){var h=this[p],l=i[p];n(h)||-1!==e.indexOf(p)||this.addProperty(p),n(l)&&(n(h)?n(h.merge)&&h.merge(l):n(l.merge)&&n(l.clone)?this[p]=l.clone():this[p]=l)}}};var H=new l,I=new i,J=new c;return k.prototype.computeModelMatrix=function(i,e){t.typeOf.object("time",i);var o=R.getValueOrUndefined(this._position,i,I);if(n(o)){var r=R.getValueOrUndefined(this._orientation,i,J);return e=n(r)?d.fromRotationTranslation(l.fromQuaternion(r,H),o,e):u.eastNorthUpToFixedFrame(o,void 0,e)}},k.prototype.computeModelMatrixForHeightReference=function(e,o,r,s,a){t.typeOf.object("time",e);var p=R.getValueOrDefault(o,e,v.NONE),c=R.getValueOrUndefined(this._position,e,I);if(p===v.NONE||!n(c)||i.equalsEpsilon(c,i.ZERO,h.EPSILON8))return this.computeModelMatrix(e,a);var _=s.cartesianToCartographic(c,B);p===v.CLAMP_TO_GROUND?_.height=r:_.height+=r,c=s.cartographicToCartesian(_,c);var y=R.getValueOrUndefined(this._orientation,e,J);return a=n(y)?d.fromRotationTranslation(l.fromQuaternion(y,H),c,a):u.eastNorthUpToFixedFrame(c,void 0,a)},k.supportsMaterialsforEntitiesOnTerrain=function(i){return _.supportsMaterials(i)},k.supportsPolylinesOnTerrain=function(i){return y.isSupported(i)},k});