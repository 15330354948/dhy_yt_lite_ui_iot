define(["./Cartesian3","./Cartesian4","./Check","./defaultValue","./defined","./defineProperties","./HermiteSpline","./Matrix4","./Spline"],function(t,e,n,i,a,r,l,s,u){"use strict";var o=new e,p=new t,c=new t;var m=new t,y=new t;function f(e){var r=(e=i(e,i.EMPTY_OBJECT)).points,u=e.times,h=e.firstTangent,g=e.lastTangent;if(n.defined("points",r),n.defined("times",u),n.typeOf.number.greaterThanOrEquals("points.length",r.length,2),n.typeOf.number.equals("times.length","points.length",u.length,r.length),r.length>2&&(a(h)||(h=m,t.multiplyByScalar(r[1],2,h),t.subtract(h,r[2],h),t.subtract(h,r[0],h),t.multiplyByScalar(h,.5,h)),!a(g))){var d=r.length-1;g=y,t.multiplyByScalar(r[d-1],2,g),t.subtract(r[d],g,g),t.add(g,r[d-2],g),t.multiplyByScalar(g,.5,g)}this._times=u,this._points=r,this._firstTangent=t.clone(h),this._lastTangent=t.clone(g),this._evaluateFunction=function(e){var n=e.points,i=e.times;if(n.length<3){var r=i[0],u=1/(i[1]-r),m=n[0],y=n[1];return function(e,n){a(n)||(n=new t);var i=(e-r)*u;return t.lerp(m,y,i,n)}}return function(r,u){a(u)||(u=new t);var m,y,h,g,d,T=e._lastTimeIndex=e.findTimeInterval(r,e._lastTimeIndex),v=(r-i[T])/(i[T+1]-i[T]),B=o;return B.z=v,B.y=v*v,B.x=B.y*v,B.w=1,0===T?(m=n[0],y=n[1],h=e.firstTangent,g=t.subtract(n[2],m,p),t.multiplyByScalar(g,.5,g),d=s.multiplyByVector(l.hermiteCoefficientMatrix,B,B)):T===n.length-2?(m=n[T],y=n[T+1],g=e.lastTangent,h=t.subtract(y,n[T-1],p),t.multiplyByScalar(h,.5,h),d=s.multiplyByVector(l.hermiteCoefficientMatrix,B,B)):(m=n[T-1],y=n[T],h=n[T+1],g=n[T+2],d=s.multiplyByVector(f.catmullRomCoefficientMatrix,B,B)),u=t.multiplyByScalar(m,d.x,u),t.multiplyByScalar(y,d.y,c),t.add(u,c,u),t.multiplyByScalar(h,d.z,c),t.add(u,c,u),t.multiplyByScalar(g,d.w,c),t.add(u,c,u)}}(this),this._lastTimeIndex=0}return r(f.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}},firstTangent:{get:function(){return this._firstTangent}},lastTangent:{get:function(){return this._lastTangent}}}),f.catmullRomCoefficientMatrix=new s(-.5,1,-.5,0,1.5,-2.5,0,1,-1.5,2,.5,0,.5,-.5,0,0),f.prototype.findTimeInterval=u.prototype.findTimeInterval,f.prototype.wrapTime=u.prototype.wrapTime,f.prototype.clampTime=u.prototype.clampTime,f.prototype.evaluate=function(t,e){return this._evaluateFunction(t,e)},f});