define(["../Core/Cartesian2","../Core/Cartesian3","../Core/Cartographic","../Core/defaultValue","../Core/defined","../Core/DeveloperError","../Core/EasingFunction","../Core/Math","../Core/PerspectiveFrustum","../Core/PerspectiveOffCenterFrustum","./SceneMode"],function(e,t,i,n,r,o,a,u,l,c,p){"use strict";var s={};var g=new t,f=new t;function h(e,i,n,o,a){var p=a,s=Math.max(n,o);if(!r(p)){var h=e.position,d=i,v=e.up,m=e.right,P=e.frustum,E=t.subtract(h,d,g),T=t.magnitude(t.multiplyByScalar(v,t.dot(E,v),f)),O=t.magnitude(t.multiplyByScalar(m,t.dot(E,m),f));p=Math.min(.2*function(e,t,i){var n,r,o;if(e instanceof l){var a=Math.tan(.5*e.fovy);return n=e.near,r=e.near*a,o=e.aspectRatio*r,Math.max(t*n/o,i*n/r)}return e instanceof c?(n=e.near,r=e.top,o=e.right,Math.max(t*n/o,i*n/r)):Math.max(t,i)}(P,T,O),1e9)}if(s<p){var C=-Math.pow(1e6*(p-n),1/8),I=Math.pow(1e6*(p-o),1/8);return function(e){var t=e*(I-C)+C;return-Math.pow(t,8)/1e6+p}}return function(e){return u.lerp(n,o,e)}}function d(e,t){return u.equalsEpsilon(e,u.TWO_PI,u.EPSILON11)&&(e=0),t>e+Math.PI?e+=u.TWO_PI:t<e-Math.PI&&(e-=u.TWO_PI),e}var v=new t;function m(i,n,r,o,a,l,c){var p=i.camera,s=t.clone(p.position,v),g=p.pitch,f=d(p.heading,o),m=d(p.roll,l),P=h(p,r,s.z,r.z,c);return function(t){var i=t.time/n;p.setView({orientation:{heading:u.lerp(f,o,i),pitch:u.lerp(g,a,i),roll:u.lerp(m,l,i)}}),e.lerp(s,r,i,p.position),p.position.z=P(i)}}var P=new i,E=new i;function T(e,n,o,a,l,c,p,s,g,f){var v=e.camera,m=e.mapProjection.ellipsoid,T=i.clone(v.positionCartographic,P),O=v.pitch,C=d(v.heading,a),I=d(v.roll,c),w=m.cartesianToCartographic(o,E);T.longitude=u.zeroToTwoPi(T.longitude),w.longitude=u.zeroToTwoPi(w.longitude);var M=!1;if(r(s)){var _=u.zeroToTwoPi(s),S=Math.min(T.longitude,w.longitude),N=Math.max(T.longitude,w.longitude),W=_>=S&&_<=N;if(r(g)){var b=Math.abs(T.longitude-w.longitude),y=u.TWO_PI-b;(W?b:y)<(W?y:b)*g&&!W&&(M=!0)}else W||(M=!0)}M?function(e,t){e.longitude<t.longitude?e.longitude+=u.TWO_PI:t.longitude+=u.TWO_PI}(T,w):function(e,t){var i=e.longitude-t.longitude;i<-u.PI?e.longitude+=u.TWO_PI:i>u.PI&&(t.longitude+=u.TWO_PI)}(T,w);var L,q,z,j,V=h(v,o,T.height,w.height,p),x=function(e,t,i,n){if(r(n)&&i(.5)>n){var o=i(0),a=i(1),l=i(.5),c=l-o,p=l-a;return function(n){var r=i(n);if(n<=.5){var l=(r-o)/c;return u.lerp(e,-u.PI_OVER_TWO,l)}var s=(r-a)/p;return u.lerp(-u.PI_OVER_TWO,t,1-s)}}return function(i){return u.lerp(e,t,i)}}(O,l,V,f);return L=T.longitude,q=w.longitude,z=T.latitude,j=w.latitude,function(e){var i=e.time/n,r=t.fromRadians(u.lerp(L,q,i),u.lerp(z,j,i),V(i));v.setView({destination:r,orientation:{heading:u.lerp(C,a,i),pitch:x(i),roll:u.lerp(I,c,i)}})}}function O(i,n,r,o,a,l,c){var p=i.camera,s=t.clone(p.position,v),g=d(p.heading,o),f=p.frustum.right-p.frustum.left,m=h(p,r,f,r.z,c);return function(t){var i=t.time/n;p.setView({orientation:{heading:u.lerp(g,o,i)}}),e.lerp(s,r,i,p.position);var a=m(i),l=p.frustum,c=l.top/l.right,f=.5*(a-(l.right-l.left));l.right+=f,l.left-=f,l.top=c*l.right,l.bottom=-l.top}}var C=new i,I=new t;function w(e,t){return{startObject:{},stopObject:{},duration:0,complete:e,cancel:t}}function M(e,t){return function(){"function"==typeof t&&t(),e.enableInputs=!0}}return s.createTween=function(i,l){var c=(l=n(l,n.EMPTY_OBJECT)).destination;if(!r(i))throw new o("scene is required.");if(!r(c))throw new o("destination is required.");var s=i.mode;if(s===p.MORPHING)return w();var g=n(l.convert,!0),f=i.mapProjection,h=f.ellipsoid,d=l.maximumHeight,v=l.flyOverLongitude,P=l.flyOverLongitudeWeight,E=l.pitchAdjustHeight,_=l.easingFunction;g&&s!==p.SCENE3D&&(h.cartesianToCartographic(c,C),c=f.project(C,I));var S=i.camera,N=l.endTransform;r(N)&&S._setTransform(N);var W=l.duration;r(W)||(W=Math.ceil(t.distance(S.position,c)/1e6)+2,W=Math.min(W,3));var b=n(l.heading,0),y=n(l.pitch,-u.PI_OVER_TWO),L=n(l.roll,0),q=i.screenSpaceCameraController;q.enableInputs=!1;var z=M(q,l.complete),j=M(q,l.cancel),V=S.frustum,x=i.mode===p.SCENE2D;if(x=(x=(x=(x=x&&e.equalsEpsilon(S.position,c,u.EPSILON6))&&u.equalsEpsilon(Math.max(V.right-V.left,V.top-V.bottom),c.z,u.EPSILON6))||i.mode!==p.SCENE2D&&t.equalsEpsilon(c,S.position,u.EPSILON10))&&u.equalsEpsilon(u.negativePiToPi(b),u.negativePiToPi(S.heading),u.EPSILON10)&&u.equalsEpsilon(u.negativePiToPi(y),u.negativePiToPi(S.pitch),u.EPSILON10)&&u.equalsEpsilon(u.negativePiToPi(L),u.negativePiToPi(S.roll),u.EPSILON10))return w(z,j);var D=new Array(4);if(D[p.SCENE2D]=O,D[p.SCENE3D]=T,D[p.COLUMBUS_VIEW]=m,W<=0){return w(function(){D[s](i,1,c,b,y,L,d,v,P,E)({time:1}),"function"==typeof z&&z()},j)}var R=D[s](i,W,c,b,y,L,d,v,P,E);if(!r(_)){var U=S.positionCartographic.height;_=U>(s===p.SCENE3D?h.cartesianToCartographic(c).height:c.z)&&U>11500?a.CUBIC_OUT:a.QUINTIC_IN_OUT}return{duration:W,easingFunction:_,startObject:{time:0},stopObject:{time:W},update:R,complete:z,cancel:j}},s});