define(["../../Core/defined","../../Core/DeveloperError","../../Core/clone","../../Core/defaultValue","../core/ExpendUtil"],function(e,t,i,r,s){function a(i,s){if(!e(i))throw new t("viewer is required.");this._viewer=i;var a=r(s,{});this._depth=r(a.depth,500),this._alpha=r(a.alpha,.5),this.enable=r(a.enable,!1),this.cameraZoom=function(){var e=i.scene.camera.pitch;i.scene.screenSpaceCameraController.enableZoom=!(e>0)}}return a.prototype._updateImageryLayersAlpha=function(e){if(s.underEarth.enable)for(var t=this._viewer.imageryLayers._layers,i=0,r=t.length;i<r;i++)t[i].alpha=e},a.prototype._historyOpts=function(){var e={};e.alpha=i(this._viewer.imageryLayers._layers[0]&&this._viewer.imageryLayers._layers[0].alpha),e.highDynamicRange=i(this._viewer.scene.highDynamicRange),e.skyShow=i(this._viewer.scene.skyAtmosphere.show),e.skyBoxShow=i(this._viewer.scene.skyBox.show),e.depthTest=i(this._viewer.scene.globe.depthTestAgainstTerrain),this._viewer.scene.globe._surface&&this._viewer.scene.globe._surface._tileProvider&&this._viewer.scene.globe._surface._tileProvider._renderState&&(e.blending=i(this._viewer.scene.globe._surface._tileProvider._renderState.blending)),this._oldViewOpts=e},a.prototype.activate=function(){if(!this._enable){this._enable=!0,this._historyOpts();var e=this._viewer;s.underEarth.cullFace=!1,s.underEarth.enable=!0,s.underEarth.enableDepth=this._depth,s.underEarth.enableSkirt=!0,e.scene.globe.depthTestAgainstTerrain=!0,e.scene.highDynamicRange=!1,e.scene.skyAtmosphere.show=!1,e.scene.skyBox.show=!1,this._updateImageryLayersAlpha(this._alpha),viewer.scene.camera.changed.addEventListener(this.cameraZoom)}},a.prototype.disable=function(){if(this._enable){this._enable=!1,this._updateImageryLayersAlpha(this._oldViewOpts.alpha);var e=this._viewer;s.underEarth.cullFace=void 0,s.underEarth.enable=!1,s.underEarth.enableDepth=0,s.underEarth.enableSkirt=!1,e.scene.globe.depthTestAgainstTerrain=this._oldViewOpts.depthTest,e.scene.skyBox.show=this._oldViewOpts.skyBoxShow,e.scene.highDynamicRange=this._oldViewOpts.highDynamicRange,e.scene.skyAtmosphere.show=this._oldViewOpts.skyShow,e.scene.camera.changed.removeEventListener(this.cameraZoom)}},a.prototype.destroy=function(){this._viewer.scene.camera.changed.removeEventListener(this.cameraZoom),delete this._viewer,delete this._alpha,delete this._depth,delete this._enable,delete this._oldViewOpts,delete this.cameraZoom},a});