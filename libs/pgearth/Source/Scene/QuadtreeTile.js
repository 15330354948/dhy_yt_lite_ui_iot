define(["../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Rectangle","./QuadtreeTileLoadState","./TileSelectionResult"],function(t,e,i,h,s,r){"use strict";function n(e){if(!t(e))throw new i("options is required.");if(!t(e.x))throw new i("options.x is required.");if(!t(e.y))throw new i("options.y is required.");if(e.x<0||e.y<0)throw new i("options.x and options.y must be greater than or equal to zero.");if(!t(e.level))throw new i("options.level is required and must be greater than or equal to zero.");if(!t(e.tilingScheme))throw new i("options.tilingScheme is required.");this._tilingScheme=e.tilingScheme,this._x=e.x,this._y=e.y,this._level=e.level,this._parent=e.parent,this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level),this._southwestChild=void 0,this._southeastChild=void 0,this._northwestChild=void 0,this._northeastChild=void 0,this.replacementPrevious=void 0,this.replacementNext=void 0,this._distance=0,this._loadPriority=0,this._customData=[],this._frameUpdated=void 0,this._lastSelectionResult=r.NONE,this._lastSelectionResultFrame=void 0,this._loadedCallbacks={},this.state=s.START,this.renderable=!1,this.upsampledFromParent=!1,this.data=void 0}function o(e){t(e)&&e.freeResources()}return n.createLevelZeroTiles=function(e){if(!t(e))throw new i("tilingScheme is required.");for(var h=e.getNumberOfXTilesAtLevel(0),s=e.getNumberOfYTilesAtLevel(0),r=new Array(h*s),o=0,l=0;l<s;++l)for(var a=0;a<h;++a)r[o++]=new n({tilingScheme:e,x:a,y:l,level:0});return r},n.prototype._updateCustomData=function(e,i,s){var r,n,o,l=this.customData;if(t(i)&&t(s)){for(l=l.filter(function(t){return-1===s.indexOf(t)}),this._customData=l,o=this._rectangle,r=0;r<i.length;++r)n=i[r],h.contains(o,n.positionCartographic)&&l.push(n);this._frameUpdated=e}else{var a=this._parent;if(t(a)&&this._frameUpdated!==a._frameUpdated){l.length=0,o=this._rectangle;var d=a.customData;for(r=0;r<d.length;++r)n=d[r],h.contains(o,n.positionCartographic)&&l.push(n);this._frameUpdated=a._frameUpdated}}},e(n.prototype,{tilingScheme:{get:function(){return this._tilingScheme}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},level:{get:function(){return this._level}},parent:{get:function(){return this._parent}},rectangle:{get:function(){return this._rectangle}},children:{get:function(){return[this.northwestChild,this.northeastChild,this.southwestChild,this.southeastChild]}},southwestChild:{get:function(){return t(this._southwestChild)||(this._southwestChild=new n({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y+1,level:this.level+1,parent:this})),this._southwestChild}},southeastChild:{get:function(){return t(this._southeastChild)||(this._southeastChild=new n({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y+1,level:this.level+1,parent:this})),this._southeastChild}},northwestChild:{get:function(){return t(this._northwestChild)||(this._northwestChild=new n({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y,level:this.level+1,parent:this})),this._northwestChild}},northeastChild:{get:function(){return t(this._northeastChild)||(this._northeastChild=new n({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y,level:this.level+1,parent:this})),this._northeastChild}},customData:{get:function(){return this._customData}},needsLoading:{get:function(){return this.state<s.DONE}},eligibleForUnloading:{get:function(){var e=!0;return t(this.data)&&(e=this.data.eligibleForUnloading,t(e)||(e=!0)),e}}}),n.prototype.findLevelZeroTile=function(t,e,i){var h=this.tilingScheme.getNumberOfXTilesAtLevel(0);if(e<0?e+=h:e>=h&&(e-=h),!(i<0||i>=this.tilingScheme.getNumberOfYTilesAtLevel(0)))return t.filter(function(t){return t.x===e&&t.y===i})[0]},n.prototype.findTileToWest=function(t){var e=this.parent;if(void 0===e)return this.findLevelZeroTile(t,this.x-1,this.y);if(e.southeastChild===this)return e.southwestChild;if(e.northeastChild===this)return e.northwestChild;var i=e.findTileToWest(t);return void 0!==i?e.southwestChild===this?i.southeastChild:i.northeastChild:void 0},n.prototype.findTileToEast=function(t){var e=this.parent;if(void 0===e)return this.findLevelZeroTile(t,this.x+1,this.y);if(e.southwestChild===this)return e.southeastChild;if(e.northwestChild===this)return e.northeastChild;var i=e.findTileToEast(t);return void 0!==i?e.southeastChild===this?i.southwestChild:i.northwestChild:void 0},n.prototype.findTileToSouth=function(t){var e=this.parent;if(void 0===e)return this.findLevelZeroTile(t,this.x,this.y+1);if(e.northwestChild===this)return e.southwestChild;if(e.northeastChild===this)return e.southeastChild;var i=e.findTileToSouth(t);return void 0!==i?e.southwestChild===this?i.northwestChild:i.northeastChild:void 0},n.prototype.findTileToNorth=function(t){var e=this.parent;if(void 0===e)return this.findLevelZeroTile(t,this.x,this.y-1);if(e.southwestChild===this)return e.northwestChild;if(e.southeastChild===this)return e.northeastChild;var i=e.findTileToNorth(t);return void 0!==i?e.northwestChild===this?i.southwestChild:i.southeastChild:void 0},n.prototype.freeResources=function(){this.state=s.START,this.renderable=!1,this.upsampledFromParent=!1,t(this.data)&&t(this.data.freeResources)&&this.data.freeResources(),o(this._southwestChild),this._southwestChild=void 0,o(this._southeastChild),this._southeastChild=void 0,o(this._northwestChild),this._northwestChild=void 0,o(this._northeastChild),this._northeastChild=void 0},n});