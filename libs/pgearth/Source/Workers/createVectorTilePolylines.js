define(["../Core/AttributeCompression","../Core/Cartesian3","../Core/Cartographic","../Core/Ellipsoid","../Core/IndexDatatype","../Core/Math","../Core/Rectangle","./createTaskProcessorWorker"],function(r,a,e,n,t,o,u,i){"use strict";var c=32767,s=new e,f=new a;var p=new u,b=new n,d=new a,w={min:void 0,max:void 0};var v=new a,k=new a,l=new a,y=new a,h=new a;return i(function(i,A){var g=new Uint16Array(i.positions),C=new Uint16Array(i.widths),m=new Uint32Array(i.counts),E=new Uint16Array(i.batchIds);!function(r){r=new Float64Array(r);var e=0;w.min=r[e++],w.max=r[e++],u.unpack(r,e,p),e+=u.packedLength,n.unpack(r,e,b),e+=n.packedLength,a.unpack(r,e,d)}(i.packedBuffer);var x,T=b,U=d,D=function(n,t,u,i,p){var b=n.length/3,d=n.subarray(0,b),w=n.subarray(b,2*b),v=n.subarray(2*b,3*b);r.zigZagDeltaDecode(d,w,v);for(var k=new Float32Array(n.length),l=0;l<b;++l){var y=d[l],h=w[l],A=v[l],g=o.lerp(t.west,t.east,y/c),C=o.lerp(t.south,t.north,h/c),m=o.lerp(u,i,A/c),E=e.fromRadians(g,C,m,s),x=p.cartographicToCartesian(E,f);a.pack(x,k,3*l)}return k}(g,p,w.min,w.max,T),F=D.length/3,I=4*F-4,N=new Float32Array(3*I),P=new Float32Array(3*I),R=new Float32Array(3*I),S=new Float32Array(2*I),_=new Uint16Array(I),L=0,B=0,G=0,M=0,W=m.length;for(x=0;x<W;++x){for(var z=m[x],H=C[x],O=E[x],Y=0;Y<z;++Y){var Z;if(0===Y){var j=a.unpack(D,3*M,v),q=a.unpack(D,3*(M+1),k);Z=a.subtract(j,q,l),a.add(j,Z,Z)}else Z=a.unpack(D,3*(M+Y-1),l);var J,K=a.unpack(D,3*(M+Y),y);if(Y===z-1){var Q=a.unpack(D,3*(M+z-1),v),V=a.unpack(D,3*(M+z-2),k);J=a.subtract(Q,V,h),a.add(Q,J,J)}else J=a.unpack(D,3*(M+Y+1),h);a.subtract(Z,U,Z),a.subtract(K,U,K),a.subtract(J,U,J);for(var X=Y===z-1?2:4,$=0===Y?2:0;$<X;++$){a.pack(K,N,L),a.pack(Z,P,L),a.pack(J,R,L),L+=3;var rr=$-2<0?-1:1;S[B++]=$%2*2-1,S[B++]=rr*H,_[G++]=O}}M+=z}var ar=t.createTypedArray(I,6*F-6),er=0,nr=0;for(W=F-1,x=0;x<W;++x)ar[nr++]=er,ar[nr++]=er+2,ar[nr++]=er+1,ar[nr++]=er+1,ar[nr++]=er+2,ar[nr++]=er+3,er+=4;return A.push(N.buffer,P.buffer,R.buffer),A.push(S.buffer,_.buffer,ar.buffer),{indexDatatype:2===ar.BYTES_PER_ELEMENT?t.UNSIGNED_SHORT:t.UNSIGNED_INT,currentPositions:N.buffer,previousPositions:P.buffer,nextPositions:R.buffer,expandAndWidth:S.buffer,batchIds:_.buffer,indices:ar.buffer}})});