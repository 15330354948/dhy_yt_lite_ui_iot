define(["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/freezeObject","../Core/GeographicTilingScheme","../Core/Resource","../Core/WebMercatorProjection","./GetFeatureInfoFormat","./TimeDynamicImagery","./UrlTemplateImageryProvider","../Core/createGuid"],function(e,t,r,i,n,a,o,s,u,c,l,m){"use strict";function h(r){if(r=e(r,e.EMPTY_OBJECT),!t(r.url))throw new i("options.url is required.");if(!t(r.layers))throw new i("options.layers is required.");if(t(r.times)&&!t(r.clock))throw new i("options.times was specified, so options.clock is required.");var n=o.createIfNeeded(r.url),u=n.clone();n.setQueryParameters(h.DefaultParameters,!0),u.setQueryParameters(h.GetFeatureInfoDefaultParameters,!0),t(r.parameters)&&n.setQueryParameters(f(r.parameters)),t(r.getFeatureInfoParameters)&&u.setQueryParameters(f(r.getFeatureInfoParameters));var g=this;this._reload=void 0,t(r.times)&&(this._timeDynamicImagery=new c({clock:r.clock,times:r.times,requestImageFunction:function(e,t,r,i,n){return d(g,e,t,r,i,n)},reloadFunction:function(){t(g._reload)&&g._reload()}}));var P={};P.layers=r.layers,P.bbox="{westProjected},{southProjected},{eastProjected},{northProjected}",P.width="{width}",P.height="{height}",P.uuid=m(),parseFloat(n.queryParameters.version)>=1.3?P.crs=e(r.crs,r.tilingScheme&&r.tilingScheme.projection instanceof s?"EPSG:3857":"CRS:84"):P.srs=e(r.srs,r.tilingScheme&&r.tilingScheme.projection instanceof s?"EPSG:3857":"EPSG:4326"),n.setQueryParameters(P,!0),u.setQueryParameters(P,!0);var y={query_layers:r.layers,x:"{i}",y:"{j}",info_format:"{format}"};u.setQueryParameters(y,!0),this._resource=n,this._pickFeaturesResource=u,this._layers=r.layers,this._tileProvider=new l({url:n,pickFeaturesUrl:u,tilingScheme:e(r.tilingScheme,new a({ellipsoid:r.ellipsoid})),rectangle:r.rectangle,tileWidth:r.tileWidth,tileHeight:r.tileHeight,minimumLevel:r.minimumLevel,maximumLevel:r.maximumLevel,subdomains:r.subdomains,tileDiscardPolicy:r.tileDiscardPolicy,credit:r.credit,getFeatureInfoFormats:e(r.getFeatureInfoFormats,h.DefaultGetFeatureInfoFormats),enablePickFeatures:r.enablePickFeatures})}function d(e,r,i,n,a,o){var s=t(o)?o.data:void 0,u=e._tileProvider;return t(s)&&u._resource.setQueryParameters(s),u.requestImage(r,i,n,a)}function f(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r.toLowerCase()]=e[r]);return t}return r(h.prototype,{url:{get:function(){return this._resource._url}},proxy:{get:function(){return this._resource.proxy}},layers:{get:function(){return this._layers}},tileWidth:{get:function(){return this._tileProvider.tileWidth}},tileHeight:{get:function(){return this._tileProvider.tileHeight}},maximumLevel:{get:function(){return this._tileProvider.maximumLevel}},minimumLevel:{get:function(){return this._tileProvider.minimumLevel}},tilingScheme:{get:function(){return this._tileProvider.tilingScheme}},rectangle:{get:function(){return this._tileProvider.rectangle}},tileDiscardPolicy:{get:function(){return this._tileProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._tileProvider.errorEvent}},ready:{get:function(){return this._tileProvider.ready}},readyPromise:{get:function(){return this._tileProvider.readyPromise}},credit:{get:function(){return this._tileProvider.credit}},hasAlphaChannel:{get:function(){return this._tileProvider.hasAlphaChannel}},enablePickFeatures:{get:function(){return this._tileProvider.enablePickFeatures},set:function(e){this._tileProvider.enablePickFeatures=e}},clock:{get:function(){return this._timeDynamicImagery.clock},set:function(e){this._timeDynamicImagery.clock=e}},times:{get:function(){return this._timeDynamicImagery.times},set:function(e){this._timeDynamicImagery.times=e}}}),h.prototype.getTileCredits=function(e,t,r){return this._tileProvider.getTileCredits(e,t,r)},h.prototype.requestImage=function(e,r,i,n){var a,o,s=this._timeDynamicImagery;return t(s)&&(o=s.currentInterval,a=s.getFromCache(e,r,i,n)),t(a)||(a=d(this,e,r,i,n,o)),t(a)&&t(s)&&s.checkApproachingInterval(e,r,i,n),a},h.prototype.pickFeatures=function(e,r,i,n,a){var o=this._timeDynamicImagery;return function(e,r,i,n,a,o,s){var u=t(s)?s.data:void 0,c=e._tileProvider;return t(u)&&c._pickFeaturesResource.setQueryParameters(u),c.pickFeatures(r,i,n,a,o)}(this,e,r,i,n,a,t(o)?o.currentInterval:void 0)},h.DefaultParameters=n({service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"}),h.GetFeatureInfoDefaultParameters=n({service:"WMS",version:"1.1.1",request:"GetFeatureInfo"}),h.DefaultGetFeatureInfoFormats=n([n(new u("json","application/json")),n(new u("xml","text/xml")),n(new u("text","text/html"))]),h});